var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{c(r.next(t))}catch(e){a(e)}}function s(t){try{c(r["throw"](t))}catch(e){a(e)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,a=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(r){n=[6,r],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},ScreenMovies;!function(t){function e(t){function e(t){v++,v==o&&n.removeChild(a)}var n=SkFrame.curStage(),r=SkFrame.curWidth(),i=SkFrame.curHeight(),a=new eui.Group;a.width=r,a.height=i,n.addChild(a);for(var o=40,s=5,c=o/s,u=0;o>u;u++){var l=r/s,h=i/c,p=u%s*l,g=Math.floor(u/s)*h,d=new egret.RenderTexture,f=(d.drawToTexture(n,new egret.Rectangle(p,g,l,h)),new egret.Bitmap);switch(f.texture=d,f.anchorOffsetX=l/2,f.anchorOffsetY=h/2,f.x=p+l/2,f.y=g+h/2,a.addChild(f),5==t&&(t=Math.ceil(4*Math.random())),t){case 1:var m=egret.Tween.get(f);m.to({scaleX:0,scaleY:0,alpha:0,rotation:359},800,egret.Ease.circIn).call(e,this);break;case 2:var _=-r;u%2||(_=2*r);var m=egret.Tween.get(f);m.to({x:_,alpha:0},800,egret.Ease.circIn).call(e,this);break;case 3:var m=egret.Tween.get(f);m.to({scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,egret.Ease.backInOut).call(e,this);break;case 4:var m=egret.Tween.get(f);m.to({alpha:0},900,egret.Ease.circIn).call(e,this);break;default:var m=egret.Tween.get(f);m.to({scaleX:1,scaleY:0,alpha:0},800,egret.Ease.circIn).call(e,this)}}var v=0}t.MovieStart=e}(ScreenMovies||(ScreenMovies={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),t=new LoadingUI,[4,RES.loadGroup("load",0)];case 3:return n.sent(),this.stage.addChild(t),[4,RES.loadGroup("preload",1,t)];case 4:return n.sent(),this.stage.removeChild(t),[3,6];case 5:return e=n.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){egret.ImageLoader.crossOrigin="anonymous","ios"==egret.Capabilities.os.toLowerCase()?this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkCookies,this):this.checkCookies();var t=new GameUi;t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,this.addChild(t),e.bg_skin=t},e.prototype.checkCookies=function(){if(this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.checkCookies,this),egret.localStorage.getItem("ismusic"))switch(egret.localStorage.getItem("ismusic")){case"1":Music.PlayBGM();break;case"0":Music.StopBGM()}else Music.PlayBGM()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(r,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Data=function(){function t(){}return t.local_url="http://"+location.host,t.USER_INFO_URL=t.local_url+"/dzp/index/getInfo",t.GIFTS_URL=t.local_url+"/dzp/index/getList",t.HISTORY_URL=t.local_url+"/dzp/index/getHistory",t.GETRAND_URL=t.local_url+"/dzp/index/getRand",t.img_angle=30,t.award_number=0,t.award_times=3,t.txt="",t.balance=562131,t.isGame=!1,t.gifts=[],t.history_arr=[],t.turn_num=0,t}();__reflect(Data.prototype,"Data");var Http=function(){function t(){}return t.get=function(t,e){if(e){var n=[];for(var r in e)n.push(r+"="+e[r]);t+="?"+n.join("&")}var i=new egret.HttpRequest;return i.responseType=egret.HttpResponseType.TEXT,i.open(t,egret.HttpMethod.GET),i.send(),i},t.POST=function(t,e){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT;var r="";for(var i in e)r+=i+"="+e[i]+"&";return r=r.slice(0,-1),n.open(t,egret.HttpMethod.POST),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(r),n},t.prototype.onGetComplete=function(t){t.currentTarget},t}();__reflect(Http.prototype,"Http");var Music=function(){function t(){}return t.PlayBGM=function(){t._bgm_channel=t.PlaySound("bgm_mp3",-1)},t.StopBGM=function(){t._bgm_channel&&t._bgm_channel.stop()},t.PlaySound=function(e,n){if(t.IsMusic){var r=RES.getRes(e),i=r.play(0,n);return i}},Object.defineProperty(t,"IsMusic",{get:function(){var t=egret.localStorage.getItem("ismusic");return null==t||""==t?!0:"1"==t},set:function(e){e?(egret.localStorage.setItem("ismusic","1"),t.PlayBGM()):(egret.localStorage.setItem("ismusic","0"),t.StopBGM())},enumerable:!0,configurable:!0}),t}();__reflect(Music.prototype,"Music");var RandomUtils=function(){function t(){}return t.prototype.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var n=e-t;return t+Math.random()*n},t.prototype.limitInteger=function(t,e){return Math.round(this.limit(t,e))},t.prototype.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t}();__reflect(RandomUtils.prototype,"RandomUtils");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoadingSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.omComplete,e),e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.omComplete()},e.prototype.omComplete=function(){this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){ScreenMovies.MovieStart(2)},this)},e.prototype.onProgress=function(t,e){var n=Math.floor(t/e*100);100==n?this.progress.parent.visible=!1:this.bar.percentWidth=n,this.progress.text=n+"%"},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SkFrame;!function(t){function e(){return egret.MainContext.instance.stage}function n(){return egret.MainContext.instance.stage.stageWidth}function r(){return egret.MainContext.instance.stage.stageHeight}function i(){return document.body.clientHeight/document.body.clientWidth>1.32}function a(t){t.left=0,t.right=0,t.top=0,t.bottom=0}function o(t,e){if(e)for(var n in t.items)t.items[n].props={loop:!0};t.play()}function s(t,e){var n=RES.getRes(t);return n.play(0,e),n}function c(t,e,n,r,i,a,o){var s=RES.getRes(o+"_json"),c=RES.getRes(o+"_png"),u=new egret.MovieClipDataFactory(s,c),l=new egret.MovieClip(u.generateMovieClipData(i));return l.x=n,l.y=r,e.addChild(l),l.gotoAndPlay(t,a),l.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(l)},this),l}function u(){var t=window.navigator.userAgent.toLowerCase(),e=""+t.match(/MicroMessenger/i);return"null"==e?!1:"micromessenger"==e?!0:void 0}t.curStage=e,t.curWidth=n,t.curHeight=r,t.isBigScreen=i,t.screenAuto=a,t.playTweenAnimation=o,t.PlayBgSound=s,t.LoadMovieClipMovie=c,t.isWeiXin=u}(SkFrame||(SkFrame={}));var Alert=function(t){function e(e){var n=t.call(this)||this;return n.txt=e,n.skinName="AlertSkin",n.addEventListener(egret.Event.ADDED_TO_STAGE,n.addToStage,n),n}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.height=this.stage.stageHeight,this.width=this.stage.stageWidth,this.sure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dele,this),this.sure.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){egret.Tween.get(e.sure).to({scaleX:.9,scaleY:.9},0,egret.Ease.backIn)},this),this.sure.addEventListener(egret.TouchEvent.TOUCH_END,function(){egret.Tween.get(e.sure).to({scaleX:1,scaleY:1},0,egret.Ease.backOut)},this)},e.prototype.addToStage=function(){this.lb_dialog_text.text=this.txt,this.alert_panel.scaleY=0,this.alpha=0,egret.Tween.get(this.alert_panel).to({scaleY:1},300,egret.Ease.circIn),egret.Tween.get(this).to({alpha:1},300)},e.prototype.dele=function(){var t=this;Music.PlaySound("btn_mp3",1),egret.Tween.get(this.alert_panel).to({scaleY:0},500,egret.Ease.circOut).call(function(){t.parent.removeChild(t)},this),egret.Tween.get(this).to({alpha:0},500)},e}(eui.Component);__reflect(Alert.prototype,"Alert");var ETimer=function(t){function e(){var e=t.call(this)||this;return e.timer=new egret.Timer(1e3),e.skinName="resource/GameSkins/ETimer.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.AddCall=function(t){this.call=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComplete,this),this.TimeStart(15)},e.prototype.TimeStart=function(t){this.num=t,this.timer.stop(),this.timer.repeatCount=t,this.timer.start()},e.prototype.timerFunc=function(){this.num-=1,this.lbTime.text=this.num.toString(),this.num<=10&&(this.tween=egret.Tween.get(this,{loop:!0}).to({scaleX:1.2,scaleY:1.2},1e3)),this.num<=0&&egret.Tween.pauseTweens(this)},e.prototype.timerComplete=function(){null!=this.call&&this.call()},e}(eui.Component);__reflect(ETimer.prototype,"ETimer",["eui.UIComponent","egret.DisplayObject"]);var GameUi=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameUiSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.initUser(),this.back_home(),this.music_controller(),SkFrame.playTweenAnimation(this.light,!0)},e.prototype.initUser=function(){var t=this;Http.get(Data.USER_INFO_URL).addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget,r=JSON.parse(n.response);r&&(Data.balance=Number(r.money),Data.award_times=Number(r.count),t.balance.text=Data.balance.toString(),t.times.text=Data.award_times.toString())},this)},e.prototype.music_controller=function(){if(egret.localStorage.getItem("ismusic"))switch(egret.localStorage.getItem("ismusic")){case"0":this.music_btn.selected=!0;break;case"1":this.music_btn.selected=!1}else this.music_btn.selected=!1;this.music_btn.addEventListener(eui.UIEvent.CHANGE,function(t){t.target.selected?(egret.localStorage.setItem("ismusic","0"),Music.StopBGM()):(egret.localStorage.setItem("ismusic","1"),Music.PlayBGM())},this)},e.prototype.back_home=function(){this.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.top.location.href="/"},this)},e}(eui.Component);__reflect(GameUi.prototype,"GameUi");var Gift=function(t){function e(){var e=t.call(this)||this;return e.skinName="GiftSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e}(eui.Component);__reflect(Gift.prototype,"Gift");var HistoryItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="HisItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.nickname.username,e=this.data.name,n=this.data.time,r=this.data.num;this.user_name.text=t,this.award_time.text=n,this.award_type.text=e+r},e}(eui.ItemRenderer);__reflect(HistoryItem.prototype,"HistoryItem");var HistoryPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="HistorySkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.getHistory()},e.prototype.getHistory=function(){var t=this;Http.get(Data.HISTORY_URL,{num:12}).addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget,r=JSON.parse(n.response);r?(Data.history_arr=r.data,t.set_history()):t.load_animation()},this)},e.prototype.set_history=function(){var t=new eui.ArrayCollection;this.his_list.dataProvider=t,this.his_list.itemRenderer=HistoryItem;for(var e=0;e<Data.history_arr.length;e++)t.addItem(Data.history_arr[e])},e.prototype.load_animation=function(){this.load_img.parent.visible=!0,egret.Tween.get(this.load_img,{loop:!0}).to({rotation:360},2e3)},e.prototype.stop_animation=function(){egret.Tween.removeTweens(this)},e}(eui.Component);__reflect(HistoryPanel.prototype,"HistoryPanel");var Show=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShowSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.height=this.stage.stageHeight,this.width=this.stage.stageWidth,this.alpha=0,this.addToStage()},e.prototype.addToStage=function(){Music.PlaySound("win_mp3",1),this.img.source=Data.local_url+"index/Image/load?url="+Data.gifts[Data.turn_num].img,this.txt.text=Data.txt,this.dele_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dele,this),this.open_animation()},e.prototype.use_game=function(){this.use_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},e.prototype.open_animation=function(){var t=egret.Tween.get(this.main_group).to({scaleX:0,scaleY:0});t.to({scaleX:1,scaleY:1},300).wait(5e3).call(this.dele,this),egret.Tween.get(this).to({alpha:0}).to({alpha:1},200)},e.prototype.dele=function(){var t=this;egret.Tween.get(this).to({alpha:1}).to({alpha:0},200).call(function(){t.dispatchEventWith("newGame"),t&&t.parent&&t.parent.removeChild(t)},this)},e}(eui.Component);__reflect(Show.prototype,"Show");var TurnTable=function(t){function e(){var e=t.call(this)||this;return e.skinName="TurnTableSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.lucky_button.touchEnabled=!1,this.lucky_button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.lucky_btn_touch,this),this.getGiftsList()},e.prototype.getGiftsList=function(){var t=this;Http.get(Data.GIFTS_URL).addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget,r=JSON.parse(n.response);if(r){for(var i=0;i<r.data.length;i++){var a={};a.img=r.data[i].photo,a.id=r.data[i].id,Data.gifts.push(a)}t.initGift()}},this)},e.prototype.initGift=function(){for(var t=this,e=function(e){var r=new Gift;r.alpha=0,r.scaleX=2,r.scaleY=2,r.x=r.width/2,r.y=r.height/2,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.rotation=-Data.img_angle*e,egret.setTimeout(function(){egret.Tween.get(r).to({scaleX:1,scaleY:1,alpha:1},300,egret.Ease.quintOut).call(function(){e==Data.gifts.length-1&&(t.lucky_button.touchEnabled=!0)},t)},n,100*e),r.gift_img.source=Data.local_url+"index/Image/load?url="+Data.gifts[e].img,n.gift_box.addChild(r)},n=this,r=0;r<Data.gifts.length;r++)e(r)},e.prototype.lucky_btn_touch=function(){var t=this;return Music.PlaySound("btn_mp3",1),Data.isGame?void 0:Data.award_times<=0?void this.stage.addChild(new Alert("抽奖次数用完了，明天再来哦！")):void Http.get(Data.GETRAND_URL).addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget,r=JSON.parse(n.response);r&&(Data.award_number=r.award_id,Data.txt=r.msg,Data.isGame=!0,t.lucky_button.touchEnabled=!1,t.turnAnimation())},this)},e.prototype.turnAnimation=function(){var t=egret.setTimeout(function(){Music.PlaySound("reelSpin_mp3",1),egret.clearTimeout(t)},this,500);Data.award_times-=1,Main.bg_skin.times.text=Data.award_times.toString();for(var e=0;e<Data.gifts.length;e++)if(Data.gifts[e].id==Data.award_number){Data.turn_num=e;var n=egret.Tween.get(this.gift_box),r=2880+Data.img_angle*Data.turn_num;n.to({rotation:r},3e3,egret.Ease.cubicInOut).wait(500).call(this.show,this)}},e.prototype.show=function(){var t=new Show;t.once("newGame",this.newGame,this),this.stage.addChild(t)},e.prototype.newGame=function(){Data.isGame=!1,this.lucky_button.touchEnabled=!0,Main.bg_skin.his_panel.getHistory()},e}(eui.Component);__reflect(TurnTable.prototype,"TurnTable");