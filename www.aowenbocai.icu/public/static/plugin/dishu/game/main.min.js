var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Bouns=function(t){function e(){var e=t.call(this)||this;return e.skinName="BounsSkin",e.y=10,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){egret.Tween.get(this,{loop:!0}).to({y:this.y+10},500).to({y:this.y-10},500).to({y:this.y},250)},e}(eui.Component);__reflect(Bouns.prototype,"Bouns");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Loading=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Loading.exml",e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.dispatchEventWith("childrenCreated")},e}(eui.Component);__reflect(Loading.prototype,"Loading",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.loading=new Loading,this.addChild(this.loading),this.loading.addEventListener("childrenCreated",this.loadComplete,this)},e.prototype.loadComplete=function(){this.loading.bar.width=0,this.dispatchEventWith("loadComplete")},e.prototype.setProgress=function(t,e){this.loading.bar.percentWidth=100*t/e,this.loading.progress.text=t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading"),this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"loading"==t.groupName?(this.loadingView=new LoadingUI,this.loadingView.addEventListener("loadComplete",this.loadNext,this),this.stage.addChild(this.loadingView)):"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.loadNext=function(){RES.loadGroup("preload")},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.loadmu=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.loadmu,this);var t=RES.getRes("bgmu_ogg");t.play(0,0)},e.prototype.startCreateScene=function(){Data.init(),"ios"==egret.Capabilities.os.toLowerCase()?this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loadmu,this):this.loadmu();var t=new GameUI;this.stage.addChild(t),this.stage.removeChild(this.loadingView)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var DiamondsItem=function(t){function e(e){var i=t.call(this)||this;return i.data={money:"10",diamonds:"6"},i.data=e,i.skinName="DiamondsItemSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){this.money.text="￥"+this.data.money+" 购买",this.diamonds.text=this.data.diamonds,this.award.text="额外赠送"+this.data.award+"金豆",this.money.addEventListener(egret.TouchEvent.TOUCH_TAP,this.go,this)},e.prototype.go=function(){window.top.location.href="/pay/pay/index/num/"+this.data.money+"/type/2"},e}(eui.Component);__reflect(DiamondsItem.prototype,"DiamondsItem");var PayItem=function(t){function e(e){var i=t.call(this)||this;return i.data={money:"10",award:"6",coin:"12"},i.data=e,i.skinName="PayItemSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.money.text="￥"+this.data.money+" 购买",this.coin.text=this.data.coin,this.award.text="额外赠送"+this.data.award+"金豆",this.money.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.top.location.href="/pay/pay/index/num/"+t.data.money},this)},e}(eui.Component);__reflect(PayItem.prototype,"PayItem");var PayPanel=function(t){function e(){var e=t.call(this)||this;return e.host=Data.ROOT_DONAME,e.api="/index/Recharge/getRechargeList",e.userApi="/index/user/getInfo",e.content=[],e.api=e.host+e.api,e.userApi=e.host+e.userApi,e.skinName="PayPanelSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.no,e),e.auto_zh.addEventListener(eui.UIEvent.CHANGE,e.reload,e),e}return __extends(e,t),e.prototype.no=function(t){t.stopImmediatePropagation()},e.prototype.init=function(){var t=this;this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.close_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.parent&&t.parent.removeChild(t)},this)},e.prototype.reload=function(){Http.get(this.userApi).addEventListener(egret.Event.COMPLETE,this.setCoin,this),this.clearChild(),this.scroller.viewport.scrollV=0;var t=this.auto_zh.selected;t?(Http.get(this.api).addEventListener(egret.Event.COMPLETE,this.createList,this),this.title.text="充值金豆"):(Http.get(this.api).addEventListener(egret.Event.COMPLETE,this.diamondsList,this),this.title.text="充值钻石")},e.prototype.setCoin=function(t){var e=t.currentTarget,i=JSON.parse(e.response);i.err||(this.coin.text=i.data.money,this.diamonds.text=i.data.diamonds)},e.prototype.clearChild=function(){this.loading_group.visible=!0;var t=this.content;if(0!=t.length)for(var e=0,i=t;e<i.length;e++){var n=i[e];n.parent.removeChild(n)}this.content=[]},e.prototype.createList=function(t){var e=t.currentTarget,i=JSON.parse(e.response);if(!i.err){this.loading_group.visible=!1;for(var n=0,o=i.data;n<o.length;n++){var s=o[n],r=new PayItem(s);this.content.push(r),this.scroller_box.addChild(r)}}},e.prototype.diamondsList=function(t){var e=t.currentTarget,i=JSON.parse(e.response);if(!i.err){this.loading_group.visible=!1;for(var n=0,o=i.data;n<o.length;n++){var s=o[n],r=new DiamondsItem(s);this.content.push(r),this.scroller_box.addChild(r)}}},e}(eui.Component);__reflect(PayPanel.prototype,"PayPanel");var Http=function(){function t(){}return t.get=function(t,e){if(e){var i=[];for(var n in e)i.push(n+"="+e[n]);t+="?"+i.join("&")}var o=new egret.HttpRequest;return o.responseType=egret.HttpResponseType.TEXT,o.open(t,egret.HttpMethod.GET),o.send(),o},t.prototype.onGetComplete=function(t){t.currentTarget},t}();__reflect(Http.prototype,"Http");var GameUI=function(t){function e(){var e=t.call(this)||this;return e.sbx=[],e.tList=[],e.strIndex=["100T","500T","1000T","5000T"],e.boxHasShu=[0,1,2,3,4,5,6,7,8],e.skinName="GameUISkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){var t=this;this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.sbx=[this.sbx0,this.sbx1,this.sbx2,this.sbx3,this.sbx4,this.sbx5,this.sbx6,this.sbx7,this.sbx8],this.tList=[this.t100,this.t500,this.t1000,this.t5000],this.tab_t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showTBox,this),this.tList.forEach(function(e){e.addEventListener(egret.TouchEvent.TOUCH_TAP,t.selectT,t)}),this.hisPenal=new His,this.addChild(this.hisPenal),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHelp,this),this.btn_menu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showMenu,this),this.btn_home.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showHome,this),this.btn_recharge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.recharge,this),egret.Tween.get(this.wait_net.getChildAt(1),{loop:!0}).to({rotation:360},2e3),Data.socket.on("init",function(e){t.setMoney(e.coinCount),console.log("连接成功！"),t.wait_net.parent.removeChild(t.wait_net),egret.setInterval(function(){t.createShu()},t,1e3)}),Data.socket.on("atkDishu",function(e){var i=e.coinCount,n=e.boxIndex,o=e.bouns,s=t.sbx[n],r=s.getChildAt(0);t.setMoney(i),o>0?(t.addBouns(s,o),r.atkBoom()):r.atkMiss()}),Data.socket.on("setMoney",function(e){var i=e.coin;t.setMoney(i)}),Data.socket.on("noefMoney",function(){t.noefMoney()})},e.prototype.noefMoney=function(){this.addChild(new Tips("金豆不足，请获取金豆！"))},e.prototype.showHelp=function(){var t=new Help;t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,this.addChild(t)},e.prototype.showMenu=function(){this.hisPenal.visible=!0},e.prototype.showHome=function(){window.top.location.href="/"},e.prototype.showTBox=function(){var t=egret.Tween.get(this.t_box),e=124==this.t_box.width?556:124;t.to({width:e},200)},e.prototype.setMoney=function(t){Data.coinCount=t,this.money.text=t},e.prototype.addBouns=function(t,e){console.log();var i=new Bouns;i.bouns.text="+"+e.toString(),t.addChild(i)},e.prototype.selectT=function(t){var e=t.currentTarget,i=e.getChildAt(1),n=e.getChildAt(2),o=this.tab_t.getChildAt(0),s=this.tab_t.getChildAt(2);this.strIndex.forEach(function(t,e){return t==n.text?void(Data.betIndex=e):void 0}),o.source=i.source,s.text=n.text,this.chuizi.source=o.source,this.showTBox()},e.prototype.createShu=function(){var t=this,e=Math.floor(Math.random()*this.boxHasShu.length),i=this.boxHasShu[e];this.boxHasShu.splice(e,1);var n=new ShuItem;n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.atk,this),n.boxIndex=i,n.addEventListener("delete",function(){t.boxHasShu.push(n.boxIndex)},this),this.sbx[i].addChild(n)},e.prototype.atk=function(t){t.currentTarget;this.chuizi.x=t.stageX-this.chuizi.parent.x+this.chuizi.anchorOffsetX-10,this.chuizi.y=t.stageY-this.chuizi.parent.y+this.chuizi.anchorOffsetY-60,this.chuizi.alpha=1,this.isChuiDh&&egret.Tween.removeTweens(this.chuizi),this.isChuiDh=egret.Tween.get(this.chuizi).to({rotation:-20},100).to({rotation:0},100).wait(500).to({alpha:0},500)},e.prototype.recharge=function(){var t=new PayPanel;t.x=0,t.y=0,t.reload(),this.addChild(t)},e}(eui.Component);__reflect(GameUI.prototype,"GameUI");var Help=function(t){function e(){var e=t.call(this)||this;return e.skinName="HelpSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.close=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(Help.prototype,"Help");var His=function(t){function e(){var e=t.call(this)||this;return e.current_page=0,e.last_page=1,e.s_isLoading=!1,e.skinName="HisSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e.visible=!1,e}return __extends(e,t),e.prototype.init=function(){this.percentHeight=100,this.percentWidth=100,this.collection=new eui.ArrayCollection,this.list.dataProvider=this.collection,this.list.itemRenderer=HisItem,this.list.itemRendererSkinName="HisItemSkin",this.list.selectedIndex=0,this.scroller.addEventListener(eui.UIEvent.CHANGE_END,this.loadData,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tag,this),this.reload.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reloadData,this),this.loadData()},e.prototype.reloadData=function(){var t=this;this.current_page=0,this.collection.removeAll(),this.scroller.viewport.scrollV=0,egret.setTimeout(function(){t.loadData()},this,100)},e.prototype.tag=function(){this.visible=!1},Object.defineProperty(e.prototype,"isLoading",{get:function(){return this.s_isLoading},set:function(t){t?this.tips.text="数据加载中...":this.tips.text="上拉加载更多"},enumerable:!0,configurable:!0}),e.prototype.loadData=function(){var t=this.scroller.viewport.scrollV-this.scroller.viewport.contentHeight+this.scroller.viewport.height;this.isLoading||0>t||this.current_page>=this.last_page||(this.isLoading=!0,this.current_page++,Http.get(Data.HIS_LIST_URL+"?page="+this.current_page).addEventListener(egret.Event.COMPLETE,this.setData,this))},e.prototype.setData=function(t){this.isLoading=!1;var e=t.currentTarget,i=JSON.parse(e.response);this.current_page=i.current_page,this.last_page=i.last_page,this.current_page>=this.last_page&&(this.tips.text="所有数据加载完成");for(var n=0,o=i.data;n<o.length;n++){var s=o[n];this.collection.addItem(s)}},e}(eui.Component);__reflect(His.prototype,"His");var HisItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="HisItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.dishu_id-1;this.shu_img.source=Data.shuData[t].source,this.shu_name.text=Data.shuData[t].name,this.t_num.text=this.data.bet_money,this.data.bouns>0?(this.bouns.text="奖励 "+this.data.bouns,this.hit_str.textColor=3735326,this.hit_str.text="击晕"):(this.bouns.text="",this.hit_str.textColor=16732160,this.hit_str.text="未击晕")},e}(eui.ItemRenderer);__reflect(HisItem.prototype,"HisItem");var ShuItem=function(t){function e(){var e=t.call(this)||this;e.isInit=!1,e.shuBoom=["shu000","shu004","shu008","shu012","shu016"],e.shu=["shu001","shu006","shu010","shu013","shu017"],e.life=5e3;var i=Math.floor(Math.random()*e.shu.length);return e.source="shu_json."+e.shu[i],4==i?e.horizontalCenter=20:e.horizontalCenter=0,e.shuIndex=i,e.bottom=0,e.pixelHitTest=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.boomN,e),e}return __extends(e,t),e.prototype.init=function(){this.isInit||(this.isInit=!0,this.bottom=-this.height,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.runShu())},e.prototype.runShu=function(){var t=this,e=egret.Tween.get(this);e.to({bottom:18},500,egret.Ease.getBackOut(.5)).call(function(){t.r=egret.Tween.get(t,{loop:!0}),t.r.to({scaleY:.95},1e3).to({scaleY:1},500).to({scaleY:.95},1e3).to({scaleY:1},500)}).wait(this.life).to({bottom:-this.height},500,egret.Ease.getBackIn(.5)).call(function(){t.dispatchEventWith("delete"),t.parent.removeChildren()})},e.prototype.boomN=function(){4==this.shuIndex&&(this.horizontalCenter=10),this.source="shu_json."+this.shuBoom[this.shuIndex],this.touchEnabled=!1,Data.socket.emit("attackFish",{betIndex:Data.betIndex,dishuId:this.shuIndex+1,boxIndex:this.boxIndex})},e.prototype.atkMiss=function(){var t=this,e=RES.getRes("nohit_ogg");e.play(0,1),egret.setTimeout(function(){t.touchEnabled=!0,4==t.shuIndex&&(t.horizontalCenter=20),t.source="shu_json."+t.shu[t.shuIndex]},this,120)},e.prototype.atkBoom=function(){var t=this,e=RES.getRes("hit_ogg");e.play(0,1),this.parent.addChild(this.loadDh()),egret.Tween.removeTweens(this);var i=egret.Tween.get(this);i.to({bottom:18},200,egret.Ease.getBackOut(.5)).wait(2e3).to({bottom:-this.height},500,egret.Ease.getBackIn(.5)).call(function(){t.dispatchEventWith("delete"),t.parent.removeChildren()})},e.prototype.loadDh=function(){var t=RES.getRes("xin_json"),e=RES.getRes("xin_png"),i=new egret.MovieClipDataFactory(t,e),n=new egret.MovieClip(i.generateMovieClipData("xin"));n.gotoAndPlay("run",-1);var o=new eui.Group;return o.addChild(n),o.width=n.width,o.horizontalCenter=0,o.touchEnabled=!1,o},e}(eui.Image);__reflect(ShuItem.prototype,"ShuItem");var Tips=function(t){function e(e){var i=t.call(this)||this;return i.str=e,i.skinName="TipsSkin",i.touchEnabled=!0,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.msg.text=this.str,this.y=-this.height,this.x=(this.stage.stageWidth-this.width)/2,egret.Tween.get(this).to({y:(this.stage.stageHeight-this.height)/2},200,egret.Ease.backOut).wait(2e3).call(function(){t.parent.removeChild(t)})},e}(eui.Component);__reflect(Tips.prototype,"Tips");var Data=function(){function t(){}return t.init=function(){RES.getRes("data_config_json");t.WEBSOCKET_URL="http://"+document.domain+":8927",t.ROOT_DONAME="http://"+location.host,t.SID_API=t.ROOT_DONAME+"/fish50/index/getSid",t.HIS_LIST_URL=t.ROOT_DONAME+"/game/dishu/getHisList",t.socket=new Net},t.betIndex=0,t.WEBSOCKET_URL="http://192.168.0.102:8927",t.ROOT_DONAME="http://192.168.0.102:88",t.SID_API=t.ROOT_DONAME+"/fish50/index/getSid",t.HIS_LIST_URL=t.ROOT_DONAME+"/game/dishu/getHisList",t.shuData=[{source:"shu001",name:"萌萌鼠"},{source:"shu006",name:"矿矿鼠"},{source:"shu010",name:"海盗鼠"},{source:"shu013",name:"呆呆鼠"},{source:"shu017",name:"调皮兔"}],t}();__reflect(Data.prototype,"Data");var Net=function(){function t(){this.socketFunc={connect:function(){console.log("连接成功")},disconnect:function(){console.log("断开连接")},loginok:function(){console.log("登录服务器成功")},shoot:function(){}},this.emitFunc={login:function(){console.log("开始登陆服务器")}},this.socketInit()}return t.prototype.socketInit=function(){var t=this;this.socket=io.connect(Data.WEBSOCKET_URL),this.socket.on("connect",function(){t.getSid()});var e=this.socketFunc;for(var i in e)this.socket.on(i,e[i])},t.prototype.on=function(t,e){this.socketFunc[t]=e,this.socket.on(t,e)},t.prototype.emit=function(t,e){void 0===e&&(e={}),this.socket.emit(t,e)},t.prototype.getSid=function(){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.open(Data.SID_API,egret.HttpMethod.GET),t.send(),t.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this)},t.prototype.onGetComplete=function(t){var e=t.currentTarget,i=JSON.parse(e.response);this.emit("login",{token:i.sid})},t}();__reflect(Net.prototype,"Net");