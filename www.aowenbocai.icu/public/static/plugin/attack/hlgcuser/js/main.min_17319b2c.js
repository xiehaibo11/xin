var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(s,n){function r(t){try{h(o.next(t))}catch(e){n(e)}}function a(t){try{h(o["throw"](t))}catch(e){n(e)}}function h(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,n&&(r=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],n=0}finally{s=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,n,r,a,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},CodeItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.skinName="CodeItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.txt.text=this.data.txt.toString()},e}(eui.ItemRenderer);__reflect(CodeItem.prototype,"CodeItem");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?o(s):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Http=function(){function t(){}return t.get=function(t,e){if(e){var i=[];for(var o in e)i.push(o+"="+e[o]);t+="?"+i.join("&")}var s=new egret.HttpRequest;return s.responseType=egret.HttpResponseType.TEXT,s.open(t,egret.HttpMethod.GET),s.send(),s},t.prototype.onGetComplete=function(t){t.currentTarget},t}();__reflect(Http.prototype,"Http");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoadingUISkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.omComplete()},e.prototype.omComplete=function(){this.height=this.stage.stageHeight,this.pro_bg.mask=this.rect_mask,this.playAnimation(this.load,!0)},e.prototype.onProgress=function(t,e){this.rect_mask.percentHeight=100*t/e;var i=Math.floor(t/e*100);this.loading.text="正在初始化。。。"+i+"%"},e.prototype.playAnimation=function(t,e){if(e)for(var i in t.items)t.items[i].props={loop:!0};t.play()},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("load",0)];case 3:return i.sent(),[4,RES.loadGroup("preload",1,t)];case 4:return i.sent(),this.stage.removeChild(t),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){Music.init(),egret.ImageLoader.crossOrigin="anonymous","ios"==egret.Capabilities.os.toLowerCase()?this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.checkCookies,this):this.checkCookies();var t=new Game;this.addChild(t),Data.init(t)},e.prototype.checkCookies=function(){if(this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.checkCookies,this),Data.getCookies("music"))switch(Data.getCookies("music")){case"false":Music.PlayBGM();break;case"true":Music.StopBGM()}else Music.PlayBGM()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Music=function(){function t(){}return t.init=function(){t._click=RES.getRes("btn3_mp3"),t._back=RES.getRes("back_mp3"),t._wrong=RES.getRes("erro_mp3"),t._fight=RES.getRes("fight_mp3"),t._choose=RES.getRes("btn7_mp3"),t._bgm=RES.getRes("fightBGM_mp3"),t._win=RES.getRes("win~3_mp3"),t._lose=RES.getRes("lose_mp3")},t.PlayBGM=function(){t.IsMusic&&(t._bgm_channel=t._bgm.play(0,0))},t.StopBGM=function(){t._bgm_channel&&t._bgm_channel.stop(),t._click_channel&&t._click_channel.stop(),t._turn_channel&&t._turn_channel.stop()},t.PlayClick=function(){t.IsMusic&&(t._click_channel=t._click.play(0,1))},t.PlayWin=function(){t.IsMusic&&t._win.play(0,1)},t.PlayLose=function(){t.IsMusic&&t._lose.play(0,1)},t.PlayFight=function(){t.IsMusic&&(t._turn_channel=t._fight.play(0,1),egret.setTimeout(function(){t._turn_channel.stop()},this,2500))},t.PlayBack=function(){t.IsMusic&&t._back.play(0,1)},t.PlayWrong=function(){t.IsMusic&&t._wrong.play(0,1)},t.PlayChoose=function(){t.IsMusic&&t._choose.play(0,1)},Object.defineProperty(t,"IsMusic",{get:function(){var t=Data.getCookies("ismusic");return null==t||""==t?!0:"1"==t},set:function(e){e?(Data.setCookies("ismusic","1"),t.PlayBGM()):(Data.setCookies("ismusic","0"),t.StopBGM())},enumerable:!0,configurable:!0}),t}();__reflect(Music.prototype,"Music");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function s(t){e.call(o,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(o))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(o,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Alert=function(t){function e(e){var i=t.call(this)||this;return i.txt=e,i.skinName="AlertSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.addToStage,i),i}return __extends(e,t),e.prototype.addToStage=function(){this.height=this.stage.stageHeight,this.alert.text=this.txt,this.close.addEventListener(egret.TouchEvent.TOUCH_TAP,this._close,this)},e.prototype._close=function(){Music.PlayChoose(),this.parent.removeChild(this)},e}(eui.Component);__reflect(Alert.prototype,"Alert");var AutoGame=function(t){function e(){var e=t.call(this)||this;return e.autoIndex=0,e.skinName="AutoGameSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.height=this.stage.stageHeight,this.initInput(this.plunder),this.initInput(this.Beplunder),this.initInput(this.Single),this.question(this.plunder),this.question(this.Beplunder),this.question(this.Single),this.question(this.autoSoldier),this.auto_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.go_fight,this),this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHome,this),this.back1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHome,this);for(var t=0,e=this.auto_selected.$children;t<e.length;t++){var i=e[t];i.groupName="auto",i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.choose,this)}},e.prototype.initInput=function(t){var e=t.getChildAt(1);return e.skinName="InputSkin",e.textColor=13531449,e.restrict="0-9",e},e.prototype.checkInput=function(){var t=Number(this.initInput(this.plunder).text),e=Number(this.initInput(this.Beplunder).text),i=Number(this.initInput(this.Single).text);return Data.winMoney=t,Data.loseMoney=e,Data.auto_soldier_number=i,isNaN(Data.winMoney)||isNaN(Data.loseMoney)||isNaN(Data.auto_soldier_number)?void this.addChild(new Alert("你还没有输入金豆数量!")):void this.auto_panel()},e.prototype.auto_panel=function(){var t=new AutoPanel;this.stage.addChild(t),this.backHome()},e.prototype.question=function(t){var e=t.getChildAt(2);return e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.questionShow,this),e.hashCode},e.prototype.questionShow=function(t){var e=t.target;switch(e.hashCode){case this.question(this.plunder):this.addChild(new Alert("当掠夺的金豆总数大于等于你设定的数量则退出自动战斗。"));break;case this.question(this.Beplunder):this.addChild(new Alert("当被掠夺的金豆总数小于等于你设定的数量则退出自动战斗。"));break;case this.question(this.Single):this.addChild(new Alert("每局出兵的数量， 最大不超过1000000"));break;case this.question(this.autoSoldier):this.addChild(new Alert("随机：每局出战士兵随机选择。不随机：选择一种士兵，每局出战士兵则为你选择的士兵。"))}},e.prototype.choose=function(t){var e=t.target;switch(e.label){case"随机":this.autoIndex=0;break;case"矛兵":this.autoIndex=1;break;case"盾兵":this.autoIndex=2;break;case"弓兵":this.autoIndex=3}},e.prototype.go_fight=function(){this.checkInput()},e.prototype.backHome=function(){this.dispatchEventWith("auto_close"),this.parent.removeChild(this)},e}(eui.Component);__reflect(AutoGame.prototype,"AutoGame");var AutoPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="AutoPanelSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.height=this.stage.stageHeight,this.winMoney.text=Data.winMoney.toString(),this.loseMoney.text=Data.loseMoney.toString(),this.NowWinMoney.text="0",this.NowLoseMoney.text="0",this.cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this._cancel,this)},e.prototype._cancel=function(){this.dispatchEventWith("out_auto"),this.parent.removeChild(this)},e}(eui.Component);__reflect(AutoPanel.prototype,"AutoPanel");var BetHistory=function(t){function e(){var e=t.call(this)||this;return e.isLoading=!0,e.skinName="BetHistorySkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.height=this.stage.stageHeight,Http.get(Data.GAMEHISTORY_URL).addEventListener(egret.Event.COMPLETE,this._history,this),this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this._back,this),this.back1.addEventListener(egret.TouchEvent.TOUCH_TAP,this._back,this)},e.prototype._history=function(t){this.isLoading=!1;var e=t.currentTarget,i=JSON.parse(e.response);if(i.data.data.length<=0)return this.scrollerList.parent.visible=!1,void(this.zero.visible=!0);Data.now_Page=Number(i.data.current_page),Data.all_Page=Number(i.data.last_page);var o=new eui.ArrayCollection;this.scrollerList.dataProvider=o,this.scrollerList.itemRenderer=BetItem;for(var s=0;s<i.data.data.length;s++)o.addItem(i.data.data[s]);this.collection=o,i.data.data.length<=7?this.loading.text="数据加载完成！":this.loading.text="正在加载中。。。",this.scroller.addEventListener(eui.UIEvent.CHANGE_END,this.move,this)},e.prototype.move=function(){var t=this.scroller.viewport.scrollV-(this.scroller.viewport.contentHeight-this.scroller.viewport.height);if(!(0>t)&&1!=this.isLoading){if(Data.now_Page++,Data.now_Page>Data.all_Page)return void(this.loading.text="这里是有底线的!");this.isLoading=!0,Http.get(Data.GAMEHISTORY_URL,{page:Data.now_Page}).addEventListener(egret.Event.COMPLETE,this.moreHistory,this)}},e.prototype.moreHistory=function(t){this.isLoading=!1;for(var e=t.currentTarget,i=JSON.parse(e.response),o=0;o<i.data.data.length;o++)this.collection.addItem(i.data.data[o])},e.prototype._back=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(BetHistory.prototype,"BetHistory");var BetItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.betting.text=this.data.betting+"兵",this.enemy_betting.text=this.data.enemy_betting+"兵",this.create_time.text=this.data.create_time,this.money.text="投注"+this.data.money+"金豆",0==this.data.status&&(this.result.text="挑战失败"),1==this.data.status&&(this.result.text="胜"+this.data.bonus+"金豆",this.result.textColor=14505517),2==this.data.status&&(this.result.text="平"+this.data.bonus+"金豆",this.result.textColor=14505517)},e}(eui.ItemRenderer);__reflect(BetItem.prototype,"BetItem");var Data=function(){function t(){}return t.init=function(e){t.elem={gameMain:e}},Object.defineProperty(t,"coinCount",{get:function(){return Number(t.money)},set:function(e){t.money=e,t.elem.gameMain.recharge.text=e.toString()},enumerable:!0,configurable:!0}),t.setCookies=function(t,e){document.cookie=t+"="+e+";"},t.getCookies=function(t){for(var e=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){var s=i[o].trim();if(0==s.indexOf(e))return s.substring(e.length,s.length)}return""},t.local_url="http://"+location.host,t.USER_INFO_URL=t.local_url+"/attack/index/getInfo",t.GAMEHISTORY_URL=t.local_url+"/attack/index/getNpcRecord",t.CREATE_ROOM=t.local_url+"/attack/index/createRoom",t.JOIN_ROOM=t.local_url+"/attack/index/joinRoom",t.ENEMY_USER=t.local_url+"/attack/index/getRoomUser",t.READY=t.local_url+"/attack/index/readyBetting",t.ALL_READY=t.local_url+"/attack/index/checkEnemyReady",t.GO_FIGHT=t.local_url+"/attack/index/addBetting",t.ALL_FIGHT=t.local_url+"/attack/index/checkEnemyBetting",t.soldier=["矛","盾","弓","矛兵","盾兵","弓兵"],t.soldierImg=["sprite-game-soldier_json.sprite-game-soldier000","sprite-game-soldier_json.sprite-game-soldier002","sprite-game-soldier_json.sprite-game-soldier001","sprite-game-soldier_json.sprite-game-soldier005","sprite-game-soldier_json.sprite-game-soldier004","sprite-game-soldier_json.sprite-game-soldier003"],t.winImg=["sprite-bubble-title_json.sprite-bubble-title000","sprite-bubble-title_json.sprite-bubble-title007","sprite-bubble-title_json.sprite-bubble-title008"],t.money=0,t.bouns=0,t.buttons=[100,1e3,1e4,5e4,1e5,1e6],t.bet=100,t.code=0,t.soldiersGroup=[],t.cmpSoldierY=0,t.youSoldierY=0,t.imgXy={x:35,y:654},t.source=0,t.betSource=0,t.status=0,t.now_Page=1,t.all_Page=1,t.auto_soldier_number=1e3,t.winMoney=0,t.loseMoney=0,t}();__reflect(Data.prototype,"Data");var CodeList=function(t){function e(){var e=t.call(this)||this;return e.skinName="CodeListSkin",e}return __extends(e,t),e.prototype.createChildren=function(){this.height=this.stage.stageHeight,this.show.stop(),this.show.play(),this._codeList.addEventListener(egret.TouchEvent.TOUCH_TAP,this._con,this),this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this._back,this);var t=new eui.ArrayCollection;this._codeList.dataProvider=t,this._codeList.itemRenderer=CodeItem;for(var e=Data.buttons.length-1;e>=0;e--)t.addItem({txt:Data.buttons[e]});if(Data.getCookies("item")){var i=Number(Data.getCookies("item"));this._codeList.selectedIndex=i,this.setBet(this._codeList.selectedItem)}else this._codeList.selectedIndex=Data.buttons.length-1},e.prototype._con=function(t){this.setBet(this._codeList.selectedItem)},e.prototype.setBet=function(t){var e=Number(t.txt);Data.bet=e,Data.setCookies("item",this._codeList.selectedIndex),Data.setCookies("bet",e),this.dispatchEventWith("bet_choose")},e.prototype._back=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(CodeList.prototype,"CodeList");var Explain=function(t){function e(){var e=t.call(this)||this;return e.skinName="ExplainSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.height=this.stage.stageHeight,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goBack,this),this.back1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goBack,this)},e.prototype.goBack=function(){this.parent.removeChild(this)},e}(eui.Component);__reflect(Explain.prototype,"Explain");var Fight=function(t){function e(){var e=t.call(this)||this;return e.skinName="FightSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e}(eui.Component);__reflect(Fight.prototype,"Fight");var Game=function(t){function e(){var e=t.call(this)||this;return e.isFight=!1,e.isCheck=!0,e.endTime=0,e.skinName="GameUiSkin",e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.percentHeight=100,this.percentWidth=100,this.recharge.parent.addEventListener(egret.TouchEvent.TOUCH_TAP,this._recharge,this),this.set.addEventListener(egret.TouchEvent.TOUCH_TAP,this._set,this),this.ready.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readyGo,this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,this._share,this),this.soldiers.addEventListener("fight",function(){e.fightTime>0&&(e.readyFight.visible=!0),e.setTime.stop(),e.timerComFunc()},this),Http.get(Data.USER_INFO_URL).addEventListener(egret.Event.COMPLETE,this._setMoney,this),Http.get(Data.ENEMY_USER).addEventListener(egret.Event.COMPLETE,this._setEnemy,this),this.init(),this.codeInpt.text=Data.bet.toString()},e.prototype.userImg=function(t){void 0===t&&(t="");var e=this.rec_mask.width/this.user_img.width,i=this.rec_mask.height/this.user_img.height;return this.user_img.scaleX=e,this.user_img.scaleY=i,this.user_img.mask=this.rec_mask,t?void(this.user_img.source=Data.local_url+"index/Image/load?url="+t):void(this.user_img.source="")},e.prototype._setMoney=function(t){var e=t.currentTarget,i=JSON.parse(e.response);Data.money=Math.floor(i.money),this.recharge.text=Data.money.toString()},e.prototype.checkUser=function(){var t=this;this.isCheck&&egret.setTimeout(function(){Http.get(Data.ENEMY_USER).addEventListener(egret.Event.COMPLETE,t._setEnemy,t)},this,5e3)},e.prototype._setEnemy=function(t){this.checkUser();var e=t.currentTarget,i=JSON.parse(e.response);if(!i.live){var o=new Alert("断线请重连！");this.addChild(o),o.close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.top.location.href=Data.local_url+"attack/index"},this)}return 0!=i.err?void(this.isCheck=!1):0==i.data.user_list.length?(this.user_name.text="等待加入",void this.userImg()):(this.user_name.text=i.data.user_list[0].nickname,void this.userImg(i.data.user_list[0].photo))},e.prototype._cut=function(){Data.bet>100&&Data.bet<=1e3?Data.bet-=100:Data.bet>1e3&&Data.bet<=1e4?Data.bet-=1e3:Data.bet>1e4&&Data.bet<=1e5?Data.bet-=1e4:Data.bet>1e5&&Data.bet<=1e6?Data.bet-=1e5:Data.bet>1e6&&(Data.bet-=1e6),this.codeInpt.text=Data.bet.toString()},e.prototype._add=function(){return Data.bet>0&&Data.bet<1e3?Data.bet+=100:Data.bet>=1e3&&Data.bet<1e4?Data.bet+=1e3:Data.bet>=1e4&&Data.bet<1e5?Data.bet+=1e4:Data.bet>=1e5&&Data.bet<1e6?Data.bet+=1e5:Data.bet>=1e6&&(Data.bet+=1e6),Data.bet>4e6?(Data.bet=4e6,this.codeInpt.text=Data.bet.toString(),void this.addChild(new Alert("最大金豆数不能超过400W！"))):void(this.codeInpt.text=Data.bet.toString())},e.prototype.init=function(){if(Data.getCookies("bet")){var t=Number(Data.getCookies("bet"));this.codeInpt.text=t.toString(),Data.bet=t}else this.codeInpt.text=Data.bet.toString();this.codeInpt.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cdIN,this),this.add.addEventListener(egret.TouchEvent.TOUCH_TAP,this._add,this),this.cut.addEventListener(egret.TouchEvent.TOUCH_TAP,this._cut,this),this.all_in.addEventListener(egret.TouchEvent.TOUCH_TAP,this._all,this),this.soldiers.touchChildren=!1},e.prototype.btnPanel=function(){var t=this,e=new CodeList;e.addEventListener("bet_choose",function(){t.codeInpt.text=Data.bet.toString()},this),this.addChild(e),this.codeList=e},e.prototype._all=function(){if(Data.money<100)return void this.addChild(new Alert("最小金豆数不能小于100！"));if(Data.money>4e6)this.addChild(new Alert("最大金豆数不能超过400W！")),Data.bet=4e6,this.codeInpt.text=Data.bet.toString();else{var t=100*Math.floor(Data.money/100);Data.bet=t}},e.prototype.cdIN=function(){this.codeList&&this.codeList.parent||this.btnPanel()},e.prototype.btnTouch=function(t){Music.PlayChoose();var e=t.target;Data.bet=Number(e.label),Data.setCookies("btn",e.label)},e.prototype._fight=function(){Data.cmpSoldierY=this.cityImg.localToGlobal().y+this.cityImg.height,Data.youSoldierY=this.soldiers.localToGlobal().y+50,this.readyImg()},e.prototype.readyImg=function(){var t=new eui.Image;t.source="sprite-game_json.sprite-game011",t.x=this.stage.stageWidth-100,t.y=(this.stage.stageHeight-t.height)/2-50,this.addChild(t),Data.imgXy={x:t.x,y:t.y};var e=egret.Tween.get(t),i=(this.stage.stageWidth-t.width)/2;e.to({x:i},750).call(this._result,this).call(function(){t.parent.removeChild(t)},this)},e.prototype._result=function(){this.soldiers.visible=!1;var t=new Reulst;t.x=(this.stage.stageWidth-t.width)/2,t.y=(this.stage.stageHeight-t.height)/2,this.addChild(t),t.addEventListener("newGame",this.newGame,this)},e.prototype.newGame=function(){if(Data.getCookies("btn")){var t=Data.getCookies("btn");Data.bet=Number(t)}this.isFight=!1,this.Count_down.text="",this.ready.selected=!1,this.ready.touchEnabled=!0,this.soldiers.touchChildren=!1,this.soldiers.visible=!0,this.soldiers.alpha=.5,this.soldiers.fight.visible=!1,this.soldiers.soldierBack()},e.prototype.readyGo=function(){return Music.PlayChoose(),Data.bet>Data.money?(this.ready.selected=!1,void this.addChild(new Alert("你没有那么多小钱钱!"))):Data.bet>4e6?(this.ready.selected=!1,void this.addChild(new Alert("最大金豆数不能超过400W！"))):(this.ready.touchEnabled=!1,void Http.get(Data.READY,{money:Data.bet}).addEventListener(egret.Event.COMPLETE,this._readyGo,this))},e.prototype._readyGo=function(t){var e=t.currentTarget,i=JSON.parse(e.response);return 0!=i.err?(this.ready.selected=!1,this.ready.touchEnabled=!0,void this.addChild(new Alert(i.msg))):void(0==i.err&&(this.readyAlertTwo("已准备，等待敌方出兵！"),Http.get(Data.ALL_READY).addEventListener(egret.Event.COMPLETE,this.addReadyGo,this)))},e.prototype.addReadyGo=function(t){var e=t.currentTarget,i=JSON.parse(e.response);return 0==i.err&&(this.soldiers.alpha=1,this.soldiers.touchChildren=!0,Data.bet=i.betting_money,Data.money=Math.floor(i.money),this.recharge.text=Data.money.toString(),this.timers.visible=!0,this.readyFight.visible=!1,this.set_Time(i.time),this.readyAlertTwo("本局金豆为："+Data.bet)),1==i.err?(this.ready.selected=!1,this.ready.touchEnabled=!0,void this.addChild(new Alert(i.msg))):void(2==i.err&&Http.get(Data.ALL_READY).addEventListener(egret.Event.COMPLETE,this.addReadyGo,this))},e.prototype.set_Time=function(t){this.setTime=new egret.Timer(1e3,t),this.setTime.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.setTime.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.setTime.start();var e=(new Date).getTime();this.endTime=new Date(e+1e3*t).getTime()},e.prototype.timerFunc=function(){var t=(new Date).getTime(),e=Math.floor((this.endTime-t)/1e3);this.fightTime=e,0>e?(this.setTime.stop(),this.timerComFunc()):this.Count_down.text=e.toString()},e.prototype.timerComFunc=function(){1!=this.isFight&&(this.readyFight.visible=!1,this.soldiers.fight.visible=!1,this.soldiers.touchChildren=!1,this.timers.visible=!1,this.isFight=!0,this.go_fight())},e.prototype.go_fight=function(){return Data.source<3?void Http.get(Data.ALL_FIGHT).addEventListener(egret.Event.COMPLETE,this.his_soldier,this):(this.readyAlertTwo("已出兵，等待敌方出兵！"),void Http.get(Data.GO_FIGHT,{betting:Data.source-2}).addEventListener(egret.Event.COMPLETE,this.my_soldier,this))},e.prototype.my_soldier=function(t){var e=t.currentTarget;JSON.parse(e.response);Http.get(Data.ALL_FIGHT).addEventListener(egret.Event.COMPLETE,this.his_soldier,this)},e.prototype.his_soldier=function(t){var e=this,i=t.currentTarget,o=JSON.parse(i.response);return 0!=o.err?void console.log("数据错误"):7==o.win_status?(this.readyAlert("双方未出兵，弃战！"),void egret.setTimeout(function(){Data.money=Math.floor(o.money),e.recharge.text=Data.money.toString(),e.newGame()},this,3e3)):0==o.enemy_betting?(this.readyAlert("对面未出兵,你赢了！"),void egret.setTimeout(function(){e.showResult(),e._showResult.currentState="win",e.newGame()},this,3e3)):Data.source<3?(this.readyAlert("你未出兵,你输了！"),void egret.setTimeout(function(){e.showResult(),e._showResult.currentState="lose",e.newGame()},this,3e3)):(Data.betSource=o.enemy_betting,Data.bouns=o.bonus,Data.money=o.money,Data.status=o.win_status,this.readyFight.visible=!1,void this._fight())},e.prototype.readyAlert=function(t){this.readyFight.text=t,this.readyFight.visible=!0,this.readyZoo.stop(),this.readyZoo.play()},e.prototype.readyAlertTwo=function(t){this.readyFight.text=t,this.readyFight.visible=!0,this.readyTwo.stop(),this.readyTwo.play()},e.prototype.showResult=function(){var t=new ShowResult;egret.Tween.get(t).to({alpha:1},1e3).wait(1200).call(function(){t.parent.removeChild(t)},this),this.stage.addChild(t),this._showResult=t},e.prototype._recharge=function(){Music.PlayChoose();var t=new PayPanel;t.x=0,t.y=0,t.reload(),this.addChild(t)},e.prototype._share=function(){this.addChild(new Alert("这是一个分享链接"))},e.prototype._set=function(){Music.PlayChoose();var t=new SetPanel;this.addChild(t)},e}(eui.Component);__reflect(Game.prototype,"Game");var Reulst=function(t){function e(){var e=t.call(this)||this;return e.skinName="ResultSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.height=this.stage.stageHeight,this.changeSoldier()},e.prototype.changeSoldier=function(){this.cmp.y=Data.cmpSoldierY,this.cmp.s_name.y=-20,this.cmp.life.parent.y=-40,this.cmp.soldier.source=Data.soldierImg[Data.betSource+2],this.cmp.s_name.text=Data.soldier[Data.betSource+2]+" x "+Data.bet,this.you.y=Data.youSoldierY,this.you.soldier.source=Data.soldierImg[Data.source],this.you.s_name.text=Data.soldier[Data.source]+" x "+Data.bet,this._soldier()},e.prototype._soldier=function(){var t=this;Music.PlayFight();var e=egret.Tween.get(this.cmp).to({y:Data.cmpSoldierY}).call(function(){t.cmp.visible=!0},this),i=egret.Tween.get(this.you).to({y:Data.youSoldierY}).call(function(){t.you.visible=!0},this);e.to({y:Data.imgXy.y},500).call(function(){t.cmp.soldier.visible=!1,t.you.soldier.visible=!1},this).call(this.result,this),i.to({y:Data.imgXy.y},400)},e.prototype._fight=function(){var t=this;this.fightGroup.visible=!0,this.fight.stop(),this.fight.play(),this.fight.addEventListener("complete",function(){t.parent.removeChild(t)},this)},e.prototype.showResult=function(){var t=this,e=new ShowResult;this.stage.addChild(e),this._showResult=e,egret.Tween.get(e).to({alpha:1},1e3).wait(1200).call(function(){t.dispatchEventWith("newGame"),e.parent.removeChild(e)},this)},e.prototype.draw=function(){var t=this;this._fight(),this.cmp._loseHarf(),this.you._loseHarf(),egret.setTimeout(function(){t.showResult(),Music.PlayWin(),t._showResult.gift.text=Data.bouns.toString(),t._showResult.currentState="zero",Data.coinCount=Data.money},this,2e3)},e.prototype.win=function(){var t=this;this._fight(),this.cmp._loseAll(),egret.setTimeout(function(){t.showResult(),Music.PlayWin(),t._showResult.gift.text=Data.bouns.toString(),t._showResult.currentState="win",Data.coinCount=Data.money},this,2e3)},e.prototype.lose=function(){var t=this;this._fight(),this.you._loseAll(),egret.setTimeout(function(){t.showResult(),Music.PlayLose(),t._showResult.currentState="lose"},this,2e3)},e.prototype.result=function(){0==Data.status&&this.lose(),1==Data.status&&this.win(),2==Data.status&&this.draw()},e}(eui.Component);__reflect(Reulst.prototype,"Reulst");var SetPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="SetPanelSkin",e}return __extends(e,t),e.prototype.createChildren=function(){if(t.prototype.createChildren.call(this),Data.getCookies("music")){var e="true"==Data.getCookies("music")?!0:!1;this.sound.selected=e}this.height=this.stage.stageHeight,this.sound.addEventListener(eui.UIEvent.CHANGE,this._sound,this),this.betHistory.addEventListener(egret.TouchEvent.TOUCH_TAP,this._betHistory,this),this.backHome.addEventListener(egret.TouchEvent.TOUCH_TAP,this._backHome,this),this.help.addEventListener(egret.TouchEvent.TOUCH_TAP,this._help,this),this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this._back,this)},e.prototype._sound=function(t){1==t.target.selected?(Data.setCookies("music",!0),Music.StopBGM(),Music.IsMusic=!1):(Data.setCookies("music",!1),Music.IsMusic=!0)},e.prototype._betHistory=function(){Music.PlayChoose();var t=new BetHistory;this.stage.addChild(t)},e.prototype._backHome=function(){Music.PlayChoose(),window.top.location.href="/"},e.prototype._help=function(){Music.PlayChoose();var t=new Explain;this.addChild(t)},e.prototype._back=function(){Music.PlayChoose(),this.parent.removeChild(this)},e}(eui.Component);__reflect(SetPanel.prototype,"SetPanel");var ShowResult=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShowResultSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.height=this.stage.stageHeight,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this._back,this)},e.prototype._back=function(){this.dispatchEventWith("newGame"),egret.Tween.removeTweens(this),this.parent.removeChild(this)},e}(eui.Component);__reflect(ShowResult.prototype,"ShowResult");var Soldier=function(t){function e(){var e=t.call(this)||this;return e.s_type=0,e.bet=0,e.soldierGo=!1,e.skinName="SoldierSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setSource=function(){var t=this.soldierGo?this.soldierType+3:this.soldierType;this.soldier.source=Data.soldierImg[t],Data.source=t},e.prototype.setSoldierGo=function(){this.soldierGo=!0,this.bet=Data.bet,this.s_name.text=Data.soldier[this.soldierType+3]+"x"+this.bet,this.setSource()},Object.defineProperty(e.prototype,"soldierType",{get:function(){return this.s_type},set:function(t){this.s_type=t,this.setSource()},enumerable:!0,configurable:!0}),e.prototype.soldierBack=function(){this.soldierGo=!1,this.bet=0,this.s_name.text=Data.soldier[this.soldierType+3],this.setSource()},e.prototype._loseHarf=function(){this.loseHarf.stop(),this.loseHarf.play()},e.prototype._loseAll=function(){this.loseAll.stop(),this.loseAll.play()},e}(eui.Component);__reflect(Soldier.prototype,"Soldier");var SoldierGroup=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),Data.soldiersGroup=[this.soldier0,this.soldier1,this.soldier2];for(var e=0,i=0,o=Data.soldiersGroup;i<o.length;i++){var s=o[i];e++,s.s_name.text=Data.soldier[e+2],s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setSoldierGo,this)}this.fight.addEventListener(egret.TouchEvent.TOUCH_TAP,this._fight,this)},e.prototype._fight=function(){Music.PlayChoose(),this.dispatchEventWith("fight"),this.fight.visible=!1},e.prototype.setSoldierGo=function(t){Music.PlayChoose(),this.fight.visible=!0;var e=t.currentTarget;if(!e.soldierGo){for(var i=0,o=Data.soldiersGroup;i<o.length;i++){var s=o[i];
s.alpha=.5,s.soldierBack()}e.alpha=1}e.setSoldierGo()},e.prototype.soldierBack=function(){for(var t=0,e=Data.soldiersGroup;t<e.length;t++){var i=e[t];i.alpha=1,i.soldierBack()}},e}(eui.Component);__reflect(SoldierGroup.prototype,"SoldierGroup");var DiamondsItem=function(t){function e(e){var i=t.call(this)||this;return i.data={money:"10",diamonds:"6"},i.data=e,i.skinName="DiamondsItemSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){this.money.text="￥"+this.data.money+" 购买",this.diamonds.text=this.data.diamonds,this.award.text="额外赠送"+this.data.award+"金豆",this.money.addEventListener(egret.TouchEvent.TOUCH_TAP,this.go,this)},e.prototype.go=function(){window.top.location.href="/pay/pay/index/num/"+this.data.money+"/type/2"},e}(eui.Component);__reflect(DiamondsItem.prototype,"DiamondsItem");var PayItem=function(t){function e(e){var i=t.call(this)||this;return i.data={money:"10",award:"6",coin:"12"},i.data=e,i.skinName="PayItemSkin",i.addEventListener(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.money.text="￥"+this.data.money+" 购买",this.coin.text=this.data.coin,this.award.text="额外赠送"+this.data.award+"金豆",this.money.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.top.location.href="/pay/pay/index/num/"+t.data.money},this)},e}(eui.Component);__reflect(PayItem.prototype,"PayItem");var PayPanel=function(t){function e(){var e=t.call(this)||this;return e.host=Data.local_url,e.api="/index/Recharge/getRechargeList",e.userApi="/index/user/getInfo",e.content=[],e.api=e.host+e.api,e.userApi=e.host+e.userApi,e.skinName="PayPanelSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.no,e),e.auto_zh.addEventListener(eui.UIEvent.CHANGE,e.reload,e),e}return __extends(e,t),e.prototype.no=function(t){t.stopImmediatePropagation()},e.prototype.init=function(){var t=this;this.width=this.stage.stageWidth,this.height=this.stage.stageHeight,this.close_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.parent&&t.parent.removeChild(t)},this)},e.prototype.reload=function(){Http.get(this.userApi).addEventListener(egret.Event.COMPLETE,this.setCoin,this),this.clearChild(),this.scroller.viewport.scrollV=0;var t=this.auto_zh.selected;t?(Http.get(this.api).addEventListener(egret.Event.COMPLETE,this.createList,this),this.title.text="充值金豆"):(Http.get(this.api).addEventListener(egret.Event.COMPLETE,this.diamondsList,this),this.title.text="充值钻石")},e.prototype.setCoin=function(t){var e=t.currentTarget,i=JSON.parse(e.response);i.err||(this.coin.text=i.data.money,this.diamonds.text=i.data.diamonds)},e.prototype.clearChild=function(){this.loading_group.visible=!0;var t=this.content;if(0!=t.length)for(var e=0,i=t;e<i.length;e++){var o=i[e];o.parent.removeChild(o)}this.content=[]},e.prototype.createList=function(t){var e=t.currentTarget,i=JSON.parse(e.response);if(!i.err){this.loading_group.visible=!1;for(var o=0,s=i.data;o<s.length;o++){var n=s[o],r=new PayItem(n);this.content.push(r),this.scroller_box.addChild(r)}}},e.prototype.diamondsList=function(t){var e=t.currentTarget,i=JSON.parse(e.response);if(!i.err){this.loading_group.visible=!1;for(var o=0,s=i.data;o<s.length;o++){var n=s[o],r=new DiamondsItem(n);this.content.push(r),this.scroller_box.addChild(r)}}},e}(eui.Component);__reflect(PayPanel.prototype,"PayPanel");