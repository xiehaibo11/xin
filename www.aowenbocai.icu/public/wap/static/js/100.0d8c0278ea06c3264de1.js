webpackJsonp([100],{JdX7:function(t,e){},iJl1:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("XYHu"),n=s("V/qW"),a={name:"exchange",components:{inputNumber:i.a,SafeCheck:n.a},data:function(){return{active:0,num:1,orderVisible:!1,loading:!1,telYzm:"",emailYzm:"",safePwd:"",changeWay:0}},computed:{exchangeInfo:function(){return this.$store.state.setting.getmoney_info},getmoney_low:function(){return this.$store.state.setting.getmoney_low},contentH:function(){var t=this.exchangeInfo?314:254;return this.$store.state.clientHeight-t},tel:function(){return this.$store.state.userinfo.tel},exchangeList:function(){return this.$store.state.exchangeList},setting:function(){return this.$store.state.setting},coin:function(){return this.$store.state.setting.lottery_unit},accountMoney:function(){return this.$store.state.userinfo.money},lockSafePwd:function(){return 1!==this.$store.state.lockInfo.safe_pwd},lockTel:function(){return 1!==this.$store.state.lockInfo.tel},lockEmail:function(){return 1!==this.$store.state.lockInfo.email},isYzm:function(){return 1==this.$store.state.setting.tel_checked},isEmail:function(){return 1==this.$store.state.setting.email_checked},isChose:function(){var t=0;return this.isYzm&&(t+=1),this.isEmail&&(t+=1),!!t},money:function(){return this.exchangeList.length?this.exchangeList[this.active].integral:""},name:function(){return this.exchangeList.length?this.exchangeList[this.active].name:""},id:function(){return this.exchangeList.length?this.exchangeList[this.active].id:""}},methods:{checkTel:function(){var t=this;this.lockTel?this.changeWay=1:this.$messagebox.confirm("您还未绑定手机，立即去绑定?").then(function(){t.$router.push({path:"/setTel"})}).catch(function(t){})},checkEmail:function(){var t=this;this.lockEmail?this.changeWay=2:this.$messagebox.confirm("您还未绑定邮箱，立即去绑定?").then(function(){t.$router.push({path:"/setEmail"})}).catch(function(t){})},checkSafePwd:function(){var t=this;this.lockSafePwd?this.changeWay=3:this.$messagebox.confirm("您还未设置安全密码，立即去设置?").then(function(){t.$router.push({path:"/setSafePwd"})}).catch(function(t){})},choseEx:function(t){this.active=t},goPay:function(){this.$router.push({path:"/pay",query:{redirect:this.$route.path}})},submitOrder:function(){this.$store.dispatch("getSystemSet"),this.money*this.num<this.getmoney_low?this.$messagebox("提示","最低兑换金额为"+this.getmoney_low+this.coin):this.setting.ure_times<1?this.$toast("今日剩余兑换次数已用完！"):parseInt(this.setting.isTochange)?-1!=this.active?(this.$store.dispatch("getUserInfo"),this.orderVisible=!0):this.$toast("请选择兑换内容!"):this.$toast("兑换时间为 "+this.setting.getmoney_startime+" - "+this.setting.getmoney_endtime)},exchangeSuc:function(){this.active=0,this.num=1,this.orderVisible=!1,this.loading=!1,this.telYzm="",this.emailYzm="",this.safePwd="",this.$store.dispatch("getSystemSet"),this.$store.dispatch("getUserInfo")},payment:function(){var t=this,e=void 0,s=void 0;if(0!=this.changeWay){if(1==this.changeWay){if(!this.telYzm)return this.$toast("请输入验证码"),!1;s=1,e=this.telYzm}else if(2==this.changeWay){if(!this.emailYzm)return this.$toast("请输入验证码"),!1;s=2,e=this.emailYzm}else if(3==this.changeWay){if(!this.lockSafePwd)return void this.$messagebox("提示","请先设置安全密码");if(!this.safePwd.toString().length)return this.$toast("请输入安全密码"),!1;s=3,e=this.safePwd}this.loading=!0,this.$axios.post("/web/user/exchangeGift",{changeWay:s,yzm:e,num:this.num,id:this.id}).then(function(e){var s=e.data;s.err||t.exchangeSuc(),t.$messagebox("提示",s.msg),t.loading=!1}).catch(function(t){console.log(t)})}else this.$toast("请选择1种安全验证方式")}},created:function(){this.$store.dispatch("getExchangeList"),this.$store.commit("setKeepAlivePage","exchange"),this.isYzm||this.isEmail||(this.changeWay=3)},beforeRouteLeave:function(t,e,s){"/exchangeRecord"==t.path||"/pay"==t.path?this.$store.commit("setKeepAlivePage","exchange"):this.$store.commit("delKeepAlivePage","exchange"),s()}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("mt-header",{attrs:{title:"兑换中心"}},[s("mt-button",{attrs:{slot:"left",icon:"back"},nativeOn:{click:function(e){return t.$router.goBack(-1)}},slot:"left"}),t._v(" "),s("router-link",{attrs:{slot:"right",to:"/exchangeRecord"},slot:"right"},[s("div",{staticClass:"f-sm"},[t._v("我的兑换")])])],1),t._v(" "),s("div",{staticClass:"mt-sm c-3 f-sm tc"},[t._v("每天兑换时间"+t._s(t.setting.getmoney_startime)+"~"+t._s(t.setting.getmoney_endtime)+" 今日剩余 "),s("em",{staticClass:"org"},[t._v(t._s(t.setting.ure_times))]),t._v(" 次")]),t._v(" "),s("div",{staticClass:"exchange-box mt-sm"},[s("div",{staticClass:"border-bottom-1px tel-info"},[s("p",[t._v(t._s(t.tel)+" "),s("router-link",{staticClass:"link f-common",staticStyle:{"text-decoration":"underline"},attrs:{to:"/changeTel"}},[t._v("修改")])],1),t._v(" "),s("p",{staticClass:"f-sm suc mt-sm"},[t._v("账号绑定号码")])]),t._v(" "),t.exchangeInfo?s("div",{staticClass:"title org f-sm",staticStyle:{height:"60px"}},[t._v("兑换说明："+t._s(t.exchangeInfo))]):t._e(),t._v(" "),s("div",{staticClass:"contentH",style:{height:t.contentH+"px"}},[s("ul",{staticClass:"change-list clearfloat"},t._l(t.exchangeList,function(e,i){return s("li",[s("div",{staticClass:"list",class:[{active:t.active==i},{disabled:0==e.has_num}],on:{click:function(e){return t.choseEx(i)}}},[s("p",{staticClass:"value"},[s("b",[t._v(t._s(e.name))])]),t._v(" "),s("p",{staticClass:"money f-mini c-3"},[t._v("售价"),s("em",{staticClass:"org f-sm"},[t._v(t._s(e.integral))]),s("em",{staticClass:"f-mini c-3"},[t._v(t._s(t.coin))])]),t._v(" "),t.active==i?s("i",{staticClass:"iconfont icon-anonymous-iconfont"}):t._e()])])}),0)])]),t._v(" "),s("div",{staticClass:"account-box"},[s("p",[t._v("当前账户余额："),s("em",{staticClass:"f-sm org"},[t._v(t._s(t.accountMoney))]),t._v(" "+t._s(t.coin))])]),t._v(" "),s("div",{staticClass:"foot"},[s("div",{staticClass:"foot-1 border-top-1px"},[t._v("\n            兑换"),s("strong",{staticClass:"red"},[t._v(t._s(t.name||"请选择"))]),t._v(",\n            需消耗"),s("strong",{staticClass:"red"},[t._v(t._s(t.money*t.num))]),t._v(t._s(t.coin)+"\n            "),t.getmoney_low<=t.money*t.num&&t.accountMoney<t.money*t.num?s("em",{staticClass:"tips",staticStyle:{padding:"0 0 0 5px","font-size":"11px"}},[t._v("账户余额不足")]):t._e(),t._v(" "),t.getmoney_low>t.money*t.num?s("em",{staticClass:"tips",staticStyle:{"font-size":"11px"}},[t._v("最低兑换金额"+t._s(t.getmoney_low))]):t._e()]),t._v(" "),s("div",{staticClass:"foot-2 flex-box"},[s("div",[s("em",{staticClass:"c-4"},[t._v("兑换数量 ")]),s("input-number",{attrs:{min:1},model:{value:t.num,callback:function(e){t.num=e},expression:"num"}})],1),t._v(" "),s("div",{staticClass:"flex tr"},[s("button",{staticClass:"bet-btn btn-sure",on:{click:t.submitOrder}},[t._v("提交订单")])])])]),t._v(" "),s("mt-popup",{attrs:{position:"bottom"},model:{value:t.orderVisible,callback:function(e){t.orderVisible=e},expression:"orderVisible"}},[t.orderVisible?s("div",{staticClass:"orders-info"},[s("div",{staticClass:"order-title org border-bottom-1px"},[t._v("订单信息确认")]),t._v(" "),s("div",{staticClass:"order-info"},[s("div",[s("span",{staticClass:"name"},[t._v("兑换内容:")]),t._v(" "),s("span",{staticClass:"info"},[t._v(t._s(t.name))])]),t._v(" "),s("div",[s("span",{staticClass:"name"},[t._v("兑换数量:")]),t._v(" "),s("span",{staticClass:"info"},[t._v(t._s(t.num))])]),t._v(" "),s("div",[s("span",{staticClass:"name"},[t._v("兑换总额:")]),t._v(" "),s("span",{staticClass:"info"},[t._v(t._s(t.money*t.num)+" "+t._s(t.coin))])]),t._v(" "),s("div",[s("span",{staticClass:"name"},[t._v("账户余额:")]),t._v(" "),s("span",{staticClass:"info"},[s("em",[t._v(t._s(t.accountMoney))]),t._v(" "+t._s(t.coin))]),t._v(" "),t.accountMoney<t.money*t.num?s("span",{staticClass:"tips tc",staticStyle:{"font-size":"14px",color:"#333"}},[s("b",{staticClass:"red"},[t._v("（余额不足，请充值!）")])]):t._e()])]),t._v(" "),[s("div",{staticClass:"relative"},[s("div",{staticClass:"input-title"},[s("em",{staticClass:"red"},[t._v("*")]),t._v(" 安全验证")]),t._v(" "),t.isChose&&0==t.changeWay?s("div",{},[t.isYzm?s("mt-cell",{attrs:{title:"验证已绑定手机",label:"已绑定手机且该手机能接收短信","is-link":""},nativeOn:{click:function(e){return t.checkTel(e)}}},[s("i",{staticClass:"iconfont icon-ai-bind-cel",attrs:{slot:"icon"},slot:"icon"})]):t._e(),t._v(" "),t.isEmail?s("mt-cell",{attrs:{title:"验证已绑定邮箱",label:"已绑定邮箱且该邮箱能接收邮件","is-link":""},nativeOn:{click:function(e){return t.checkEmail(e)}}},[s("i",{staticClass:"iconfont icon-mail",attrs:{slot:"icon"},slot:"icon"})]):t._e(),t._v(" "),s("mt-cell",{attrs:{title:"验证安全密码",label:"已设置的安全密码","is-link":""},nativeOn:{click:function(e){return t.checkSafePwd(e)}}},[s("i",{staticClass:"iconfont icon-mima1",attrs:{slot:"icon"},slot:"icon"})])],1):t._e(),t._v(" "),t.isChose&&t.changeWay?s("a",{staticClass:"link f-sm change-way-link",staticStyle:{"text-decoration":"underline"},on:{click:function(e){t.changeWay=0}}},[t._v("更换验证方式")]):t._e(),t._v(" "),[s("safe-check",{directives:[{name:"show",rawName:"v-show",value:1==t.changeWay,expression:"changeWay == 1"}],attrs:{url:"/web/user/sendExchangeMsg","check-way":1},model:{value:t.telYzm,callback:function(e){t.telYzm=e},expression:"telYzm"}})],t._v(" "),[s("safe-check",{directives:[{name:"show",rawName:"v-show",value:2==t.changeWay,expression:"changeWay == 2"}],attrs:{url:"/web/user/sendExchangeEmail","check-way":2},model:{value:t.emailYzm,callback:function(e){t.emailYzm=e},expression:"emailYzm"}})],t._v(" "),3==t.changeWay?[t.lockSafePwd?s("mt-field",{attrs:{label:"安全密码",placeholder:"请输入安全密码",type:"password"},model:{value:t.safePwd,callback:function(e){t.safePwd=e},expression:"safePwd"}},[s("div",{staticClass:"btn-yzm f-sm"},[s("router-link",{staticStyle:{color:"#0c6ad4"},attrs:{to:"/changeSafePwd"}},[t._v("忘记密码？")])],1)]):s("div",{staticClass:"red f-sm",staticStyle:{padding:"0 15px"}},[t._v("\n                            您还没有设置安全密码  "),s("router-link",{attrs:{to:"/setSafePwd"}},[s("mt-button",{attrs:{size:"small"}},[t._v("立即去设置")])],1)],1)]:t._e()],2)],t._v(" "),s("div",{staticClass:"order-footer tr"},[s("mt-button",{staticClass:"cancel",attrs:{size:"small"},on:{click:function(e){t.orderVisible=!1}}},[t._v("取消")]),t._v(" "),t.accountMoney<t.money*t.num?s("mt-button",{attrs:{type:"primary",size:"small"},on:{click:t.goPay}},[t._v("立即充值")]):s("mt-button",{attrs:{type:"primary",size:"small"},on:{click:t.payment}},[t.loading?s("mt-spinner",{staticClass:"btn-loading",attrs:{slot:"icon",type:3,size:15,color:"#fff"},slot:"icon"}):t._e(),t._v("\n                    确定兑换\n                ")],1)],1)],2):t._e()])],1)},staticRenderFns:[]};var c=s("VU/8")(a,o,!1,function(t){s("JdX7")},"data-v-013f319c",null);e.default=c.exports}});