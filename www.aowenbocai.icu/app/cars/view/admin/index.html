{include file='admin@common/head' /}
<link rel="stylesheet" href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css">
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<style>
    .add-botton {
        float: right;
        margin-right: 30px;
    }
	.add-input {
        float: right;
        margin-right: 30px;
    }
	.carsper{width:80px !important}
	.addGoods{
		margin-top: 10px;
		display: none;
	}
	.split{margin: 0 5px;}
	.open{color:rgb(52, 226, 8)}
	.stopUse{color:rgb(202, 69, 29)}
</style>
<nav class="plugin_nav">
	<a class="nav_active">汽车列表</a>
    <a class="" href="{:url('changeSp')}">概率设置</a>
    <a class="" href="{:url('getOpenList')}">开奖记录</a>
    <!--<a href="{:url('addList')}" class="btn btn-info" role="button">添加汽车</a>-->
</nav>
<div id="app" class="box-padding">
<div class="breadcrumb">
	<ol class="">
		<li class="active"><i class="glyphicon glyphicon-link"></i> 汽车列表</li>
	</ol>
	<form class="form-inline" action="">
        <div class="fl">
            <div class="form-group form-group-left">
                <label>游戏盈利</label>
                <input type="text" class="form-control carsper" value='{$carsper}' onkeyup="value=value.replace(/[^\d\.]/g,'')"> %
                <a class="btn btn-info carsper_post" data-id = '{$carsper}'>设置</a>
            </div>
            <div class="form-group form-group-left">
                <label>关键字</label>
                <input type="text" name="words" class="form-control" value="{$query.words}" placeholder="汽车品牌">
            </div>
            <div class="form-group form-group-left">
                <button type="submit" class="btn btn-default form-group-left btn-sm">搜索</button>
            </div>
	</form>
</div>
</div>
    <div class="table_box">
        <table class="table table-striped table-bordered table-hover">
		<thead>
			<tr>
				<th>汽车ID</th>
				<th>汽车品牌</th>
				<th>标识</th>
				<th>奖金倍数</th>
				<th>概率</th>
				<th>状态</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
			{foreach $list as $item}
			<tr>
				<td>{$item.id}</td>
				<td>{$item.name}</td>
				<td>{$item.sign}</td>
				<td>{$item.multiple}</td>
				<td>{$item.sp}</td>
				<td>
					{eq name = "$item.status" value = "1"}
					<span class="open">已启用</span><span class="split">|</span><a href="{:url('setStatus',['value'=> 0,'id' => $item.id])}">禁用</a>
					{else /}
					<span class="stopUse">已禁用</span><span class="split">|</span><a href="{:url('setStatus',['value'=> 1,'id' => $item.id])}">启用</a>
					{/eq}
				</td>
				<td>
					<div class="btn-group" role="group" aria-label="...">
						<a class="btn btn-info btn-xs" href="{:url('edit', ['id' => $item.id])}">修改</a>
					  <!--<button class="btn btn-info btn-xs isdelete" data-href="{:url('remove', ['id' => $item.id])}">删除</button>-->
					</div>
				</td>
			</tr>
			{/foreach}
		</tbody>
	</table>
    </div>
	{$list->render()}
</div>
<script>
	$('.remove').click(function() {
		var href = $(this).data('href');
		$.modal.confirm('你是否确定删除', ()=>{
			location.href = href;
		});
	});
	$(".carsper_post").click(function(){
		var before = $(this).data('id');
		var now = $(".carsper").val();
		 if(before == now){
		 	$.modal.alert('盈利未修改');
		 	return;
		 }
		if(now > 100){
			$.modal.alert('盈利率不能大于100%');
			return;
		}
		$.post("{:url('setCarsper')}", {value: now}, function(res){
			$.modal.alert(res.msg);
			if(!res.err){
				setTimeout(() => {
					location.reload();
				}, 2000);
			}
		})
	})
</script>
{include file='admin@common/foot' /}
