{include file='web@common/islogin_head' title='$title'/}
<link rel="stylesheet" type="text/css"  href="/static/vipweb/css/game_lottery.css">
<script src="/static/vipweb/vue-component/module-login.js"></script>
<div class="lottery-bg">
    <div id="app" class="web game-lottery lottery-ks" v-cloak>
        <!--logindialog start-->
        <login-info site-name="{$site_name}" @login-success="loginSuccess" @login-out="loginOut" msg-num="{$msgNum}" :nickname="nickname" :login-visible="loginVisible"
                    reg-url="{:url('reg/index')}" my-url="{:url('user/my')}" @open-dialog="loginVisible = true" @close-dialog="loginVisible = false" @refresh="refreshMoney"
                    :money="accountMoney">
        </login-info>
        <!--logindialog end-->
        <div style="position: relative">
            <div class="stop_selling" v-if="pause">
                <div class="stop_selling_title"><img src="/static/vipweb/images/stop_selling_title.png" alt=""></div>
            </div><!--暂停销售-->
            <div class="head-ks cf">
                <!--彩种信息 start-->
                <div class="head-item lottery-logo">
                    <div class="lottery-img"><img class="game-icon" src="/static/vipweb/images/test-bjpc28.png" alt=""></div>
                    <h3 class="lottery-name">{$lottery.title}</h3>
                    <div class="lottery-info-sum"><em>{{jgTime}}</em>分钟一期，每天<em>{{defaultInfo.totalIssue}}</em>期</div>
                </div>
                <!--彩种信息 end-->
                <!--倒计时 start-->
                <div class="head-item lottery-info">
                    <div class="tc">
                        <strong>距 <b class="red">{{defaultInfo.issue}}</b> 期投注截止还有：</strong>
                    </div>
                    <div class="time flex-box" style="justify-content: center">
                        <i class="el-icon-time"></i>
                        <i class="timer">{{timer}}</i>
                    </div>
                    <div class="kj-info tc">
                        <span class="kj-lost flex tr">今天已售<em class="red">{{issueAfter}}</em>期，还剩<em class="red">{{defaultInfo.totalIssue - issueAfter}}</em>期</span>
                        <span class="kj-time flex tl">销售时间：{{defaultInfo.start_time}}-{{defaultInfo.end_time}}</span>
                    </div>
                </div>
                <!--倒计时 end-->
                <!--开奖区 start-->
                <div class="head-item lottery-kj">
                    <div class="kj-issue tc">
                        <strong>第 <b class="red">{{defaultInfo.expect}}</b> 期开奖号码：</strong>
                    </div>
                    <div class="kj-num-pc28">
                        <ul class="cf">
                            <li class="code">
                                <template v-if="Number((defaultInfo.awardNumber && defaultInfo.awardNumber[0]) ? defaultInfo.awardNumber[0] : -1) !== -1">{{(defaultInfo.awardNumber && defaultInfo.awardNumber[0]) ? defaultInfo.awardNumber[0] : 0}}</template>
                                <template v-else>开</template>
                            </li>
                            <li>+</li>
                            <li class="code">
                                <template v-if="Number((defaultInfo.awardNumber && defaultInfo.awardNumber[1]) ? defaultInfo.awardNumber[1] : -1) !== -1">{{(defaultInfo.awardNumber && defaultInfo.awardNumber[1]) ? defaultInfo.awardNumber[1] : 0}}</template>
                                <template v-else>奖</template>
                            </li>
                            <li>+</li>
                            <li class="code">
                                <template v-if="Number((defaultInfo.awardNumber && defaultInfo.awardNumber[2]) ? defaultInfo.awardNumber[2] : -1) !== -1">{{(defaultInfo.awardNumber && defaultInfo.awardNumber[2]) ? defaultInfo.awardNumber[2] : 0}}</template>
                                <template v-else>中</template>
                            </li>
                            <li>=</li>
                            <li class="code code-result" :style="{backgroundColor: pcResult(CodeXt[0])}">
                                <template v-if="Number((defaultInfo.awardNumber && defaultInfo.awardNumber[0]) ? defaultInfo.awardNumber[0] : -1) !== -1">{{CodeXt[0]}}</template>
                                <template v-else>?</template>
                            </li>
                            <li class="code-lx">
                                <span v-if="Number((defaultInfo.awardNumber && defaultInfo.awardNumber[0]) ? defaultInfo.awardNumber[0] : -1) !== -1">{{CodeXt[1]}}</span>
                                <span v-else>- , -</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <!--开奖区 end-->
            </div>
            <!--选项区 start-->
            <el-row :gutter="0" class="main">
                <el-col :span="18" style="width: 75%" class="bet-left">
                    <div class="bet-nav">
                        <ul class="bet-type-link cf">
                            <li v-for="(item,index) in navList" class="fl" style="width: 100px;" @click="tabActive(item.type,item.gain)" :class="{'active':defaultInfo.type==item.type}">
                                <a href="javascript:;" style="padding-top: 0;height: 60px;line-height: 60px;">{{item.name}}
                                    <!--<span><template v-if="item.type == 1">{{item.gain}}</template><template v-else>{{item.gain}}</template></span>-->
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="bet-b">
                        <!--选号区 start-->
                        <div class="bet-cont">
                            <!--混合投注-->
                            <div class="bet-item ks-hz" v-show="defaultInfo.type == 1">
                                <div class="bet-type-tab">
                                    <bet-pc28 :gain="navList[0].gain" :type="defaultInfo.type" :bet-model="betModel" :unit-is-open="unitIsOpen" :min-money="minMoney" @change-gain="getHhGain"
                                              :label="label" :value="value" :scale="scale" :multiple="multiple"  @bet="addToArea" :percent="maxRebate" :rebate="rebateVal" :show-words="showWords"
                                              :rebate-is-open="rebateIsOpen" :is-rebate="isRebate"></bet-pc28>
                                </div>
                            </div>
                            <!--波色-->
                            <div class="bet-item ks-hz" v-show="defaultInfo.type == 2">
                                <div class="bet-type-tab">
                                    <bet-pc28 :gain="navList[1].gain" :type="defaultInfo.type" :bet-model="betModel" :unit-is-open="unitIsOpen" :min-money="minMoney" @change-gain="getHhGain"
                                              :label="label" :value="value" :scale="scale" :multiple="multiple"  @bet="addToArea" :percent="maxRebate" :rebate="rebateVal" :show-words="showWords"
                                              :rebate-is-open="rebateIsOpen" :is-rebate="isRebate"></bet-pc28>
                                </div>
                            </div>
                            <!--豹子-->
                            <div class="bet-item ks-hz" v-show="defaultInfo.type == 3">
                                <div class="bet-type-tab">
                                    <bet-pc28 :gain="gain" :type="defaultInfo.type" :bet-model="betModel" :unit-is-open="unitIsOpen" :min-money="minMoney"
                                              :label="label" :value="value" :scale="scale" :multiple="multiple"  @bet="addToArea" :percent="maxRebate" :rebate="rebateVal" :show-words="showWords"
                                              :rebate-is-open="rebateIsOpen" :is-rebate="isRebate"></bet-pc28>
                                </div>
                            </div>
                        </div>
                        <!--选号区 end-->

                        <div class="unit-model-box">
                            <div class="unit-model-cont">
                                <div class="model-box" v-if="betModel == 1 && unitIsOpen">
                                    <model-unit @change-model="changeModel" @change-mul="changeMultiple"></model-unit><!--模式1-->
                                </div>
                                <div class="rebate-box flex-box" v-if="rebateIsOpen && isRebate">
                                    <span class="rebate-val">{{rebateVal}}%</span>
                                    <i class="el-icon-remove-outline" :class="{'disabled' : sliderValue == 0 }" style="padding-left: 3px" @click="changeRebate('sub')"></i>
                                    <span class="rebate-slider flex">
                                    <el-slider v-model="sliderValue" :show-tooltip="false" :step="0.1" :max="userRebate"></el-slider>
                                </span>
                                    <i class="el-icon-circle-plus-outline"  :class="{'disabled' : sliderValue == userRebate}" style="padding-right: 3px"  @click="changeRebate('add')"></i>
                                    <span>{{gain}}</span>
                                </div>
                            </div>
                        </div>

                        <!--投注区 start-->
                        <div class="bet-foot">
                            <div class="bet-area ks-bet-area">
                                <!--投注列表 start-->
                                <div class="bet-area-box ks-area-box">
                                    <div class="flex-box bet-area-title">
                                        <h6 class="flex c-1">投注列表</h6>
                                        <em @click="clearList"><el-button size="mini" type="primary">清空列表</el-button></em>
                                    </div>
                                    <ul class="bet-area-list">
                                        <!--模式1 默认模式 投注列表-->
                                        <li class="flex-box" v-for="(item,index) in bet.betArr">
                                            <span class="title">[{{item.type_text}}]</span>
                                            <span class="code flex">{{item.num}}</span>
                                            <template v-if="betModel == 1  && unitIsOpen"> <!--模式1 元角分厘开启 单位-->
                                                <span class="code t-h">{{item.unit}}</span>
                                            </template>
                                            <span class="notes t-h"><em>{{item.notes}}</em>注</span>
                                            <!--模式1 默认模式-->
                                            <template v-if="betModel == 1  && !unitIsOpen">
                                                <span class="notes t-h"><em>{{bet.multiple}}</em>倍</span>
                                                <span class="notes t-h"><em class="red">{{item.money * bet.multiple}}</em>{$company.lottery_unit}</span>
                                                <span class="notes t-h" v-if="rebateIsOpen && isRebate">返{{item.rebate}}%</span>
                                                <span class="notes t-h-l">可中金额：<em class="red">{{getGain(item.gain,bet.multiple)}}</em>{$company.lottery_unit}</span>
                                            </template>
                                            <!--模式1 元角分厘开启-->
                                            <template v-if="betModel == 1  && unitIsOpen">
                                                <span class="notes t-h"><em>{{item.multiple}}</em>倍</span>
                                                <span class="notes t-h"><em class="red">{{item.money}}</em>{$company.lottery_unit}</span>
                                                <span class="notes t-h" v-if="rebateIsOpen && isRebate">返{{item.rebate}}%</span>
                                                <span class="notes t-h-l">可中金额：<em class="red">{{item.gain}}</em>{$company.lottery_unit}</span>
                                            </template>
                                            <!--模式2 -->
                                            <template v-if="betModel == 2">
                                                <div class="each-set-money" style="width:200px">
                                                    每注
                                                    <el-input-number style="width:120px" v-model="item.money" :min="minMoney" label="金额" size="mini" @change="changeBetArr(item.money,index)"></el-input-number>
                                                    {$company.lottery_unit}
                                                </div>
                                                <span class="notes t-h" v-if="rebateIsOpen && isRebate">返{{item.rebate}}%</span>
                                                <span class="notes t-h-l">可中金额：<em class="red">{{getGain(item.gain,item.money)}}</em>{$company.lottery_unit}</span>
                                            </template>
                                            <a class="delete link" @click="deleteBet(index,item.notes)"><i class="el-icon-error"></i></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="bet-area-txt">
                                已选 <strong class="red">{{bet.notes}}</strong> 注，
                                <template v-if="betModel == 1 && !unitIsOpen">
                                    <el-input-number v-model="bet.multiple" :min="1" label="设置倍数" size="small" @change="changeMul"></el-input-number> 倍，
                                </template>
                                共计 <strong class="red">{{zgMoney}}</strong> {$company.lottery_unit}
                            </div>
                            <!--购买方式 start-->
                            <div class="buy-type">
                                <div class="flex-box header">
                                    <em>购买方式：</em>
                                    <el-radio-group v-model="bet.buyType">
                                        <el-radio :label="1">自购</el-radio>
                                        <el-radio :label="2" v-if="betModel == 2 && joinOpen || betModel == 1 && !unitIsOpen && joinOpen">合买</el-radio><!--购买方式 start-->
                                    </el-radio-group>
                                    <el-checkbox  v-if="betModel == 1" style="margin-left: 30px" v-model="bet.isChase" @change="doChase" size="mini">追号</el-checkbox>
                                    <div class="notes tr flex">
                                        <template v-if="bet.buyType==1">
                                            由投注人自行全额下注彩票，独享奖金
                                            <el-tooltip placement="bottom">
                                                <div slot="content">
                                                    选好投注号码后，由自己全额支付购彩{$company.lottery_unit}。<br>中奖后，自己独享全部奖金。
                                                </div>
                                                <i class="el-icon-question"></i>
                                            </el-tooltip>
                                        </template>
                                        <template v-if="bet.buyType==2">
                                            多人出资合买彩票，奖金按购买比例分享
                                            <el-tooltip  placement="bottom">
                                                <div slot="content">
                                                    <em>合买：</em>选好投注号码后，由多人出资<br>参与合买彩票。中奖后，奖金按参与<br>比例分享。
                                                </div>
                                                <i class="el-icon-question"></i>
                                            </el-tooltip>
                                        </template>
                                    </div>
                                </div><!--方式选择-->
                                <div class="buy-type-cont">
                                    <!--追号内容start-->
                                    <div  v-if="bet.isChase" :class="{'border-none': bet.buyType==2}">
                                        <div class="tab-radio-inner" style="padding: 0px">
                                            <div style="padding: 5px 10px;font-size: 13px">
                                                <template v-if="bet.isChase">
                                                    连续多期购买同一个（组）号码
                                                    <el-tooltip class="item" effect="dark" content="选好投注号码后，对期数、期号、倍数进行设置后，系统按照设置进行购买。" placement="bottom">
                                                        <i class="el-icon-question"></i>
                                                    </el-tooltip>
                                                </template>
                                            </div>
                                            <table class="chase" border="0" cellpadding="0" cellspacing="0" width="100%" style="border-bottom: 1px solid #ddd;padding-bottom: 5px;">
                                                <tr>
                                                    <th width="8%" class="tc">序号</th>
                                                    <th width="30%"><el-checkbox v-model="checkAll" @change="checkedBox"></el-checkbox> 追
                                                        <span class="chase-input"><input class="el-input__inner" v-model="chaseNum" type="tel" @blur="chaseIssue"></span>期
                                                    </th>
                                                    <th width="17%" class="tc">
                                                        <span class="chase-input"><input class="el-input__inner" v-model="chaseMul" type="tel" @blur="chaseM"></span>倍
                                                    </th>
                                                    <th width="20%" class="tc">方案金额</th>
                                                    <th width="25%" class="tc">预计开奖时间</th>
                                                </tr>
                                            </table>
                                            <div class="chase-cont">
                                                <table class="chase"  border="0" cellpadding="0" cellspacing="0"  width="100%">
                                                    <tr v-for="(item,index) in chaseData">
                                                        <td width="8%" align="center">{{index+1}}</td>
                                                        <td width="30%" >
                                                            <el-checkbox v-model="item.checked" v-if="index==0" disabled></el-checkbox>
                                                            <el-checkbox v-model="item.checked" v-else @change="checkB(index,item.checked)"></el-checkbox>
                                                            {{item.issue}} <em  class="red" style="font-size: 12px" v-if="index==0">(当前期必选)</em></td>
                                                        <td width="17%" align="center">
                                                            <span class="chase-input"><input class="el-input__inner" type="tel" v-model="item.multiple" @input="checkMul(index,item.multiple)"></span>倍
                                                        </td>
                                                        <td width="20%" align="center"><em class="red">{{item.multiple * oneMoney}}</em>{$company.lottery_unit}</td>
                                                        <td width="25%" align="center">{{item.time}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="bg foot-ts flex-box">
                                            <div class="tl flex">共追号 <b class="red">{{issueTotal}}</b> 期，总投注金额<b class="red"> {{chaseMoney}} </b>{$company.lottery_unit}</div>
                                            <div class="tr flex notes">
                                                中奖后停止追号 <el-switch v-model="isStop"></el-switch>
                                                <el-tooltip  placement="bottom-start">
                                                    <div slot="content">
                                                        <b>中奖停追：</b>勾选后，您的追号方案中的某一期中奖后，<br/>
                                                        后续的追号订单将被撤销，资金返还您的账户中。如不<br/>
                                                        勾选，系统一直帮您购买所有的追号投注任务。<br/>
                                                    </div>
                                                    <i class="el-icon-question"></i>
                                                </el-tooltip>
                                            </div>
                                        </div>
                                    </div><!--追号-->
                                    <!--合买内容start-->
                                    <div v-if="bet.buyType==2">
                                        <div class="tab-radio-inner">
                                            <div class="bet-jion">
                                                <div class="info">
                                                    我要分成：<el-input-number v-model="jion.total_share" :min="minTotalShare" :max="money" size="small" @change="checkJion" @keydown.native="channelInputLimit"></el-input-number> 份
                                                    <span class="jion-tip">每份<b class="red">{{perMoney}}</b>{$company['lottery_unit']}</span>
                                                    <span>(每份至少1{$company['lottery_unit']})</span>
                                                </div>
                                                <div class="info">
                                                    我要认购：<el-input-number v-model="jion.buy_share" :min="minJionMoney" :max="jion.total_share" size="small" @change="checkJion" @keydown.native="channelInputLimit"></el-input-number> 份
                                                    <span class="jion-tip">发起人至少认购<b class="red">5</b>%</span>
                                                    <span>(已认购<b class="red">{{isbuy}}</b>%,共<b class="red">{{countShareMoney(jion.buy_share)}}</b>{$company['lottery_unit']})</span>
                                                </div>
                                                <div class="info">
                                                    我要保底：<el-input-number v-model="jion.bd_share" :min="0" :max="bdMax" size="small" @change="isAllBd" @keydown.native="channelInputLimit"></el-input-number> 份
                                                    <el-checkbox v-model="jion.isAll" @click.native="allBd"></el-checkbox> 全额保底
                                                    <span class="jion-tip">最多可保底<b class="red">{{bdMax}}</b>份</span>
                                                    <span>(已保底<b class="red">{{bdPercent}}</b>%,共<b class="red">{{countShareMoney(jion.bd_share)}}</b>{$company['lottery_unit']})</span>
                                                </div>
                                                <div v-if="{$system['isGain']}" class="info flex-box" style="align-items: flex-start;">
                                                    <div>盈利佣金：</div>
                                                    <div class="flex">
                                                        <el-radio-group v-model="jion.gain" size="mini">
                                                            <el-radio-button label="0%"></el-radio-button>
                                                            <template v-for="n in 10">
                                                                <el-radio-button :label="n + '%'"></el-radio-button>
                                                            </template>
                                                        </el-radio-group>
                                                        <div class="jion-tip">若方案盈利，盈利佣金=奖金*佣金比例</div>
                                                    </div>
                                                </div>
                                                <div class="info flex-box">
                                                    <div>保密设置：</div>
                                                    <div>
                                                        <el-radio-group v-model="jion.infoState">
                                                            <el-radio :label="0">完全公开</el-radio>
                                                            <el-radio :label="1">截止后公开</el-radio>
                                                            <el-radio :label="2">仅跟单人可见</el-radio>
                                                            <el-radio :label="3">完全保密</el-radio>
                                                        </el-radio-group>
                                                    </div>
                                                </div>
                                                <div class="info flex-box" style="align-items: flex-start">
                                                    <div>合买宣言：</div>
                                                    <div style="width:400px">
                                                        <el-input
                                                                size="mini"
                                                                type="textarea"
                                                                :autosize="{ minRows: 2, maxRows: 4}"
                                                                placeholder="说点什么吧！"
                                                                v-model="jion.declaration">
                                                        </el-input>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bg foot-ts">
                                            您需支付：<b class="red">{{countShareMoney(jion.buy_share + jion.bd_share)}}</b> {$company['lottery_unit']}
                                            <em class="color-gray">（认购{{countShareMoney(jion.buy_share)}}{$company['lottery_unit']}+保底{{countShareMoney(jion.bd_share)}}{$company['lottery_unit']}）</em>
                                        </div>
                                    </div><!--合买-->
                                </div>
                            </div>
                            <!--购买方式 end-->
                            <!--提交-->
                            <div class="submit tc">
                                <el-button type="primary" @click.native="submit" style="font-size: 18px;margin: 10px 0;">确认提交</el-button>
                                <p>
                                    <el-checkbox v-model="bet.checked">
                                        <span>我已阅读并同意</span>
                                    </el-checkbox>
                                    <a class="link" @click="agreeVisible = true">《用户服务协议》</a>
                                    <a class="link" @click="gameVisible = true">《游戏服务协议》</a>
                                </p>
                            </div>
                        </div>
                        <!--投注区 end-->
                    </div>
                    <!--底部展示-->
                    <div class="bet-foot">
                        <today-kj :kj-code="kjCode" :total-issue="defaultInfo.totalIssue"></today-kj>
                        <my-record :record-data="recordData" @refresh="getRecordData"></my-record><!--我的投注记录-->
                    </div>
                </el-col>
                <el-col :span="6" style="width: 25%" class="bet-rig">
                    <div class="lottery-intr flex-box">
                        <a @click="playLink" class="no-bd-l flex-box">
                            <i class="el-icon-document"></i>
                            <span>玩法介绍</span>
                        </a>
                        <a class="flex-box" v-popover:popover1>
                            <i class="el-icon-question"></i>
                            <span>中奖说明</span>
                        </a>
                        <el-popover
                                ref="popover1"
                                placement="bottom"
                                title="中奖说明"
                                width="900"
                                trigger="click">
                            <div class="el-table el-table--border el-table--small" style="width: 100%; margin-top: 20px;">
                                <div>
                                    <table width="100%" class="tc" style="max-height: 450px;overflow-y: auto;display: block;">
                                        <tr class="el-table__row">
                                            <th width="20%" style="background-color: #f7f7f7"><div class="tc"  style="width: 100%;line-height: 1;">玩法组</div></th>
                                            <th width="20%" style="background-color: #f7f7f7"><div class="tc" style="width: 100%;line-height: 1">玩法</div></th>
                                            <th width="60%" style="background-color: #f7f7f7"><div class="tc" style="width: 100%;line-height: 1">玩法说明</div></th>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td rowspan="6"><span>混合</span></td>
                                            <td><div class="cell tc">大小</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为14~27为大，0~13为小，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">极大小</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为22~27为极大，0~5为极小，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">大单</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为15、17、19、21、23、25、27，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">大双</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为14、16、18、20、22、24、26，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">小单</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为1、3、5、7、9、11、13，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">小双</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为0、2、4、6、8、10、12，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td rowspan="4"><span>波色</span></td>
                                            <td><div class="cell tc">绿波</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为1、4、7、10、16、19、22、25，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">蓝波</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为2、5、8、11、17、20、23、26，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">红波</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为3、6、9、12、15、18、21、24，即为中奖。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><div class="cell tc">灰波</div></td>
                                            <td><div class="cell tl">3个开奖号码相加的和为0、13、14、27（若开出灰波号码，则投注任何波色均视为不中奖）。</div></td>
                                        </tr>
                                        <tr class="el-table__row">
                                            <td><span>豹子</span></td>
                                            <td><div class="cell tc">豹子</div></td>
                                            <td><div class="cell tl">投注当期的3个开奖号为豹子号码。3个开奖号码为同一号码，即为中奖。</div></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </el-popover>
                    </div>
                    <!--betRight-->
                    <bet-right :recent-award-data="recentAwardData" :cold="cold" :hot="hot"></bet-right>
                </el-col>
            </el-row>
            <!--选项区 end-->
        </div>
        <el-dialog
                title="提示"
                :visible.sync="dialogVisible"
                top="0"
                :lock-scroll = "false"
                width="450px"
        >
            <span style="font-size: 15px">你好，第<b class="red">{{defaultInfo.expect}}</b>期已截止，当前期是第<b class="red">{{defaultInfo.issue}}</b>期，投注时请确认选择的期号。</span>
            <span slot="footer" class="dialog-footer">
            <el-button type="primary" @click="dialogVisible = false">确 定</el-button>
        </span>
        </el-dialog>
        <!--订单信息确认-->
        <el-dialog
                title="订单信息确认"
                :visible.sync="orderVisible"
                top="0"
                :lock-scroll = "false"
                width="450px"
        >
            <div class="order-info">
                <div>
                    <span class="name">投注彩种:</span>
                    <span class="info">{$lottery.title}</span>
                </div>
                <div>
                    <span class="name">投注方式:</span>
                    <span class="info">{{order.type}}<em v-if="bet.isChase">追号</em></span>
                </div>
                <div>
                    <span class="name">投注期号:</span>
                    <span class="info">{{defaultInfo.issue}}<em v-if="bet.isChase">(追 <em class="red">{{issueTotal}}</em>期)</em></span>
                </div>
                <template v-if="bet.isChase"><!--追号显示-->
                    <div>
                        <span class="name">方案金额:</span>
                        <span class="info"><b class="red">{{zgMoney}}</b> {$company['lottery_unit']}</span>
                    </div>
                </template>
                <template v-if="bet.buyType==2"><!--合买显示-->
                    <div>
                        <span class="name">投注总额:</span>
                        <span><b class="red" v-if="bet.isChase">{{chaseMoney}}</b><b class="red" v-else>{{zgMoney}}</b> {$company['lottery_unit']}</span>
                    </div>
                    <div>
                        <span class="name">认购金额:</span>
                        <span><b class="red">{{order.money}}</b> {$company['lottery_unit']} <em class="info">(认购{{countShareMoney(jion.buy_share)}}{$company['lottery_unit']} + 保底{{countShareMoney(jion.bd_share)}}{$company['lottery_unit']})</em></span>
                    </div>
                    <div  v-if="{$system['isGain']}">
                        <span class="name">盈利佣金:</span>
                        <span>{{jion.gain}}</span>
                    </div>
                </template>
                <template v-else>
                    <div>
                        <span class="name" v-if="bet.isChase">投注总额:</span>
                        <span class="name" v-else>方案金额:</span>
                        <span class="info"><b class="red">{{order.money}}</b> {$company['lottery_unit']}</span>
                    </div>
                </template>
                <div v-if="betModel == 1 && !unitIsOpen && !bet.isChase">
                    <span class="name">投注倍数:</span>
                    <span class="info"><b class="red">{{bet.multiple}}</b> 倍</span>
                </div>
                <div>
                    <span class="name">账户余额:</span>
                    <span class="info">{{formatMoney}} {$company['lottery_unit']}</span>
                </div>
            </div>
            <div class="tips tc" v-if="accountMoney < order.money" style="font-size: 14px;color: #333">
                您的<b class="red">账户余额不足</b>，请先充值!
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="orderVisible = false">取消</el-button>
                <el-button v-if="accountMoney < order.money" type="primary" @click="goPay">立即充值</el-button>
                <el-button v-else type="primary" @click="submitOrder" :disabled="notDo">确定购买</el-button>
            </span>
        </el-dialog>
        <!--用户服务协议-->
        <el-dialog
                title="用户服务协议"
                :visible.sync="agreeVisible"
                :lock-scroll = false :center="true"
                top = 0
                width="60%">
            <div class="service-cont">{$company.user_web}</div>
            <span slot="footer" class="dialog-footer">
            <el-button type="primary" @click="agreeVisible = false">我知道了</el-button>
         </span>
        </el-dialog>
        <!--游戏户服务协议-->
        <el-dialog
                title="游戏服务协议"
                :visible.sync="gameVisible"
                :lock-scroll = false :center="true"
                top = 0
                width="60%">
            <div class="service-cont">{$company.web_service}</div>
            <span slot="footer" class="dialog-footer">
            <el-button type="primary" @click="gameVisible = false">我知道了</el-button>
         </span>
        </el-dialog>
    </div>
</div>
<!--投注--右侧内容-->
<template id="betRight">
    <div>
        <div class="concent-award">
            <div class="bt">近期开奖</div>
            <table border="0" cellspacing="0" cellpadding="0" width="100%">
                <tr class="title">
                    <td width="26%">期号</td>
                    <td width="40%">开奖号</td>
                    <td width="16%">形态</td>
                    <td width="18%">色波</td>
                </tr>
                <tr v-for="(item,index) in recentAwardData"  v-if="index < 10">
                    <td v-if="!expect_type">{{item.expect | slice}}</td>
                    <td v-else>{{item.expect}}</td>
                    <td>
                        <div class="cf pc28-tencode">
                            <span class="fl pc28-code">{{item.code[0]}}</span>
                            <span class="fl">+</span>
                            <span class="fl pc28-code">{{item.code[1]}}</span>
                            <span class="fl">+</span>
                            <span class="fl pc28-code">{{item.code[2]}}</span>
                            <span class="fl">=</span>
                            <span class="fl pc28-he" :style="{'backgroundColor' : pcResult(item.he).bg_color}">{{item.he}}</span>
                        </div>
                    </td>
                    <td>{{item.xt[0]}},{{item.xt[1]}}</td>
                    <td><span class="pc28-sb" :style="{'backgroundColor' : pcResult(item.he).bg_color}">{{pcResult(item.he).text_color}}</span></td>
                </tr>
            </table>
            <div class="tr">
                <a v-if="!expect_type" :href="'{:url('./history')}' + '/index/name/' + historyName" target="_blank" class="link">查询历史开奖</a>
                <a v-else :href="'{:url('./history')}' + '/all_list/name/' + historyName" target="_blank" class="link">查询历史开奖</a>
            </div>
        </div>
        <div class="trend-lr">
            <div class="title">
                <span>出号统计</span>
                <div class="type tabs">
                    <span :class="{'active':coldNum}" style="border-right: none" @click="coldNum=true">冷号</span><span  @click="coldNum=false" :class="{'active':!coldNum}">热号</span>
                </div>
            </div>
            <div class="cont">
                <div class="cold-num numbers" v-if="coldNum">
                    <p class="muted">最近100期内出现次数最少的号码</p>
                    <ul>
                        <li v-for="item in cold">
                            <span class="ball ball-red">{{item.code}}</span>
                            <span class="line flex"><em :style="{width:(item.num/coldMax * 100) + '%' }"></em></span>
                            <span class="num"><em class="red">{{item.num}}</em>次</span>
                        </li>
                    </ul>
                </div>
                <div class="hot-num numbers" v-else>
                    <p class="muted">最近100期内出现次数最多的号码</p>
                    <ul>
                        <li v-for="item in hot">
                            <span class="ball ball-red">{{item.code}}</span>
                            <span class="line flex"><em :style="{width:(item.num/hotMax * 100) + '%' }"></em></span>
                            <span class="num"><em class="red">{{item.num}}</em>次</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>
<!--底部 今日开奖号-->
<template id="todayKj">
    <div class="lottery-award-all" style="border:none;">
        <div class="head flex-box" style="border-color: #eaeaea;border-width: 1px 0 1px 0;margin-bottom: 0" @click="isShow = !isShow">
            <span class="flex name">今日开奖号码</span>
            <span class="change" v-if="!isShow">展开 <i class='el-icon-arrow-down'></i></span>
            <span class="change" v-else>关闭 <i class='el-icon-arrow-up'></i></span>
        </div>
        <el-collapse-transition>
            <div class="flex-box cont" v-show="isShow">
                <template v-if="!expect_type"> <!--日期型-->
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="20%">期次</td>
                                <td width="80%">开奖号码</td>
                            </tr>
                            <tr v-for="n in column">
                                <td width="20%">{{checkUp(n)[0]}}</td>
                                <td width="80%" :class="{'red' : kjCode[checkUp(n)[1]]}">{{kjCode[checkUp(n)[1]] || '--'}}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="20%">期次</td>
                                <td width="80%">开奖号码</td>
                            </tr>
                            <tr v-for="n in column">
                                <td width="20%">{{checkUp(n + column)[0]}}</td>
                                <td width="80%" :class="{'red' : kjCode[checkUp(n + column)[1]]}">{{kjCode[checkUp(n + column)[1]] || '--'}}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="20%">期次</td>
                                <td width="80%">开奖号码</td>
                            </tr>
                            <tr v-for="n in totalIssue-column*2">
                                <td width="20%">{{checkUp(n + column*2)[0]}}</td>
                                <td width="80%" :class="{'red' : kjCode[checkUp(n + column*2)[1]]}">{{kjCode[checkUp(n + column*2)[1]] || '--'}}</td>
                            </tr>
                        </table>
                    </div>
                </template>
                <template v-else><!--累加型-->
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="28%">期次</td>
                                <td width="72%">开奖号码</td>
                            </tr>
                            <tr v-for="n in column">
                                <td width="28%">{{firstIssue + n - 1}}</td>
                                <td width="72%" class="red" v-if="kjCode.hasOwnProperty(firstIssue + n - 1)">{{kjCode[firstIssue + n - 1]}}</td>
                                <td width="72%" v-else>--</td>
                            </tr>
                        </table>
                    </div>
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="28%">期次</td>
                                <td width="72%">开奖号码</td>
                            </tr>
                            <tr v-for="n in column">
                                <td width="28%">{{firstIssue + n + column - 1}}</td>
                                <td width="72%" class="red" v-if="kjCode.hasOwnProperty(firstIssue + n + column - 1)">{{kjCode[firstIssue + n + column - 1]}}</td>
                                <td width="72%" v-else>--</td>
                            </tr>
                        </table>
                    </div>
                    <div class="all-num">
                        <table border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="28%">期次</td>
                                <td width="72%">开奖号码</td>
                            </tr>
                            <tr v-for="n in totalIssue-column*2">
                                <td width="28%">{{firstIssue + n + column*2 - 1}}</td>
                                <td width="72%" class="red" v-if="kjCode.hasOwnProperty(firstIssue + n + column*2 - 1)">{{kjCode[firstIssue + n + column*2 - 1]}}</td>
                                <td width="72%" v-else>--</td>
                            </tr>
                        </table>
                    </div>
                </template>
            </div>
        </el-collapse-transition>
    </div>
</template>
<!--底部 我的投注记录-->
<template id="myRecord">
    <div class="lottery-award-all" style="border:none;">
        <div class="head flex-box" style="border-color: #eaeaea;border-width: 1px 0 1px 0;margin-bottom: 0;margin-top: 0;" @click="isShow=!isShow">
            <span class="flex name">我的投注记录<em class="f13 c-2">（最多显示最近20条记录）</em></span>
            <span class="change" v-if="!isShow">展开 <i class='el-icon-arrow-down'></i></span>
            <span class="change" v-else>关闭 <i class='el-icon-arrow-up'></i></span>
        </div>
        <el-collapse-transition>
            <div class="flex-box cont" v-show="isShow">
                <el-table
                        :data="recordData"
                        style="width: 100%">
                    <el-table-column prop="BuyInfo.lottery_id" label="方案编号"  width="175"></el-table-column>
                    <el-table-column prop="BuyInfo.expect" label="期号"></el-table-column>
                    <el-table-column label="合买" width="50">
                        <template slot-scope="scope">
                            <span :class="{'red': scope.row.BuyInfo.is_join}">{{scope.row.BuyInfo.is_join ? '是' : '否'}}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="money" label="投注金额" sortable width="100">
                        <template slot-scope="scope">
                            <span>{{scope.row.money}}{$system.lottery_unit}</span>
                        </template>
                    </el-table-column>
                    <el-table-column label="方案状态" width="100">
                        <template slot-scope="scope">
                    <span v-if="scope.row.BuyInfo.statusCode == 0">
                        <template v-if="scope.row.BuyInfo.is_join">
                             <em v-if="!scope.row.BuyInfo.finsh">合买中</em>
                             <em v-else>未出票</em>
                        </template>
                        <template v-else>
                            未出票
                        </template>
                    </span>
                            <span v-if="scope.row.BuyInfo.statusCode == 1" class="green">等待开奖</span>
                            <span v-if="scope.row.BuyInfo.statusCode == 2 && scope.row.bonus > 0" class="red">已中奖</span>
                            <span v-if="scope.row.BuyInfo.statusCode == 2 && scope.row.bonus == 0" class="c-3">未中奖</span>
                            <span v-if="scope.row.BuyInfo.statusCode == 6" class="c-3">流产撤单</span>
                            <span v-if="scope.row.BuyInfo.statusCode == 7" class="c-3">系统撤单</span>
                            <span v-if="scope.row.BuyInfo.statusCode == 8" class="c-3">用户撤单</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="bonus" label="奖金" sortable width="110">
                        <template slot-scope="scope">
                            <span><em :class="{'red':scope.row.bonus > 0}">{{scope.row.bonus}}</em>{$system.lottery_unit}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="create_time" label="投注时间" width="120" sortable>
                        <template slot-scope="scope">
                            <span>{{scope.row.create_time | timeSplit}}</span>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" width="85">
                        <template slot-scope="scope">
                            <div class="flex-box">
                                <el-button type="text" size="mini" @click.native="toDetail(scope.row.buy_id,scope.row.BuyInfo.lottery_id)">详情</el-button>
                                <el-button type="text" size="mini" @click.native="cancelOrder(scope.row.BuyInfo.lottery_id)" v-if="scope.row.BuyInfo.statusCode <= 1 && !scope.row.BuyInfo.is_join">撤单</el-button>
                            </div>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
        </el-collapse-transition>
    </div>
</template>
<!--模式选择、单注倍数设置-->
<template id="modelUnit">
    <div class="flex-box">
        <el-input-number v-model="multiple" :min="1" label="设置倍数" size="mini" @change="changeMul"></el-input-number> 倍
        <span class="flex-box unit">模式
             <el-select v-model="value" size="mini" placeholder="请选择" style="width: 60px">
                <el-option
                        v-for="item in options"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value">
                </el-option>
              </el-select>
        </span>
        <el-tooltip placement="bottom">
            <div slot="content">
                1元 = 1{$company.lottery_unit}<br>
                1角 = 0.1{$company.lottery_unit}<br>
                1分 = 0.01{$company.lottery_unit}<br>
                1厘 = 0.001{$company.lottery_unit}<br>
            </div>
            <i class="el-icon-question org"></i>
        </el-tooltip>
    </div>
</template>
<!--pc28 投注-->
<template id="pc28Bet">
    <div>
        <div class="bet-tips">
            <i class="el-icon-warning"></i>玩法提示：每期开出3个号码作为开奖号码，3个号码之和即为特码。
            <template v-if="type == 1">对特码的大（14-27）、小（0-13）、单、双、极大（22-27）、极小（0-5）形态进行投注，任选1个形态组成一注。
                所选形态与开奖特码的形态相同，即为中奖，最高{{showWords}}<em class="red">{{handleGain(hhGain)}}</em>，如开出小单（13）、大双（14 ）中奖后保本。
            </template>
            <template v-if="type == 2">对开奖特码的绿波（1、4、7、10、16、19、22、25），蓝波（2、5、8、11、17、20、23、26），红波（3、6、9、12、15、18、21、24）的色波进行投注，
                任选1个色波组成一注。所选色波与开奖特码色波相同，即为中奖。如开出灰波（0、13、14、27）
                则投注任何色波均视为不中奖，最高{{showWords}}<em class="red">{{handleGain(hhGain)}}</em>。
            </template>
            <template v-if="type == 3">
                投注当期的3个开奖号为豹子号码，3个开奖号码为同一号码，即为中奖，{{showWords}}<em class="red">{{gain}}</em>。
            </template>
        </div>
        <div class="code-box">
            <div class="ks-balls">
                <template v-if="type == 1"><!--混合投注-->
                    <ul class="cf" style="width: 680px">
                        <template v-for="(item,index) in ball">
                            <li class="fl" v-if="index==8"  style="width: 121px;margin: 8px 24px;margin-left: 194px">
                                <a href="javascript:;" :class="item.selected ? 'selected' : ''" @click="doBet(item.num,index,item.gain)">{{item.num}}</a>
                                <i>{{showWords}}{{handleGain(item.gain)}}</i>
                            </li>
                            <li v-else class="fl" style="width: 121px;margin: 8px 24px;">
                                <a href="javascript:;" :class="item.selected ? 'selected' : ''" @click="doBet(item.num,index,item.gain)">{{item.num}}</a>
                                <i>{{showWords}}{{handleGain(item.gain)}}</i>
                            </li>
                        </template>
                    </ul>
                </template>
                <template v-if="type == 2"><!--色波投注-->
                    <ul class="cf" style="width:511px">
                        <li v-for="(item,index) in ball2" class="fl" style="width: 121px;margin: 8px 24px;">
                            <a href="javascript:;" :class="item.selected ? 'selected' : ''" @click="doBet(item.num,index,item.gain)">{{item.num}}</a>
                            <i>{{showWords}}{{handleGain(item.gain)}}</i>
                        </li>
                    </ul>
                </template>
                <template v-if="type == 3"><!--豹子-->
                    <ul class="cf" style="width:169px ">
                        <li v-for="(item,index) in ball3" class="fl" style="width: 121px;margin: 8px 24px;">
                            <a href="javascript:;" :class="item.selected ? 'selected' : ''" @click="doBet(item.num,index,gain)">{{item.num}}</a>
                            <i>{{showWords}}{{gain}}</i>
                        </li>
                    </ul>
                </template>
            </div>
        </div>
        <div class="tr bet-clear"><span @click="clear"><i class="el-icon-delete"></i> 清空选区</span></div>
        <div class="bet-solutions">
            <div class="flex-box add-box">
                <div class="flex tr">
                     <span>您已选中了<b class="red">{{notes}}</b>注
                         <template v-if="betModel == 1"><!--模式1-->
                             ，共<b class="red">{{totalMoney}}</b>{$company.lottery_unit}
                         </template>
                    </span>
                </div>
            </div>
            <div class="btn-pools">
                <el-button :type="notes >= 1 ? 'warning' : 'info'" @click.navtive="add" icon="el-icon-download">添加到投注区</el-button>
            </div>
        </div>
    </div>
</template>

{include file='web@common/foot'/}
<script type="text/javascript">
    $(function(){
        //单位模式，倍数设置
        Vue.component('model-unit', {
            template:'#modelUnit',
            data:function(){
                return{
                    options:{$unitArr},
                    value:'1',
                    multiple:'1',//倍数
                }
            },
            watch:{
                value:function(val){
                    this.$emit('change-model',[this.scale,this.label,val])
                },
                multiple:function (val) {
                    this.$emit('change-mul',val)
                }
            },
            computed:{
                scale:function () {
                    var valueObj = {
                        1 : 1,
                        2 : 10,
                        3 : 100,
                        4 : 1000
                    }
                    return valueObj[this.value]
                },
                label:function () {
                    var valueObj = {
                        1 : '元',
                        2 : '角',
                        3 : '分',
                        4 : '厘'
                    }
                    return valueObj[this.value]
                }
            },
            methods:{
                //更改倍数
                changeMul: function(val) {
                    var _this = this
                    setTimeout(function(){
                        _this.multiple = parseInt(val)
                    },0)
                }
            }
        })
        //pc28投注 组件
        Vue.component('bet-pc28', {
            template:'#pc28Bet',
            props:['gain','type','betModel','minMoney','unitIsOpen','label','value','scale','multiple','percent','rebate','showWords','rebateIsOpen','isRebate'], //['percent最高奖金比例','rebate所选返点值'],
            data:function(){
                return{
                    ball: [{num:'大',selected:false,gain:this.gain.toString().split(',')[0]},{num:'小',selected:false,gain:this.gain.toString().split(',')[1]},
                        {num:'单',selected:false,gain:this.gain.toString().split(',')[2]},{num:'双',selected:false,gain:this.gain.toString().split(',')[3]},
                        {num:'大单',selected:false,gain:this.gain.toString().split(',')[4]},{num:'小单',selected:false,gain:this.gain.toString().split(',')[5]},
                        {num:'大双',selected:false,gain:this.gain.toString().split(',')[6]},{num:'小双',selected:false,gain:this.gain.toString().split(',')[7]},
                        {num:'极大',selected:false,gain:this.gain.toString().split(',')[8]},{num:'极小',selected:false,gain:this.gain.toString().split(',')[9]},
                    ],
                    ball2:[{num:'红波',selected:false,gain:this.gain.toString().split(',')[0]},{num:'绿波',selected:false,gain:this.gain.toString().split(',')[1]},
                        {num:'蓝波',selected:false,gain:this.gain.toString().split(',')[2]}],
                    ball3:[{num:'豹子',selected:false}],
                    betNum:[], //投注号码
                    betNum2:[], //投注号码
                    betNum3:[], //投注号码
                    betArr:[],//投注组
                    betArr2:[],//投注组
                    betArr3:[],//投注组
                    gainArr:[],//混合投注奖金数组
                    gainArr2:[],//色波投注奖金数组
                }
            },
            computed:{
                //混合投注最高奖金
                hhGain:function () {
                    return getMaxMin(this.gain.toString().split(","),'max')
                },
                divVal:function () {
                    return this.betModel == 1 ? 1 : 2//模式2下奖金减半
                },
                totalMoney:function(){
                    var count = 2 * accMul(this.notes,this.multiple)
                    var s  = accDiv(count,this.scale)
                    return s
                },
                //注数计算
                notes:function(){
                    if(this.type == 1){
                        return this.betNum.length
                    }
                    if(this.type == 2){
                        return this.betNum2.length
                    }
                    if(this.type == 3){
                        return this.betNum3.length
                    }else {
                        return 0
                    }
                }
            },
            methods:{
                //奖金计算方法
                handleGain:function (g) {
                    return this.rebateIsOpen ? accDiv(accDiv(accMul(Number(g),this.percent),this.scale),this.divVal,5) : accDiv(Number(g),this.divVal ,5)
                },
                addBet:function(num,gain){
                    var arr = []
                    if(this.type == 1){
                        arr = this.betArr
                    }
                    if(this.type == 2){
                        arr = this.betArr2
                    }
                    if(this.type == 3){
                        arr = this.betArr3
                    }

                    var list ={}
                    list['num'] = num; //投注号码
                    if(this.betModel == 2){
                        list['money'] = this.minMoney; //投注号码
                    }
                    if(this.type == 1 || this.type == 2){
                        list['gain'] =  this.betModel == 2 ? accDiv(gain,this.divVal,5)  : gain //奖金
                    }
                    arr.push(list);
                },
                //投注选号状态
                doBet:function(num,s,gain,text){
                    if(this.type == 1){
                        var chose = this.betNum.indexOf(num)
                        if(chose > -1){
                            this.betNum.splice(chose, 1)
                            this.betArr.splice(chose, 1)
                            this.gainArr.splice(chose, 1)
                        }else {
                            this.betNum.push(num)
                            this.gainArr.push(gain)
                            this.addBet(num,gain,text)
                        }
                        this.$emit('change-gain',this.gainArr.join(',')) //改变最高奖金显示
                        //改变球的选中状态
                        this.ball[s].selected = !this.ball[s].selected
                    }
                    if(this.type == 2){
                        var chose = this.betNum2.indexOf(num)
                        if(chose > -1){
                            this.betNum2.splice(chose, 1)
                            this.betArr2.splice(chose, 1)
                            this.gainArr2.splice(chose, 1)
                        }else {
                            this.betNum2.push(num)
                            this.gainArr2.push(gain)
                            this.addBet(num,gain,text)
                        }
                        this.$emit('change-gain',this.gainArr2.join(',')) //改变最高奖金显示
                        //改变球的选中状态
                        this.ball2[s].selected = !this.ball2[s].selected
                    }
                    if(this.type == 3){
                        var chose = this.betNum3.indexOf(num)
                        if(chose > -1){
                            this.betNum3.splice(chose, 1)
                            this.betArr3.splice(chose, 1)
                        }else {
                            this.betNum3.push(num)
                            this.addBet(num,gain,text)
                        }
                        //改变球的选中状态
                        this.ball3[s].selected = !this.ball3[s].selected
                    }
                },
                //清空
                clear:function(){
                    if(this.type == 1){
                        this.betNum =[];
                        this.betArr =[];
                        this.gainArr = [];
                        this.$emit('change-gain','') //改变最高奖金显示
                        for(var i in this.ball){
                            this.ball[i].selected = false
                        }
                    }
                    if(this.type == 2){
                        this.betNum2 =[];
                        this.betArr2 =[];
                        this.gainArr2 = [];
                        this.$emit('change-gain','') //改变最高奖金显示
                        for(var i in this.ball2){
                            this.ball2[i].selected = false
                        }
                    }
                    if(this.type == 3){
                        this.betNum3 =[];
                        this.betArr3 =[];
                        for(var i in this.ball3){
                            this.ball3[i].selected = false
                        }
                    }
                },
                //添加到选区
                add:function(){
                    if(this.notes < 1){
                        this.$alert('请至少选择1注投注号码', '提示', {
                            confirmButtonText: '确定',
                            type: 'warning',
                            center: true,
                            lockScroll: false,
                            showClose: false
                        });
                        return
                    }
                    var betArr = [];
                    var type_text
                    if(this.type  == 1){
                        betArr = this.betArr
                        type_text = '混合'
                    }
                    if(this.type  == 2){
                        betArr = this.betArr2
                        type_text = '色波'
                    }
                    if(this.type  == 3){
                        betArr = this.betArr3
                        type_text = '豹子'
                    }
                    for(var i=0;i < betArr.length;i++){
                        if(this.betModel == 1){ //模式1
                            if(this.unitIsOpen){ // 元角分厘模式
                                betArr[i]['money'] = accMul(accDiv(2,this.scale),this.multiple); //投注金额
                                betArr[i]['unit'] =this.label; //投注单位
                                betArr[i]['unit_value'] = this.value; //投注单位
                                betArr[i]['multiple'] = this.multiple; //投注倍数
                                if(this.type == 1 || this.type == 2){
                                    betArr[i]['gain']  = this.rebateIsOpen ? accDiv(accMul(accMul(betArr[i].gain,this.multiple),this.percent),this.scale,5) : accDiv(accMul(betArr[i].gain,this.multiple),this.scale,5)
                                }else {
                                    betArr[i]['gain'] = accMul(this.gain,this.multiple,5);
                                }
                            }else { //默认模式
                                betArr[i]['money'] = 2
                                if(this.type == 1 || this.type == 2){
                                    betArr[i]['gain'] = this.rebateIsOpen ? accMul(betArr[i].gain,this.percent,5) :  betArr[i].gain
                                }else {
                                    betArr[i]['gain'] =  this.gain
                                }
                            }
                        }
                        if(this.betModel == 2){ //模式2
                            if(this.type == 1 || this.type == 2) {
                                betArr[i]['gain'] = this.rebateIsOpen ? accMul(betArr[i].gain, this.percent, 5) : betArr[i].gain
                            }else {
                                betArr[i]['gain'] = this.gain
                            }
                        }
                        if(this.rebateIsOpen && this.isRebate){
                            betArr[i]['rebate'] = this.rebate
                        }
                        betArr[i]['notes'] = 1; //注数
                        betArr[i]['type_text'] = type_text;
                        betArr[i]['type'] = this.type; //投注type类型
                    }
                    this.$emit('bet',betArr); //向父组件传递投注内容[投注号码，投注注数，投单式 / 复式,投注类型type]，且顺序需固定
                    this.clear();
                }
            }
        })

        //投注--右侧内容 组件
        Vue.component('bet-right', {
            template: '#betRight',
            props:['recentAwardData','cold','hot'],
            data:function(){
                return{
                    coldNum:true,
                    historyName:'{$name}',
                    expect_type : Number("{$lottery['expect_type']}"), //期号类型
                }
            },
            computed:{
                // 冷号最大值
                coldMax:function(){
                    return this.cold[2].num
                },
                // 热号最大值
                hotMax:function(){
                    return this.hot[0].num
                },
                //计算pc28【颜色，色波】
                pcResult:function(){
                    return function(he){
                        var green_w = [1,4,7,10,16,19,22,25]
                        var bule_w = [2,5,8,11,17,20,23,26]
                        var red_w = [3,6,9,12,15,18,21,24]
                        var gray_w = [0,13,14,27]
                        var color = ''
                        var text_color = '- -'
                        if(red_w.indexOf(he) > -1){
                            color = '#ff0000'
                            text_color = '红波'
                        }
                        if(bule_w.indexOf(he) > -1){
                            color = '#2388f5'
                            text_color = '蓝波'
                        }
                        if(green_w.indexOf(he) > -1){
                            color = '#12c231'
                            text_color = '绿波'
                        }
                        if(gray_w.indexOf(he) > -1){
                            color = '#999999'
                            text_color = '灰波'
                        }
                        return {'bg_color': color,'text_color' : text_color}
                    }
                }
            }
        })
        //底部--今日开奖号码 组件
        Vue.component('today-kj',{
            template:'#todayKj',
            props:['kjCode','totalIssue'],
            data:function(){
                return{
                    name:'{$name}',
                    isShow:false,
                    todayInfo:'{$info.today}',//info.today
                    expect_type : Number("{$lottery['expect_type']}"), //期号类型
                    firstIssue:{$firstIssue}, //当天第一期期号
                }
            },
            computed:{
                column:function(){
                    return Math.ceil(this.totalIssue/3)
                }
            },
            methods:{
                //今日开奖期号处理判断
                checkUp:function (n) {
                    var string = ''
                    for(var i = 0 ; i< this.totalIssue.toString().length - n.toString().length ; i++){
                        string +='0'
                    }
                    var addZero = string + "" + n; //序号根据总期数补零
                    var issueString = this.todayInfo + ''+ addZero   //期号拼接
                    return [addZero , issueString]
                }
            }
        })
        //底部--我的投注记录 组件
        Vue.component('my-record',{
            template:'#myRecord',
            props:['recordData'],
            data:function(){
                return{
                    isShow:false
                }
            },
            filters:{
                timeSplit:function (val) {
                    return val.toString().slice(5)
                }
            },
            methods:{
                toDetail: function (id, orderid) {
                    var u = '?lottery_id=' + orderid + '&id=' + id;
                    window.open('{:url("./orders")}' + u);
                },
                //撤销订单
                cancelOrder:function (id) {
                    var _this = this
                    _this.$confirm('确定要撤销该订单吗?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning',
                        lockScroll: false
                    }).then(function(){
                        $.get('{:url("orders/returnTicket")}', {
                            lottery_id:id,
                        }, function (res) {
                            if(!res.err){
                                _this.$alert(res.msg, '提示', {
                                    confirmButtonText: '确定',
                                    center: true,
                                    type: 'success',
                                    lockScroll: false,
                                    callback: function(action){
                                        _this.$emit('refresh')
                                    }
                                })
                            }else {
                                _this.$alert(res.msg, '提示', {
                                    confirmButtonText: '确定',
                                    center: true,
                                    type: 'error',
                                    lockScroll: false
                                });
                            }
                        });
                    }).catch(function(){
                    });
                }
            }
        })

        //字符串截取
        Vue.filter("slice", function(value) {
            return value.toString().slice(2);
        });

        //逗号分割字符串显示处理
        //最后一位
        Vue.filter("strSplit", function(value) {
            var arr = value.split(',')
            return arr[arr.length-1]
        });
        'use strict';

        var vm = new Vue({
            el: '#app',
            data: {
                pause: {$pause} ? true : false, //彩种是否暂停销售
                expect_type : Number("{$lottery['expect_type']}"), //期号类型

                value3:false,
                label:'元', //单位值
                value:'1', //单位值
                scale: 1,//比例
                multiple:'1',//倍数

                joinOpen: '{$company.join_isOpen}'== 1 ? true : false, //是否开启合买
                betModel: Number({$mode}), //模式1常规模式 2自定义金额模式
                unitIsOpen: '{$company.unit_isOpen}'== 1 ? true : false, //模式1下 元角分模式是否开启
                minMoney:  Number('{$company.mode2_min_money}') ,//模式2下每注的最低金额
                rebateIsOpen:  '{$company.rebate_isOpen}'== 1 ? true : false ,//返点是否开启

                sliderValue: Number('{$user_rebate}'), //用户返点值
                rebate : Number('{$bonus_base}'), //系统返点值
                userRebate : Number('{$user_rebate}'),//用户返点值
                upRebate: Number('{$up_user_rebate}'), //上级返点值

                navList: {$play}, //投注种类选项
                jgTime: '{$info.timelong}', //几分钟一期,
                name: '{$name}',
                //初始数据
                defaultInfo: {
                    start_time:'{$info.startTime}',//开始时间
                    end_time:'{$info.endTime}',//结束时间
                    issue: '{$info.expect}', //当前投注期号
                    firstIssue: '{$firstIssue}', //当天第一期期号
                    sort_expect: '{$info.sort_expect}', //期数
                    time: '{$info.down_time}', //当期投注剩余时间（秒）
                    awardNumber: '{$info.awardNumber.code}'.split(","), //最新一期开奖号码
                    expect: '{$info.awardNumber.expect}', //最新开奖期号
                    type: '{$info.type}', //默认选中 与 navList 的type相对应
                    gain: '{$info.gain}', //默认选中金币
                    totalIssue: '{$info.startIssue}', //总期数
                    kjTime: '{$openTime}', //开奖时间
                    todayTime: '{$info.todayTime}', //今天的日期
                },
                hhGain:'',
                sbGain:'',

                //右侧--近期开奖
                recentAwardData: {$ten},
                //右侧--冷热号统计
                cold: {$cold},
                hot:{$hot},

                //底部--今日开奖号码
                //开奖数组
                kjCode: {$open},

                //投注类型 普通投注 or 胆拖投注
                dialogVisible: false, //期号提示显示控制
                orderVisible: false, //投注信息确认
                loginVisible: false, //登录弹窗
                agreeVisible: false, //用户服务协议内容
                gameVisible: false, //游戏服务协议内容
                accountMoney: '{$user.money}', //账户余额
                nickname: '{present name="$user.sid"} {$user.nickname}{/present}', //登录昵称
                loginType: -1, //唤起登录的方式

                //投注数据
                bet: {
                    notes: 0, //投注总注数
                    multiple: 1, //投注倍数
                    checked: true, //投注协议
                    isChase: false, //是否追号
                    betArr: [], //投注内容
                    buyType: 1, //购买方式 1 自购 2 合买
                    expectArr: [] //期号、倍数
                },
                //合买数据
                jion: {
                    total_share:0,//份数
                    buy_share:0,//购买份数
                    bd_share:0,//保底份数
                    infoState: 0, //是否公开
                    gain: '0%',
                    isAll: false, //是否全保
                    declaration: ''
                },

                //追号数据
                chaseNum: 10, //默认追号期数
                chaseMul: 1, //追号倍数设置
                checkAlls: true, //是否全选
                isStop: false, //中奖是否停止追号
                chaseData: [], //追号数据内容

                //订单显示数据
                order: {
                    money: 0,
                    type: '自购'
                },
                isGet:'{$getnewcode}',//加载页面时是否获取开奖
                notDo:false, //禁止双击提交
                playLinkUrl:'',
                intervalFun: null,

                recordData:[]
            },
            computed: {
                //计算可中金额
                getGain:function(){
                    return function (g,m) {
                        return accMul(g,m,5)
                    }
                },
                //计算pc28【颜色，色波】
                pcResult:function(){
                    return function(he){
                        var green_w = [1,4,7,10,16,19,22,25]
                        var bule_w = [2,5,8,11,17,20,23,26]
                        var red_w = [3,6,9,12,15,18,21,24]
                        var gray_w = [0,13,14,27]
                        var color = ''
                        if(red_w.indexOf(he) > -1){
                            color = '#ff0000'
                        }
                        if(bule_w.indexOf(he) > -1){
                            color = '#2388f5'
                        }
                        if(green_w.indexOf(he) > -1){
                            color = '#12c231'
                        }
                        if(gray_w.indexOf(he) > -1){
                            color = '#999999'
                        }
                        return color
                    }
                },
                //最新一期开奖号码形态
                CodeXt:function(){
                    var a = 0
                    for(var i = 0 ;i < this.defaultInfo.awardNumber.length ; i++){
                        a = Number(a) + Number(this.defaultInfo.awardNumber[i])
                    }
                    var dxObj = a >= 14 ? '大' : '小'
                    var dsObj = a%2 == 0 ? '双' : '单'
                    return [a,dxObj + ',' + dsObj]
                },
                //用户返点为0 时不显示
                isRebate:function () {
                    return this.userRebate == 0 ? false : true
                },
                showWords:function () {
                    return this.betModel == 1 ? '奖金' : '赔率'
                },
                //返点值 用户滑动显示值
                rebateVal:function () {
                    return accSub(this.userRebate,this.sliderValue)
                },
                //最高奖金计算百分比
                maxRebate:function () {
                    return accSub(1 ,accDiv(accAdd(accAdd(this.rebate,this.upRebate), this.rebateVal),100))
                },
                //返点后最高奖金
                gain:function () {
                    var arr = []
                    if(this.defaultInfo.type == 1){
                        arr = this.hhGain ? this.hhGain.split(",") : this.defaultInfo.gain.split(",")
                    }else if(this.defaultInfo.type == 2){
                        arr = this.sbGain ? this.sbGain.split(",") : this.defaultInfo.gain.split(",")
                    }else {
                        arr = this.defaultInfo.gain.split(",")
                    }
                    var a = this.betModel == 1 ? 1 : 2; //模式2下奖金减半
                    var s = getMaxMin(arr,'max') //<!--混合投注type == 1时取最大值-->
                    var res = this.rebateIsOpen ? accDiv(accDiv(accMul(Number(s),Number(this.maxRebate)),Number(this.scale)),a,5) : accDiv(s,a,5) //保留4位小数
                    return res
                },
                //投注剩余时间格式化
                timer: function() {
                    if (this.defaultInfo.time == 0) {
                        return '00:00:00';
                    } else {
                        return format('i:s', this.defaultInfo.time);
                    }
                },
                //几分钟一期转换成秒
                intervalTime: function() {
                    return parseInt(this.jgTime) * 60;
                },
                //已售期数
                issueAfter: function() {
                    return this.defaultInfo.issue - {$firstIssue};
                },
                //投注文字显示处理
                text: function() {
                    var typeObj = {
                        1 : '混合',
                        2 : '色波',
                        3 : '豹子'
                    }
                    return typeObj[this.defaultInfo.type]
                },
                //选号区总金额
                zgMoney: function() {
                    var count = 0
                    for(var i=0;i<this.bet.betArr.length;i++){
                        var a = 0
                        if(this.betModel == 1){
                            a = this.bet.betArr[i].money
                        }else {
                            a = accMul(this.bet.betArr[i].money,this.bet.betArr[i].notes)
                        }
                        count = accAdd(count,a);
                    }
                    return count * this.bet.multiple
                },
                //1倍投注金额（追号时使用）
                oneMoney: function() {
                    var count = 0
                    if(this.betModel == 1){
                        if(this.unitIsOpen){
                            for(var i=0;i < this.bet.betArr.length;i++){
                                var a = accAdd(count,accDiv(this.bet.betArr[i].money,this.bet.betArr[i].multiple))
                                count = a;
                            }
                        }else {
                            count = accDiv(this.zgMoney,this.bet.multiple)
                        }
                    }
                    return count
                },

                //追号
                //追号总金额
                chaseMoney: function() {
                    var money = 0;
                    for (var i = 0; i < this.chaseData.length; i++) {
                        if (this.chaseData[i].checked) {
                            var a = accAdd(money,accMul(this.chaseData[i].multiple,this.oneMoney))
                            money = a;
                        }
                    }
                    return money;
                },
                //追号选中数量
                chaseDateLen: function() {
                    var checkedLen = 0;
                    for (var i = 0; i < this.chaseData.length; i++) {
                        if (this.chaseData[i].checked) {
                            checkedLen += 1;
                        }
                    }
                    return checkedLen;
                },
                //追号总期数
                issueTotal: function() {
                    return this.chaseDateLen;
                },
                //是否全选
                checkAll: {
                    set: function set(value) {
                        this.checkAlls = value;
                    },
                    get: function get() {
                        return this.chaseDateLen < this.chaseData.length ? false : true;
                    }
                },
                //合买
                //合买参考金额
                money: function() {
                    if (this.bet.buyType == 2 && this.bet.isChase) {
                        return this.chaseMoney; //追号合买
                    } else {
                        return this.zgMoney; //合买
                    }
                },
                //最小总份数
                minTotalShare:function () {
                    return this.money ? 1 : 0
                },
                //每份金额 保留2位去掉
                perMoney:function(){
                    return this.money ? accDiv(this.money,this.jion.total_share,3) : 0
                },
                //最少购买份数 向上取整
                minJionMoney: function() {
                    return Math.ceil(this.jion.total_share * 0.05);
                },
                //已购买百分比 取整
                isbuy: function() {
                    return !this.money ? 0 : Math.floor(this.jion.buy_share / this.jion.total_share * 10000) / 100
                },
                //最多可保底
                bdMax: function() {
                    return this.jion.total_share - this.jion.buy_share;
                },
                //已保底百分比 取整
                bdPercent: function() {
                    return !this.money ? 0 :  Math.floor(this.jion.bd_share / this.jion.total_share * 10000) / 100
                },
                isLogin: function() {
                    if (this.nickname.length) {
                        return true;
                    } else {
                        return false;
                    }
                },

                //账户余额显示格式化
                formatMoney: function (_formatMoney) {
                    function formatMoney() {
                        return _formatMoney.apply(this, arguments);
                    }
                    formatMoney.toString = function () {
                        return _formatMoney.toString();
                    };
                    return formatMoney;
                }(function () {
                    return formatMoney(this.accountMoney);
                }),
                //最多追号期数
                maxChase:function(){
                    var total = parseInt(this.defaultInfo.totalIssue); //每天售卖期数
                    var max_chase = Number("{$company['max_chase']}") //最大追号期数
                    return max_chase ? max_chase > total ? total : max_chase : total //控制最多只能追第二天的期号
                }
            },
            watch: {
                //监听追号期数变化
                chaseNum: function (val) {
                    if (val > 1 && val <= this.maxChase && val % 1 == 0) {
                        this.doChase();
                    }
                    if (val > this.maxChase) {
                        //最多追号每天总期数
                        this.chaseNum = this.maxChase;
                    }
                },
                chaseMul: function(val) {
                    if (val > 0 && val % 1 == 0) {
                        for (i in this.chaseData) {
                            if (this.chaseData[i].checked) {
                                this.chaseData[i].multiple = parseInt(val);
                            }
                        }
                    }
                },
                //监听购买总金额
                money: function (val) {
                    this.jion.total_share = val
                },
                //监听总份数
                'jion.total_share':function (val) {
                    this.jion.buy_share = Math.ceil(val * 0.05);
                    if (this.jion.isAll) {
                        this.jion.bd_share = this.bdMax;
                    }
                },
            },
            methods: {
                getHhGain:function (emitVal) {
                    if(this.defaultInfo.type == 1){
                        this.hhGain = emitVal
                    }
                    if(this.defaultInfo.type == 2){
                        this.sbGain = emitVal
                    }
                },
                changeModel:function (emitVal) {
                    this.scale = emitVal[0]
                    this.label = emitVal[1]
                    this.value = emitVal[2]
                },
                changeMultiple:function (emitVal) {
                    this.multiple = emitVal
                },
                changeRebate:function (a) {
                    if(a == 'add'){
                        if(this.sliderValue < this.userRebate){
                            this.sliderValue = accAdd(this.sliderValue,0.1)
                        }
                    }
                    if(a == 'sub'){
                        if(this.sliderValue >0){
                            this.sliderValue = accSub(this.sliderValue,0.1)
                        }
                    }
                },

                //输入的单注金额必须为整数
                changeBetArr:function (val,i) {
                    var _this = this;
                    setTimeout(function () {
                        _this.$set(_this.bet.betArr[i],'money',parseInt(val))
                    },0)
                },
                //type
                tabActive: function(n, g) {
                    //n 投注类型，g投注类型对应的单注奖金
                    this.defaultInfo.type = n;
                    this.defaultInfo.gain = g;
                },
                //获取期号信息
                getIssueInfo: function() {
                    var _this = this;

                    $.get('{:url("getIssueInfo")}', { name: '{$name}' }, function (res) {
                        _this.defaultInfo.time = res.data.down_time;
                        _this.defaultInfo.issue = res.data.expect;
                        _this.$set(_this.defaultInfo,'time',res.data.down_time)
                        _this.$set(_this.defaultInfo,'issue',res.data.expect)
                        _this.$set(_this.defaultInfo,'sort_expect',res.data.sort_expect)
                        _this.$set(_this.defaultInfo,'expect',res.data.lastIssue)
                        _this.$set(_this.defaultInfo,'kjTime',res.data.openTime)
                        _this.$set(_this.defaultInfo,'todayTime',res.data.todayTime)
                        if (_this.bet.isChase) {
                            _this.doChase();
                        }
                    });
                },
                //当期投注倒计时
                setTime: function() {
                    var _this2 = this;
                    var countdown = function countdown() {
                        _this2.defaultInfo.time--;
                        //当期投注结束
                        if (_this2.defaultInfo.time == 0) {
                            clearInterval(_this2.intervalFun);
                            $.get('{:url("getIssueInfo")}', { name: '{$name}' }, function (res) {
                                _this2.$set(_this2.defaultInfo,'time',res.data.down_time)
                                _this2.$set(_this2.defaultInfo,'issue',res.data.expect)
                                _this2.$set(_this2.defaultInfo,'sort_expect',res.data.sort_expect)
                                _this2.$set(_this2.defaultInfo,'expect',res.data.lastIssue)
                                _this2.$set(_this2.defaultInfo,'kjTime',res.data.openTime)
                                _this2.$set(_this2.defaultInfo,'todayTime',res.data.todayTime)
                                _this2.$set(_this2.defaultInfo,'awardNumber',res.data.awardNumber.code.split(','))  //显示正在开奖
                                _this2.$set(_this2,'recentAwardData',res.data.open) //更新近10期开奖数组
                                _this2.dialogVisible = true; //期数提示

                                if (_this2.bet.isChase) {
                                    _this2.doChase();
                                }
                            });
                            setTimeout(function () {
                                _this2.dialogVisible = false;
                            }, 5000);
                            //timer分钟后获取开奖号码
                            var s = _this2.jgTime < 5 ? 5000 : 60000;
                            var ctime = setTimeout(function () {
                                _this2.getNewCode();
                                clearTimeout(ctime);
                            }, s);
                        }
                    };
                    var countdowns = setInterval(countdown, 1000);
                },
                //获取开奖号码
                getNewCode: function() {
                    var _this3 = this;
                    var s = _this3.jgTime < 5 ? 5000 : 10000;
                    this.intervalFun = setInterval(function () {
                        $.get('{:url("getNewCode")}', {
                            issue: _this3.defaultInfo.expect,
                            name: '{$name}'
                        }, function (res) {
                            if (!res.err) {
                                clearInterval(_this3.intervalFun);
                                _this3.$set(_this3.kjCode, res.data.expect, res.data.codeOpen);
                                _this3.kjCode[res.data.expect] = res.data.codeOpen;
                                _this3.$set(_this3,'recentAwardData',res.data.tenCode);
                                _this3.$set(_this3.defaultInfo,'awardNumber',res.data.code);
                                $.get('{:url("getColdHot")}', { name: '{$name}' }, function (res) {
                                    _this3.$set(_this3, 'cold', res.data.cold);
                                    _this3.$set(_this3, 'hot', res.data.hot);
                                });
                            }
                        });
                    }, s); //每隔10秒
                },
                //添加到投注区
                addToArea: function(numArr) {
                    for(var i=0;i<numArr.length;i++){
                        this.bet.betArr.unshift(numArr[i]);
                    }
                    this.bet.notes += numArr.length; //计算总注数
                },
                //删除投注投注列表
                deleteBet: function(i, n) {
                    this.bet.betArr.splice(i, 1);
                    this.bet.notes -= n;
                },
                //清空投注列表
                clearList: function() {
                    this.bet.betArr = [];
                    this.bet.expectArr = [];
                    this.bet.notes = 0;
                },
                //追号
                doChase: function() {
                    var arr = [];
                    //投注当天
                    var date = new Date(this.defaultInfo.kjTime);
                    var time = date.getTime() / 1000;
                    //投注第二天
                    var nextDayVal = getDateStr(this.defaultInfo.todayTime, 1);
                    var nextDay = getDateStr1(this.defaultInfo.todayTime, 1);
                    var nextDate = nextDay + " " + '{$info.startTime}';
                    var nextTime = new Date(nextDate).getTime() / 1000;

                    var init = parseInt(this.issueAfter) + 1;
                    var total = parseInt(this.defaultInfo.totalIssue);
                    var deIssue = parseInt(this.defaultInfo.issue);
                    var string = ''
                    for(var i = 0 ; i< this.defaultInfo.totalIssue.toString().length ; i++){
                        string +='0'
                    }
                    var nextVal = parseInt(nextDayVal + string);

                    var nextT = nextTime;
                    for (var i = 0; i < this.chaseNum; i++) {
                        var chaseList = {};
                        chaseList['checked'] = true;
                        chaseList['multiple'] = this.chaseMul;
                        if(this.expect_type){ //累加
                            chaseList['issue'] = deIssue + i;
                        }
                        if (i > total - init) {
                            //投注第二天（最多）
                            if(!this.expect_type){ //日期型
                                nextVal += 1;
                                chaseList['issue'] = nextVal;
                            }
                            nextT = nextT + this.intervalTime;
                            chaseList['time'] = format('Y-m-d H:i', nextT + 60);
                        } else {
                            //投注当天
                            if(!this.expect_type) { //日期型
                                chaseList['issue'] = deIssue + i;
                            }
                            chaseList['time'] = format('Y-m-d H:i', time + i * this.intervalTime);
                        }
                        arr.push(chaseList);
                    }

                    this.$set(this, 'chaseData', arr);
                },
                //追号 期数设置小于2、不为整数时
                chaseIssue: function() {
                    var reg = /^[0-9]+.?[0-9]*$/;
                    if (this.chaseNum < 2 || !reg.test(this.chaseNum)) {
                        this.chaseNum = 2;
                    } else {
                        this.chaseNum = parseInt(this.chaseNum);
                    }
                },
                //追号 倍数小于1、不为整数时
                chaseM: function() {
                    var reg = /^[0-9]+.?[0-9]*$/;
                    if (this.chaseMul < 1 || !reg.test(this.chaseMul)) {
                        this.chaseMul = 1;
                        for (i in this.chaseData) {
                            if (this.chaseData[i].checked) {
                                this.chaseData[i].multiple = 1;
                            }
                        }
                    } else if (this.chaseMul / 1 !== 0) {
                        this.chaseMul = parseInt(this.chaseMul);
                    }
                },
                //更改 追号倍数
                changeMul: function(val) {
                    var _this = this
                    setTimeout(function(){
                        _this.bet.multiple = parseInt(val)
                        _this.chaseMul =  parseInt(val)
                    },0)
                },
                //追号全选 or 全不选
                checkedBox: function(val) {
                    for (var i = 1; i < this.chaseData.length; i++) {
                        this.chaseData[i].checked = val;
                        if (val) {
                            this.chaseData[i].multiple = this.chaseMul;
                        } else {
                            this.chaseData[i].multiple = '';
                        }
                    }
                },
                //追号 更改单期倍数 i 排除当前期
                checkMul: function(i, val) {
                    var reg = /^[0-9]+.?[0-9]*$/;
                    if (i == 0) {
                        if (val < 1) {
                            this.chaseData[i].multiple = this.chaseMul;
                        } else if (!reg.test(val)) {
                            this.chaseData[i].multiple = 1;
                        } else {
                            this.chaseData[i].multiple = parseInt(val);
                        }
                    } else {
                        if (val < 1) {
                            this.chaseData[i].checked = false;
                        } else if (!reg.test(val)) {
                            this.chaseData[i].multiple = 1;
                            this.chaseData[i].checked = true;
                        } else {
                            this.chaseData[i].multiple = parseInt(val);
                            this.chaseData[i].checked = true;
                        }
                    }
                },
                //追号 更改单期checkbox
                checkB: function(i, val) {
                    if (val) {
                        this.chaseData[i].multiple = this.chaseMul;
                    } else {
                        this.chaseData[i].multiple = '';
                    }
                },

                //合买 全额保底
                allBd: function() {
                    if (!this.jion.isAll) {
                        this.jion.bd_share = this.bdMax;
                    }
                },
                isAllBd: function(val) {
                    if (val == this.bdMax) {
                        this.jion.isAll = true;
                    } else {
                        this.jion.isAll = false;
                    }
                },
                checkJion: function(val) {
                    if (val + this.jion.bd_share > this.jion.total_share) {
                        this.jion.bd_share = this.bdMax;
                        this.jion.isAll = true;
                    } else {
                        this.jion.isAll = false;
                    }
                },
                channelInputLimit :function(e) {
                    let key = e.key
                    // 不允许输入'e'和'.'
                    if (key === 'e' || key === '.') {
                        e.returnValue = false
                        return false
                    }
                    return true
                },
                //计算金额（每份金额*购买份数，保留2位小数）
                countShareMoney:function (share) {
                    return accMul(this.perMoney,share,3)
                },

                //提交订单 判断是否登录
                submit: function() {
                    var _this4 = this;

                    $.get('{:url("login/checkLogin")}', function (res) {
                        if (!res.err) {
                            _this4.nickname = res.nickname;
                            _this4.accountMoney = res.money;
                            _this4.isNotes();
                        } else {
                            _this4.loginVisible = true;
                            _this4.loginType = 0;
                        }
                    });
                },
                //登录成功
                loginSuccess: function(v) {
                    var _this5 = this;

                    this.nickname = v[0];
                    this.accountMoney = v[1];
                    this.loginVisible = false;
                    if (this.loginType == 0) {
                        setTimeout(function () {
                            _this5.isNotes();
                            _this5.loginType = -1;
                        }, 500);
                    }
                },
                //退出登录
                loginOut: function() {
                    $.get('{:url("login/logout")}', function () {
                        window.location.reload();
                    });
                },
                //刷新余额
                refreshMoney:function () {
                    var _this = this;
                    _this.$set(_this,'accountMoney','...')
                    $.get('/index/user/getinfo', function (res) {
                        _this.$set(_this,'accountMoney',res.data.money)
                    });
                },
                //投注注数是否为0
                isNotes: function() {
                    if (!this.bet.betArr.length) {
                        this.$alert('至少选择1注号码才能投注，请先选择方案！', '提示', {
                            confirmButtonText: '确定',
                            type: 'warning',
                            center: true,
                            lockScroll: false,
                            showClose: false
                        });
                        return;
                    }
                    if (this.bet.isChase) {
                        if (this.issueTotal < 2) {
                            this.$alert('追号至少选择 2 期(包括当前期)!', '提示', {
                                confirmButtonText: '确定',
                                type: 'warning',
                                center: true,
                                lockScroll: false,
                                showClose: false
                            });
                            return;
                        }
                    }
                    if (!this.bet.checked) {
                        this.$alert('请仔细阅读相关协议！', '提示', {
                            confirmButtonText: '确定',
                            type: 'error',
                            center: true,
                            lockScroll: false,
                            showClose: false
                        });
                        return;
                    }
                    if (this.bet.buyType == 1) {
                        //是否合买
                        this.order.type = '自购';
                    } else {
                        this.order.type = '合买';
                    }
                    //支付总金额
                    var money;
                    if (this.bet.buyType == 2) {
                        money = accMul(this.jion.buy_share + this.jion.bd_share,this.perMoney,3); //合买
                    } else if (this.bet.buyType == 1 && this.bet.isChase) {
                        money = this.chaseMoney; //自购追号
                    } else {
                        money = this.zgMoney; //自购
                    }
                    this.order.money = money;
                    this.orderVisible = true;
                },

                //确认提交-支付
                submitOrder: function() {
                    var _this = this;
                    _this.notDo = true;
                    var type, stop, gain;
                    gain = _this.jion.gain.substring(0, _this.jion.gain.length - 1); //去掉%
                    if (_this.bet.buyType == 1) {
                        //是否合买
                        type = 0;
                    } else {
                        type = 1;
                    }
                    //中奖是否停止
                    if (_this.isStop) {
                        stop = 1;
                    } else {
                        stop = 0;
                    }
                    //处理post期号、倍数数组
                    if (!_this.bet.isChase) {
                        //未追号
                        var arr = [];
                        var expect = {};
                        expect['expect'] = _this.defaultInfo.issue;
                        expect['multiple'] = _this.bet.multiple;
                        arr.push(expect);
                        _this.$set(_this.bet, 'expectArr', arr);
                    } else {
                        //追号
                        var arr = [];
                        for (var i = 0; i < _this.chaseData.length; i++) {
                            if (_this.chaseData[i].checked) {
                                arr.push({ expect: _this.chaseData[i].issue, multiple: _this.chaseData[i].multiple });
                            }
                        }
                        _this.$set(_this.bet, 'expectArr', arr);
                    }
                    var data = {
                        play_num: JSON.stringify(_this.bet.betArr),
                        expect: JSON.stringify(_this.bet.expectArr),
                        lottery_name: '{$name}',
                        is_hemai: type,
                        is_stop: stop,
                    }
                    if(type){
                        data['total_share'] = _this.jion.total_share
                        data['buy_share'] = _this.jion.buy_share
                        data['bd_share'] = _this.jion.bd_share
                        data['gain'] = gain
                        data['show'] = _this.jion.infoState
                        data['declaration'] = _this.jion.declaration || '这个家伙很懒，只想中大奖！'
                    }
                    $.post('{:url("betting")}', data, function (res) {
                        if (!res.err) {
                            _this.orderVisible = false;
                            setTimeout(function () {
                                _this.$alert(res.msg, '提示', {
                                    confirmButtonText: '确定',
                                    type: 'success',
                                    center: true,
                                    lockScroll: false,
                                    showClose: false
                                });
                                _this.accountMoney = _this.accountMoney - _this.order.money;
                            }, 300);
                            _this.clearList();
                            _this.bet.buyType = 1;
                            _this.isStop = false;
                            _this.bet.isChase = false;
                            _this.bet.multiple = 1;
                            _this.chaseNum = 10;
                            _this.chaseMul = 1;
                            _this.jion.isAll = false;
                            _this.jion.infoState = 0;
                            _this.jion.buy_share = 0;
                            _this.jion.total_share = 0
                            _this.jion.bd_share = 0;
                            _this.jion.gain = '0%';
                            _this.jion.declaration = '';
                            _this.getRecordData();//更新投注记录列表
                        } else {
                            _this.$alert(res.msg, '提示', {
                                confirmButtonText: '确定',
                                type: 'warning',
                                center: true,
                                lockScroll: false,
                                showClose: false
                            });
                        }
                        _this.notDo = false;
                    });
                },
                //跳转至充值页面
                goPay: function() {
                    location.href = '{:url("./pay")}';
                },

                //玩法介绍链接
                playLink: function() {
                    var _this7 = this;
                    if(_this7.playLinkUrl.length){
                        window.open(_this7.playLinkUrl)
                    }else {
                        _this7.$message({
                            showClose: true,
                            message: '暂无相关玩法介绍',
                            type: 'error'
                        });
                    }
                },
                //获取我的投注记录
                getRecordData:function () {
                    var _this = this
                    $.get('/web/details/games?gameid={$name}&limit=20',function (res) {
                        _this.$set(_this,'recordData',res.data)
                    })
                }
            },
            created: function() {
                var _this = this;
                _this.setTime();
                if (parseInt(_this.isGet)) {
                    _this.getNewCode();
                }
                $.get('{:url("news/getLotteryNew")}', {
                    name: '{$name}'
                }, function (res) {
                    if (!res.err) {
                        _this.$set(_this,'playLinkUrl',res.url)
                    }
                });
                //获取投注记录
                _this.getRecordData();
            }
        });
        document.addEventListener("visibilitychange", function (e) {
            if(!e.path[0].hidden){
                vm.getIssueInfo();
            }
        }, false);
    })
</script>