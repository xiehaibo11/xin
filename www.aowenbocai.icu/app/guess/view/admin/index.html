{include file='admin@common/head' /}
<link rel="stylesheet" href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css">
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<nav class="plugin_nav">
    <a class="nav_active" href="{:url('index')}">题目列表</a>
    <a href="{:url('addGuess')}">添加题目</a>
</nav>
<div id="app">
    <div class="box-padding">
        <div class="breadcrumb">
            <ol class="">
                <li class="active"><i class="glyphicon glyphicon-link"></i> 题目列表</li>
            </ol>
            <form class="form-inline" id="search">
                <div class="form-group form-group-left" style="margin-left:1rem;">
                    <label>题目：</label>
                    <input type="text" name="title" class="form-control" value="{$query.title|default=''}"
                           placeholder="题目">
                </div>
                <div class="form-group form-group-left" style="margin-left:1rem;">
                    <label>开始时间：</label>
                    <div class='input-group date' id='begintime' data-date-format="yyyy-mm-dd">
                        <input type='text' class="form-control" name="start_time"
                               value="{$query.start_time|default=''}"/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                    </div>
                </div>
                <div class="form-group form-group-left" style="margin-left:1rem;">
                    <label>结束时间：</label>
                    <div class='input-group date' id='endtime' data-date-format="yyyy-mm-dd">
                        <input type='text' class="form-control" name="end_time" value="{$query.end_time|default=''}"/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                    </div>
                </div>
                <div class="form-group form-group-left" style="margin-left:1rem;">
                    <label>开奖时间：</label>
                    <div class='input-group date' id='opentime' data-date-format="yyyy-mm-dd">
                        <input type='text' class="form-control" name="open_time" value="{$query.open_time|default=''}"/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                    </div>
                </div>
                <button type="submit" class="btn btn-default form-group-left btn-sm">搜索</button>
            </form>
            <div class="clear"></div>
        </div>
        <div class="table_box">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th width="90" class="tc">ID</th>
                    <th>题目</th>
                    <th width="100" class="tc">类型</th>
                    <th width="200">开奖依据</th>
                    <th width="150">答案</th>
                    <th width="180" class="tc">开始时间</th>
                    <th width="180" class="tc">开奖时间</th>
                    <th width="100" class="tc">状态</th>
                    <th width="200" class="tc">操作</th>
                </tr>
                </thead>
                <tbody>
                {volist name="list" id="item"}
                <tr>
                    <td class="tc">{$item.id}</td>
                    <td>{$item.title}</td>
                    <td class="tc">{$item.type}</td>
                    <td>{$item.basis}</td>
                    <td>{$item.answer}</td>
                    <td class="tc">{$item.start_time}</td>
                    <td class="tc">{$item.open_time}</td>
                    <td class="tc">{$item.status}</td>
                    <td class="tc">
                        <div class="btn-group" role="group" aria-label="...">
                            <?php if ($item['open_time'] <= date('Y-m-d H:i:s') && $item->getData('answer') == null) {
                            ?>
                            <a href="{:url('awards','id='.$item.id)}" class="btn btn-info btn-xs">开奖</a>
                            <?php } ?>
                            <a href="{:url('editGuess', 'id='.$item.id)}" class="btn btn-info btn-xs">修改</a>
                            <a href="#" class="btn btn-info btn-xs isdelete" data-url="{:url('delete','id='.$item.id)}">删除</a>
                        </div>
                    </td>
                </tr>
                {/volist}
                </tbody>
            </table>
        </div>
        <div class="text-right">{$list->render()}</div>
    </div>
</div>

{include file='admin@common/foot' /}
<script>
    $(function () {
        $('.isdelete').click(function () {
            var _url = $(this).data("url");
            $.modal.confirm('你是否确定删除', function () {
                location.href = _url;
            });
        });
        $('#begintime,#endtime, #opentime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });
    });
</script>
