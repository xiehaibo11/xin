{include file='common/head' /}

<link href="__CSS__/webuploader/webuploader.css" media="all" rel="stylesheet" type="text/css" />
<link href="__CSS__/webuploader/webuploader-base.css" media="all" rel="stylesheet" type="text/css" />
<script src="__JS__/webuploader/webuploader.js" type="text/javascript"></script>

<style media="screen">
    .form{
      margin:20px;
      width: 400px;
    }
  .form textarea{
    width: 100%;
    height: 7rem;
  }
</style>

<div id="app">
  <div>
    <form class="form" action="{:url('add')}" @submit="formsubmit" @submit.prevent="onSubmit">
      <div class="form-group">
        <label>商品名</label>
        <input type="text" class="form-control" placeholder="输入商品名" name="name">
      </div>
      <div class="form-group">
        <label>商品价格</label>
        <input type="number" class="form-control" placeholder="输入商品价格" name="money">
      </div>
      <div class="form-group">
        <label>商品件数</label>
        <input type="number" class="form-control" placeholder="商品件数" name="all_num">
      </div>
      <div class="form-group">
        <label>商品描述</label><br/>
        <textarea placeholder="输入商品描述" name="detail"></textarea>
      </div>
      <div class="page-container">
        <p>上传商品图片</p>
        <div id="uploader" class="wu-example" style="background: #fafafa;padding: .5rem;margin-bottom: 1rem;border-radius: .7rem;">
          <div class="queueList">
            <div id="dndArea" class="placeholder">
              <div id="filePicker"></div>
              <p>或将照片拖到这里，单次最多可选300张</p>
            </div>
          </div>
          <div class="statusBar" style="display:none;">
            <div class="progress">
              <span class="text">0%</span>
              <span class="percentage"></span>
            </div>
            <div class="info"></div>
            <div class="btns">
              <div id="filePicker2"></div>
              <div class="uploadBtn">开始上传</div>
            </div>
          </div>
        </div>
      </div>
      <button type="submit" class="btn btn-default">提交</button>
    </form>
  </div>
</div>
<script>
      // 这里吧开始上传隐藏了，因为是表单触发上传，不用上传多张图片 也把继续上传也隐藏了
      $(".uploadBtn,#filePicker2").hide();
      var upload_config = {
          // 上传地址
          url: '/admin/shop/upload/',
          // 上传回调
          callback:(res) => {
            if(res.code){
                $.post('{:url("/admin/shop/add")}',$("form").serialize() + '&img_type=' + res.save_type ,(res)=>{
                    $.modal.alert(res.msg);
                });
            }else{
                $.modal.alert(res.msg);
            }
          }
      };

      let vm = new Vue({
          el: '#app',
          created(){
          },
          computed: {
          },
          methods: {
              formsubmit(){
                  $('.uploadBtn').trigger('click');
              }
          }
      });
</script>
<script src="__JS__/webuploader/webuploader-base.js" type="text/javascript"></script>
{include file='common/foot' /}
