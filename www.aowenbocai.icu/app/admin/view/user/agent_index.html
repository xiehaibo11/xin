{include file='common/head' /}
<link href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>


<style media="screen">
    .add-botton {
        float: right;
        margin-right: 30px;
    }

    .box-padding-bottom {
        padding-bottom: 15px;
    }

    .box-padding {
        padding: 20px;
    }

    .form-group-left {
        margin-left: 15px;
    }
</style>
<div class="box-padding">
    <div class="breadcrumb">
        <ol class="">
            <li class="active"><i class="glyphicon glyphicon-link"></i> 代理管理</li>
            {if condition="$query.userid"}<li><a href="javascript:history.back(-1);" class="btn btn-default form-group-left btn-sm">返回</a></li>{/if}
        </ol>
        <form class="form-inline" action="">
            <div class="form-group form-group-left">
                <label>时间</label>
                <div class='input-group date' id='begintime' data-date-format="yyyy-mm-dd">
                    <input type='text' class="form-control" name="starttime" value="{$query.starttime}" />
                    <span class="input-group-addon">
                          <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
                <label>到</label>
                <div class='input-group date' id='endtime' data-date-format="yyyy-mm-dd">
                    <input type='text' class="form-control" name="endtime" value="{$query.endtime}" />
                    <span class="input-group-addon">
          <span class="glyphicon glyphicon-calendar"></span>
        </span>
                </div>
            </div>
            <div class="form-group form-group-left">
                <label>关键字:</label>
                <input type="text" name="words" class="form-control" value="{$query.words}" placeholder="关键字/用户名/操作/IP/地址">
            </div>
            <input type="hidden" id="sort_field" name="sort_field" value="{$query.sort_field}">
            <input type="hidden" id="sort_asc" name="sort_asc" value="{$query.sort_asc}">
            <button type="submit" class="btn btn-default form-group-left btn-sm">搜索</button>
            <div class="add-botton">
                <a href="{:url('admin/User/add')}" class="btn btn-primary btn-sm" role="button"><img height="16" src="/static/admin/svg/user_online.svg" alt=""> 添加会员</a>
            </div>
        </form>
    </div>
  <div class="table_box">
      <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th width="110" class="sort_btn tc" data-field="id">用户ID</th>
          <th width="60" class="tc">头像</th>
          <th width="150" class="tc">昵称</th>
          <th width="100" class="tc">用户名</th>
          <th width="100" class="tc">上级</th>
          <th width="120" class="sort_btn tc" data-field="money">余额</th>
          <th width="120" class="sort_btn tc" data-field="game_money">游戏币余额</th>
          <th width="180"  class="sort_btn tc" data-field="action_time">最后活动时间</th>
          <th width="80" class="tc">类型</th>
          <th width="80" class="tc">状态</th>
          <th class="tc" width="320">操作</th>
        </tr>
      </thead>
    {foreach $list as $item}
    <tr>
      <td class="tc">{$item.id}</td>
      <td class="tc"><img src="{$item.photo}" alt="" width="30" height="30" class="img-circle"> </td>
      <td class="tc">{if condition="$item.type == 2"} <a title="点击查看下级" href="{:url('agent_list')}?userid={$item.id}">{$item.nickname}</a>{else /} {/if}</td>
      <td class="tc">{$item.username}</td>
      <td class="tc">{$item.agents_name}</td>
      <td class="tc"><span class="user_money">{$item.money}</span></td>
      <td class="tc"><span class="user_money">{$item.game_money}</span></td>
      <td class="tc">{$item.action_time}</td>
      <td class="tc">{$item.typename}</td>
      <td class="tc">{$item.status}</td>
      <td class="tc">
        <div class="user_action">
          <div>
            <a href="{:url('recharge', ['userid' => $item.id])}" class="btn btn-primary btn-xs"><img height="16" src="/static/admin/svg/send_msg.svg" alt=""> 充值</a>
            <a href="{:url('admin/User/edit')}?id={$item.id}" class="btn btn-danger btn-xs"><img height="16" src="/static/admin/svg/editor.svg" alt=""> 修改</a>
            <a href="{:url('goto')}?userid={$item.id}" target="_blank" class="btn btn-warning btn-xs"><img height="16" src="/static/admin/svg/look2.svg" alt=""> 登录</a>
            <!--<a href="{:url('send_message', ['userid' => $item.id])}" class="btn btn-success btn-xs"><img height="16" src="/static/admin/svg/send_msg.svg" alt=""> 消息</a>-->
            <a href="#" class="btn btn-primary btn-xs isdelete" data-url="{:url('delete', ['id' => $item.id])}"><i class="icon-trash"></i> 删除</a>
          </div>
        </div>
      </td>
    </tr>
    
    {/foreach}
  </table>
  </div>

  <!-- <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>用户名</th>
        <th>注册时间</th>
        <th>注册IP</th>
        <th>余额</th>
        <th>状态</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {foreach $list as $item}
      <tr>
        <td>{$item.id}</td>
        <td>{$item.username}</td>
        <td>{$item.create_time}</td>
        <td>{$item.reg_ip}</td>
        <td>{$item.money}</td>
        <td>{$item.status}</td>
        <td>
          <div class="btn-group" role="group" aria-label="...">
            <a href="{:url('admin/User/edit')}?id={$item.id}" class="btn btn-primary btn-xs"><img height="16" src="/static/admin/svg/editor.svg" alt=""> 修改</a>
            <a href="#" class="btn btn-primary btn-xs isdelete" data-url="{:url('admin/User/delete')}?id={$item.id}"><img height="16" src="/static/admin/svg/delete.svg" alt=""> 删除</a>
            <a href="{:url('admin/User/send_message')}?id={$item.id}" class="btn btn-primary btn-xs"><img height="16" src="/static/admin/svg/send_msg.svg" alt=""> 消息</a>
          </div>
        </td>

      </tr>
      {/foreach}
    </tbody>
  </table> -->
  <div class="text-right">{$list->render()}</div>
</div>
</div>
<script type='text/javascript' src="__STATIC__/admin/list_base.js"></script>
<script>
  $(function () {
    $('.isdelete').click(function () {
      var _url = $(this).data("url");
      $.modal.confirm('<font style="color:red;">删除会员，将会删除包括资金明细在内的全部会员数据</font>，是否确认删除？', function () {
        location.href = _url;
      });
    });
    $('#begintime,#endtime').datetimepicker({
      language: 'zh-CN',
      weekStart: 1,
      todayBtn: 1,
      autoclose: 1,
      todayHighlight: 1,
      startView: 2,
			endDate : new Date(),
      minView: 2,
      forceParse: 0
    });
    $('#begintime').on('changeDate',function(e){  
			var startTime = e.date;  
			$('#endtime').datetimepicker('setStartDate',startTime);  
		});
		$('#endtime').on('changeDate',function(e){  
			var startTime = e.date;  
			$('#begintime').datetimepicker('setStartDate',startTime);  
		});
    
    $(".choice").click(function(){
      var _this = $(this).find('a');
      $(".result").text(_this.text());
      $("input[name=type]").val(_this.data('value'))
    })

    $(".choicesort").click(function(){
        var _this = $(this).find('a');
        $(".resultsort").text(_this.text());
        $("input[name=sort]").val(_this.data('value'))
    })
  });

</script>
{include file='common/foot' /}