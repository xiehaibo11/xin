{include file='common/head' /}
<link href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<div class="box-padding">
  <div class="btn-group isdelete" style="margin-bottom:20px;">
    <a href="#" data-url="{:url('admin/user/moneyDelete')}?day=30" class="btn btn-primary isdelete">清除30天前记录</a>
    <a href="#" data-url="{:url('admin/user/moneyDelete')}?day=15" class="btn btn-primary isdelete">清除15天前记录</a>
    <a href="#" data-url="{:url('admin/user/moneyDelete')}?day=7" class="btn btn-primary isdelete">清除7天前记录</a>
    <a href="#" data-url="{:url('admin/user/moneyDelete')}?day=3" class="btn btn-primary isdelete">清除3天前记录</a>
    <a href="#" data-url="{:url('admin/user/moneyDelete')}?day=1" class="btn btn-primary isdelete">全部清除</a>
  </div>
  <div class="breadcrumb">
    <ol class="">
      <li class="active"><i class="glyphicon glyphicon-link"></i> 资金明细</li>
    </ol>
    <form class="form-inline">
      <div class="form-group form-group-left">
        <label>时间</label>
        <div class='input-group date' id='begintime' data-date-format="yyyy-mm-dd">
          <input type='text' class="form-control" name="starttime" value="{$query.starttime}"/>
          <span class="input-group-addon">
              <span class="glyphicon glyphicon-calendar"></span>
          </span>
        </div>
        <label>到</label>
        <div class='input-group date' id='endtime' data-date-format="yyyy-mm-dd">
          <input type='text' class="form-control" name="endtime" value="{$query.endtime}"/>
          <span class="input-group-addon">
              <span class="glyphicon glyphicon-calendar"></span>
          </span>
        </div>
      </div>
      <div class="form-group">
        <input type="hidden" name="type" value="{$query.type}">
        <div class="dropdown" style="display:inline-block">
          <button type="button" class="btn dropdown-toggle" id="" data-toggle="dropdown"><span class="typename">{$type_txt}</span>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="">
            <li role="presentation"  class="typeSelect">
              <a role="menuitem" tabindex="-1" data-id="">全部</a>
            </li>
            {volist name="$type_list" id="item"}
            <li role="presentation"  class="typeSelect">
              <a role="menuitem" tabindex="-1" data-id="{$key}">{$item}</a>
            </li>
            {/volist}
          </ul>
        </div>
      </div>
      <div class="dropdown form-group" >
        <label>资金来源:</label>
        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1"
                data-toggle="dropdown">
              <span class="result">
                  {present name = "$extname"}
                  {$extname[0]}
                  {else /}
                  全部模块
                  {/present}
              </span>
          <span class="caret"></span>
        </button>
        <input type="hidden" name="ext" value="{$query.ext}">
        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" style="text-align:right">
          <li role="presentation" class="choice">
            <a role="menuitem" data-value =''>全部模块</a>
          </li>
          {volist name = "ext" id = "item"}
          <li role="presentation" class="choice">
            <a role="menuitem"  data-value = "{$item.name}">{$item.title}</a>
          </li>
          {/volist}
        </ul>
      </div>
      <div class="form-group form-group-left">
        <label>关键字:</label>
        <input type="text" name="words" class="form-control" value="{$query.words}" placeholder="关键字/用户名/操作/IP/地址">
      </div>
      <input type="hidden" id="sort_field" name="sort_field" value="{$query.sort_field}">
      <input type="hidden" id="sort_asc" name="sort_asc" value="{$query.sort_asc}">
      <button type="submit" class="btn btn-danger form-group-left btn-sm">搜索</button>
      <button type="button" data-url="{:Url('moneyExportExcel')}" class="btn btn-default form-group-left btn-sm excel_btn">导出Excel</button>

    </form>
    <div class="clear"></div>
  </div>
  <div class="clear"></div>
  <div class="table_box">
    <table class="table table-striped table-bordered table-hover">
      <thead>
      <tr>
        <th class="sort_btn" data-field="id">ID</th>
        <th>用户昵称（用户名）</th>
        <th>生成时间</th>
        <th>来源</th>
        <th>操作前</th>
        <th>操作后</th>
        <th class="sort_btn" data-field="money">金额</th>
        <th width="290">备注</th>
      </tr>
      </thead>
      <tbody>
      {foreach $list as $item}
      <tr>
        <td>{$item.id}</td>
        <td>{$item.nickname}（<a>{$item.username}</a>）</td>
        <td>{$item.create_time}</td>
        <td>{$item.extname}</td>
        <td>{$item.before}</td>
        <td>{$item.after}</td>
        <td class="text_money {$item.money > 0 ? 'text-success' : 'text-danger'}">{$item.money}</td>
        <td>{$item.remark}</td>

      </tr>
      {/foreach}
      </tbody>
    </table>
  </div>
  <div class="text-right">{$list->render()}</div>
</div>
</div>
<script type='text/javascript' src="__STATIC__/admin/list_base.js"></script>
<script>
    $(function () {
        $('.isdelete a').click(function() {
            var _url = $(this).data("url");
            $.modal.confirm('你是否确定删除', function() {
                location.href = _url;
            });
        });
        $('.excel_btn').click(function() {
            var url = $(this).data("url");
            var param="";
            var t = $('form').serializeArray();
            $.each(t, function(i) {
                if (i==0) {
                    param = this.name+"="+this.value;
                } else {
                    param += "&"+this.name+"="+this.value;
                }

            });
            window.open(url+"?"+param);
        });
        $('#begintime,#endtime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });
      $(".choice").click(function(){
        var _this = $(this).find('a');
        $(".result").text(_this.text());
        $("input[name=ext]").val(_this.data('value'))
      })
      $(".typeSelect").click(function(){
          var _this = $(this).find('a');
          $(".typename").text(_this.text());
          $("input[name=type]").val(_this.data('id'))
      })
    });
</script>
{include file='common/foot' /}
