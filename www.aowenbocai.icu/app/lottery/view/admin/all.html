{include file='admin@common/head' /}
<link href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<style>
    .form-group{
        margin-bottom: 0;
    }
    li a {cursor: pointer;}
    i, em {
        font-style: normal;
    }
    .betting i {
        color:#999;
        margin-right:3px;
    }
    .betting em {
        margin-left:5px;
    }
</style>
<div id="app">
    <div class="box-padding">
        <div class="search breadcrumb">
            <div class="form-group form-group-left fl" >
                <label>选择彩种:</label>
                <div class="dropdown" style="display:inline-block">
                    <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">{$lotteryName}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation">
                            <a role="menuitem" class="choiceLottey" tabindex="-1" data-href={neq name="$lotteryName" value="所有彩种"}"{:url('')}"{/neq}>所有彩种</a>
                        </li>
                        {volist name="$extList" id="item"}
                        <li role="presentation">
                            <a role="menuitem" class="choiceLottey" tabindex="-1" data-href={neq name="$item.title" value="$lotteryName"}"{:url('allList',['gameid'=> $item.id])}" {/neq}>{$item.title}</a>
                        </li>
                        {/volist}
                    </ul>
                </div>
            </div>
            <form class="form-inline" id="search">
                <div class="form-group form-group-left">
                    <label>会员名:</label>
                    <input type="text" name="username" class="form-control" {present name="$query.username"} value="{$query.username}" {/present}placeholder="会员名">
                </div>
                <div class="form-group form-group-left">
                    <label>方案号:</label>
                    <input type="text" name="lottery_id" class="form-control" {present name="$query.lottery_id"} value="{$query.lottery_id}" {/present}placeholder="方案号">
                </div>
                <div class="form-group form-group-left">
                    <label>期号:</label>
                    <input type="text" name="expect" class="form-control" {present name="$query.expect"} value="{$query.expect}" {/present} placeholder="期号">
                </div>
                <div class="form-group form-group-left">
                    <label>时间</label>
                    <div class='input-group date' id='begintime' data-date-format="yyyy-mm-dd">
                        <input type='text' class="form-control" name="starttime" {present name="$query.starttime"} value="{$query.starttime}" {/present}/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                    </div>
                    <label>到</label>
                    <div class='input-group date' id='endtime' data-date-format="yyyy-mm-dd">
                        <input type='text' class="form-control" name="endtime" {present name="$query.endtime"} value="{$query.endtime}" {/present}/>
                        <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                    </div>
                </div>
                <div class="form-group form-group-left">
                    <label>状态:</label>
                    <select name="status" class="form-control" id="">
                        <option value="">全部</option>
                        <option value="1" {if condition="isset($query.status) and $query.status == 1"} selected{/if}>进行中</option>
                        <option value="2" {if condition="isset($query.status) and $query.status == 2"} selected{/if}>已中奖</option>
                        <option value="3" {if condition="isset($query.status) and $query.status == 3"} selected{/if}>未中奖</option>
                        <option value="4" {if condition="isset($query.status) and $query.status == 4"} selected{/if}>撤单</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-default form-group-left btn-sm">搜索</button>
            </form>
            <div class="clear"></div>
        </div>
        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <!--<th>ID</th>-->
                <th>昵称</th>
                <th>方案号</th>
                <th>期号</th>
                <th>彩种</th>
                <th>购买金额</th>
                <th>总金额</th>
                <!--<th>合买/追号</th>-->
                <th>总奖金</th>
                <th>开奖号码</th>
                <th>投注方案</th>
                <th>投注时间</th>
                <th>订单状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {volist name="$data.data" id ="item"}
            <tr>
                <!--<td>{$item.id}</td>-->
                <td>{$item.nickname}</td>
                <td><a href="{:url('/web/orders/index')}?lottery_id={$item.lottery_id}&id={$item.id}" target="_blank" class="show_content">{$item.lottery_id}</a></td>
                <td>{$item.buy_info.expect}</td>
                <td>{$item.ext_name_txt}</td>
                <td>{$item.user_buy}</td>
                <td>{$item.total_money}</td>
                <!--<td>{eq name="$item.is_join" value="1"}<span style="color:#7961ff">是</span>{else /}否{/eq}/{eq name="$item.buy_info.isChase" value="1"}<span style="color:red">是</span>{else /}否{/eq}</td>-->
                <td>{$item.buy_info.bonus}</td>
                <td>{$item.code}</td>
                <td class="betting">
                    {volist name="item.betting" id="v"}
                    <div>{$v}</div>
                    {/volist}
                </td>
                <td>{$item.create_time}</td>
                <td>{$item.buy_info.status}</td>
                <td>
                    <div class="btn-group" role="group" aria-label="...">

                        <!--<a data-url="{:url('outOfTicket')}" data-id = "{$item.id}" data-num = "{$key + 1}"  data-lottery = '{$item.lottery_id}'class="btn btn-info btn-xs btn-ticket">出票</a>-->
                        {if condition="$item.buy_info.statusCode <= 1 "}
                        <a data-url="{:url('returnTicket')}"  data-id = "{$item.id}" data-num = "{$key + 1}"  data-lottery = '{$item.lottery_id}' class="btn btn-info btn-xs isback">撤单</a>
                        {/if}
                        <a class="btn btn-info isdelete btn-sm" data-num = "{$key + 1}" data-url="{:url('buyDelete', ['id' => $item.id, 'lotteryId' => $item.lottery_id])}">删除</a>
                    </div>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>
        <div class="tr">
            {$page_html}
        </div>
    </div>
</div>


{include file='admin@common/foot' /}
<script>
    $(function () {
        $('.isdelete').click(function() {
            var _this = $(this);
            var e = $.modal.confirm('你是否确定删除', function() {
                var num = _this.data('num');
                $.get(_this.data("url"), {id: _this.data('id'), lotteryId: _this.data('lottery')}, function(res){
                    e.close();
                    $.modal.alert(res.msg);
                    if(!res.err){
                        $(".table").find('tr').eq(num).hide ();
                    }
                })
            });
        });
        $('.isback').click(function() {
            var _this = $(this);
            var e = $.modal.confirm('你是否确定撤单', function() {
                var num = _this.data('num');
                $.get(_this.data("url"), {id: _this.data('id'), lotteryId: _this.data('lottery')}, function(res){
                    e.close();
                    $.modal.alert(res.msg);
                    if(!res.err){
                        var trNum = $(".table").find('tr').eq(num);
                        trNum.find('td').eq(9).text('撤单成功');
                    }
                })
            });
        });

        $(".btn-ticket").click(function(){
            var _this = $(this);
            var num = _this.data('num');
            $.get(_this.data("url"), {id: _this.data('id'), lotteryId: _this.data('lottery')}, function(res){
                $.modal.alert(res.msg);
                if(!res.err){
                    var trNum = $(".table").find('tr').eq(num);
                    trNum.find('td').eq(9).text('出票成功');
                }
            })
        })

        $(".choiceLottey").click(function(){
            $href = $(this).data('href');
            if($href){
                location.href = $href+location.search
            }
        })
        $(".rechoice").click(function(){
            var _this = $(this).find('a');
            $(".reresult").text(_this.text());
            $("input[name=status]").val(_this.data('value'))
        })
        $('#begintime,#endtime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 2,
            forceParse: 0
        });
    });
</script>