{include file='admin@common/head' /}
<link href="__STATIC__/bootstarp-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="__STATIC__/bootstarp-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<style>
    .form-group{
        margin-bottom: 0;
    }

</style>
<div id="app" class="box-padding">
    <div class="breadcrumb">
        <div class="form-group form-group-left fl" >
            <label>选择彩种:</label>
            <div class="dropdown" style="display:inline-block">
                <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">{$lotteryName}
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                    {volist name="$extList" id="item"}
                    <li role="presentation">
                        <a role="menuitem" tabindex="-1"{neq name="$item.title" value="$lotteryName"} href="{:url('system_code', ['name'=>trim($item.name, '/')])}" {/neq}>{$item.title}</a>
                    </li>
                    {/volist}
                </ul>
            </div>
        </div>
        <div class="form-group form-group-left fl" >
            <a data-url="{:url('index/api/openCode', ['name'=> $name, 'is_new' => 1])}" class="btn btn-default add_code" role="button"><i class="glyphicon glyphicon-plus"></i> 生成开奖号码</a>
            {if condition="$yesterday"}
            <a href="{:url('system_code', ['name'=> $name])}" class="btn btn-default" role="button">今天的号码</a>
            {else /}
            <a href="{:url('system_code', ['name'=> $name, 'yesterday' => 1])}" class="btn btn-default" role="button">昨天的号码</a>
            {/if}
        </div>
        <div class="search fr">
            <a href="{:url('system_code_admin')}" class="btn btn-danger" role="button">系统开奖彩种管理</a>
        </div>
        <div class="clear"></div>
    </div>
    <table class="table table-striped table-bordered table-hover">
        <thead>
        <tr>
            <th width="240">期号</th>
            <th>开奖号码</th>
            <th width="240">开奖时间</th>
            <th width="240" class="tc">操作</th>
        </tr>
        </thead>
        <tbody>
        {volist name="$list" id="item"}
        <tr>
            <td>{$item.expect}</td>
            <td>{$item.code}</td>
            <td>{$item.create_time}</td>
            <td class="tc">
                <div class="btn-group" role="group" aria-label="...">
                    {if condition="!$item.status"}
                    <a href="{:url('push_system_code', ['name'=>$name, 'expect'=>$item.expect])}" class="btn btn-primary btn-sm">开奖</a>
                    <a href="{:url('edit_system_code', ['name'=>$name, 'expect'=>$item.expect])}" class="btn btn-success btn-sm">修改</a>
                    {else /}
                    <span style="color: #999;">已开奖</span>
                    {/if}
                </div>
            </td>
        </tr>
        {/volist}
        </tbody>
    </table>
</div>

{include file='admin@common/foot' /}
<script>
    $(function () {
        $('.add_code').click(function () {
            var _this = $(this);
            var e = $.modal.confirm('你是否确定生成开奖号码', function () {
                $.post(_this.data("url"), {name: '{$name}'}, function(res){
                    e.close();
                    if(!res.err){
                        $.modal.alert('生成成功');
                        setTimeout(function(){
                            window.location.reload();
                        }, 1000)
                    } else {
                        $.modal.alert(res.msg);
                    }
                })
            });
        });
        $('.isdelete').click(function () {
            var _this = $(this);
            var e = $.modal.confirm('你是否确定删除', function () {
                $.post(_this.data("url"), {id: _this.data('id'), name: _this.data('name')}, function(res){
                  e.close();
                  $.modal.alert(res.msg);
                  if(!res.err){
                    var num = _this.data('num');
                    $(".table").find('tr').eq(num).hide ();
                  }
                })
            });
        });
    });
</script>