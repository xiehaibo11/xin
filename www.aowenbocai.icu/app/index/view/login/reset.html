{include file='common@common/head' /}

  <style>

    body {
       background-color: #efeff4;
    }

   button.btn,
     a.btn
    {
      display: block;
      margin-top: 1rem;
      width: 100%;
    }
    .icon-svg {
      margin: .4rem;
    }
    .text-center {
      text-align: center;
      color: #666;
      font-size: .7rem;
    }
    .header{background-color: #f7f7f7;-webkit-box-shadow: 0 0 3px #ccc;box-shadow: 0 0 3px #ccc;border-bottom: none;}
    .login-input{margin: 20px 0;border-top: 1px solid #dedede;border-bottom: 1px solid #dedede;padding: 0 .6rem;background-color: #fff;}
    .input-lg{font-size: 0.8rem;}
    button.btn-login{color: #FFF;background: #0894ec;border: none;line-height: 2.0rem;font-size: 0.9rem;width: 95%;margin: 15px auto}
    .col{color: #0894ec;font-size: 0.7rem;}
    .btn-yzm{    width: 12rem; margin: 0;line-height: 1.7rem;}

  </style>
  <header class="header">
    <div class="header-nav">
        <a class="nav-word" id="cancleBtn" href="javascript:history.go(-1);" data-no-cache="true"><i class="icon-svg icon_left"></i></a>
    </div>
    <div class="header-center">{$title}</div>
  </header>
  <div class="p-height"></div>
  <div id = "app">
    <div  v-if = "issend">
     <div class="login-input">
        <div class="item-line item-lg">
          <i class="icon-svg icon_user" style="width: 1.8rem"></i>
          <input type="text" class="input input-line input-lg" placeholder="请输入手机号"  v-model="tel" ><span v-on:click="sendsms" class="btn btn-yzm">{{btnmsg}}</span>
        </div>
        <div class="item-line item-lg">
          <i class="icon-svg icon_password"></i>
          <input type="text" class="input input-line input-lg" placeholder="请输入验证码" v-model="telYzm">
        </div>
    </div>
    <div><button class="btn btn-fill btn-lg btn-login" v-on:click="smsToSend">确认</button></div>
    <div></div>
  </div>
  <div  id = "reset"  v-if = "isreset">
    <div class="login-input">
      <div class="item-line item-lg">
        <i class="icon-svg icon_user" ></i>
        <input type="password" class="input input-line input-lg" placeholder="输入密码" v-model="password">
      </div>
      <div class="item-line item-lg">
        <i class="icon-svg icon_password"></i>
        <input type="password" class="input input-line input-lg" placeholder="再次输入密码" v-model="notpassword">
      </div>
  </div>
  <div><button class="btn btn-fill btn-lg btn-login" v-on:click = "toReset">提交</button></div>
  <div></div>
</div>
</div>
  <div class="text-center"><a class="col"  href="/index/reg/">登录账号</a> <span>|</span> <a class="col"  href="/index/reg/">注册账号</a> </div>
{include file='common@common/foot' /}
<script>
    $(function () { 
        // $("#smsToSend").formAjax({
        //     callback: function (data) {
        //         $.msg(data.msg);

        //         if (data.code) {
        //            $("#smsToSend").hide();
        //            $("#reset").show();
        //         }
        //     }
        // });

        var vue = new Vue({
            el:"#app",
            data:{
              countDown : 120,
              tel :'',
              btnmsg :'发送验证码',
              reg :  /^1[3|4|5|7|8][0-9]{9}$/,
              telYzm : '',
              password : '',
              notpassword : '',
              isreset : 0,
              issend : 1,
              isclick:0,
              sid:''

            },
            methods:{
              sendsms : function ()
              {
                  var _this = this;
                  var res = _this.reg.test(_this.tel);
                  if(!res){
                      $.alert('手机号格式不正确，请输入正确的手机号');
                      return false;
                  }

                  $.get('/index/login/sendsms',{tel: _this.tel},function(res){
                    if(res.code == 1){
                      var interval = setInterval(function(){
                          _this.countDown = _this.countDown - 1;
                          if(_this.countDown == 0){
                            _this.btnmsg = '发送验证码';
                            _this.countDown = 120;
                            _this.isclick = 1;
                            clearInterval(interval);
                            return;
                          }
                          _this.btnmsg = "消息已发送("+_this.countDown+")";
                      },1000)
                    }
                  })
              },
              smsToSend : function ()
              {   
                  var _this = this;
                  if(! _this.telYzm){
                       $.alert('请重新输入验证码');
                      return false;
                  }
                  // if (!_this.isClick){
                  //   $.alert("非法操作，请按流程操作");
                  //   return false;
                  // }
                  $.get('/index/login/reset',{tel: _this.tel, yzm:  _this.telYzm},function (res){
                    // console.log(res);
                    if(!res.code) $.msg(res.msg)
                    if(res.code == 1){
                        _this.isreset = 1;
                        _this.issend = 0;
                        _this.sid = res.sid;
                    }
                      
                  })
              },
              toReset : function ()
              {
                  var _this = this;
                  if(_this.password !=  _this.notpassword){
                    $.alert('两次密码输入不正确');
                    return false;
                  }
                  if (!_this.sid){
                    $.alert("非法操作，请按流程操作");
                    return false;
                  }
                  $.get('/index/login/resetPwd',{sid : _this.sid,  password : _this.password, notpassword : _this.notpassword},function(res){
                    console.log(res);
                    $.msg(res.msg);
                  })
              }
            }
        })
    });
</script>
