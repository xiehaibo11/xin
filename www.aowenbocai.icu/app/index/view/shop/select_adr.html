{include file='common@common/head' /}
<script src="/static/js/loadpage.js"></script>
<style>
    p {
        padding:0;
        margin:0;
    }
    .fr {
        float: right;
    }
    .fl {
        float: left;
    }
    i {
        font-style: normal;
    }
    .box_list ul li {
        padding:0.8rem 0.5rem;

        position: relative;
        background: #fff;
    }
    .box_list ul li a {
        display: block;
    }
    .box_list ul li p {
        line-height:1rem;
        height:1rem;
        color: #000;
        overflow: hidden;
    }
    i.my_border {
        display: inline-block;
        padding:0 0.5rem;
        line-height:1rem;
        font-size:0.6rem;
        color: #666;
    }
    i.default {
        color: red;
    }
    .my_border:before{
        content: "";
        position: absolute;
        width: 200%;
        height: 200%;
        border: 1px solid #ddd;
        border-radius:0.05rem;
        transform-origin: 0 0;
        transform: scale(0.5, 0.5);
        box-sizing: border-box;
        left:0;
        top:0;
    }
    i.default.my_border:before {
        border: 1px solid red;
    }
    .box_list ul li p.city {
        color: #777;
        font-size:0.65rem;
        margin-top:0.3rem;
    }
    .fd_height {
        height:2rem;
    }
    .add_btn {
        height:2rem;
        line-height:2rem;
        position: fixed;
        bottom: 0;
        left:0;
        width:100%;
    }
    .delete_btn {
        position: absolute;
        top:1.4rem;
        right:0.5rem;
        width:0.8rem;
    }
    i.my_border {
        position: absolute;
        top:0.8rem;
        right:2rem;
        z-index:999;
    }
    .more {
        clear: both;
        height:3rem;
        line-height:3rem;
        text-align: center;
        color: #999;
        font-size:0.6rem;
    }

</style>
<header class="header">
    <div class="header-nav" >
        <a class="" href="{:Url('index/Shop/set')}">
            <i class="icon-svg icon_left"></i>
        </a>
    </div>
    <div class="header-center">{$title}</div>
    <div class="header-nav" style="padding-top: 0;padding-bottom: 0;">
        <a href="{:Url('index/Address/index')}">管理</a>
    </div>
</header>
<div class="p-height"></div>
<div class="box_list">
    <ul>
        <li class="border-b " v-for="(item, index) in list">
            <a :href="'{:Url('edit')}?id='+item.id">
                <p>
                    收货人：{{item.name}}  <i class="fr">{{item.tel}}</i></p>
                <p class="city">收货地址：{{item.city}} {{item.address}}</p>
            </a>
        </li>
    </ul>
    <template v-if="has_more">
        <div class="more" @click="loadMore" v-show="list.length > 0">点击查看更多</div>
    </template>
    <template v-else>
        <div class="more" v-show="list.length > 0">--没有更多的数据了--</div>
    </template>
</div>


{include file='common@common/foot' /}

<script>
    var page = 1;
    var vm = new Vue({
        el:'.box_list',
        data: {
            loadPage: new LoadPage('{:Url("index/Address/getList")}'),
            has_more: 1,
            list:[]
        },
        mounted: function(){
            this.$nextTick(function(){
                this.loadPage.on('first', function(res) {
                    if(res.data.list.data.length == res.data.list.total){
                        vm.has_more = 0;
                    }
                    Vue.set(vm, 'list', res.data.list.data);
                });
                this.loadPage.on('next',  function(res) {
                    if(res.data.list.data.length > 0){
                        vm.list.push(res.data.list.data);
                    }else{
                        vm.has_more = 0;
                    }
                });
                this.loadPage.first();
            })
        },
        methods: {
            loadMore:function(){
                this.loadPage.next();
            },
            deleteAddress:function(item, index){
                $.confirm('确认删除吗', {
                    yes: function() {
                        $.get('{:Url("delete")}',{id:item.id} ,function(res) {
                            $.msg(res.msg);
                            if (res.code) {
                                vm.list.splice(index, 1);
                            }
                        });
                    }
                });

            },
            defaultChange:function(item){
                $.get('{:Url("changeDefault")}',{id:item.id} ,function(res) {
                    $.msg(res.msg);
                    if (res.code) {
                        vm.list.forEach(function(value, index) {
                            value.status = 0;
                            item.status = 1;
                        })
                    }
                });
            },
        }
    });

</script>
