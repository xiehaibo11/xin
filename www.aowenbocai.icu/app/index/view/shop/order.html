{include file='common@common/head' /}
<style>
  .form {
    margin: .5rem;
  }
  p {
    padding:0;
    margin:0;
  }
  i {
    font-style: normal;
  }
  a {
    color: #000;
    font-size:0.65rem;
  }
  .form button.btn
  {
    display: block;
    margin-top: 1rem;
    width: 100%;
  }
  .icon-svg {
    display: inline-block;
    margin: .4rem 0;
  }
  textarea.input.input-lg  {
    line-height:1rem;
    padding:0.2rem;
    resize: none;
    font-size: 0.7rem;
    border-radius: 0.2rem;
  }
  a.select_adr {
    display: block;
    padding:0.6rem 1.7rem 0.6rem 0.8rem;
    position: relative;
    background: #ebebeb;
  }
  a.select_adr p {
    line-height:0.8rem;
  }
  a.select_adr p.city {
    color: #9598b9;
    margin-top:0.2rem;
  }
  a.select_adr:after {
    content: '';
    position: absolute;
    right: 0.55rem;
    top: 50%;
    margin-top: -0.5rem;
    width: 0.8rem;
    height: 0.8rem;
    background-image: url(/static/theme/default/svg/arrow-right.svg);
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100% 100%;
  }
  .item-line .item-title {
    text-align: left;
  }
  .T {
    line-height:1.5rem;
    padding-bottom:0.5rem;
    font-size:0.8rem;
    color: #c45646;
  }
  .pro_list {
    background: #ebebeb;
    border-radius: 0.3rem;
  }
  .pro_list ul li {
    position: relative;
    padding:0.5rem;
    height: 3.5rem;
  }
  .pro_list ul li .my_img {
    width:3.4rem;
    height:2.4rem;
    position: absolute;
    top:0.5rem;
    left:0.5rem;
  }
  .pro_list ul li .my_img img {
    width:100%;
    height:100%;
  }
  .pro_list ul li .my_word {
    margin-left:4rem;
    line-height:1.1rem;
  }
  .pro_list ul li .my_word .info {
    color: #999;
  }
  .fr {
    float: right;
  }
  .pro_list ul li .my_word i {
    color: #FF7F2B;
  }
  .total_box {
    background: #ebebeb;
    padding:0.7rem;
    margin-top:0.5rem;
    text-align: right;
    color: #555;
    font-size:0.65rem;
  }
  .total_box b {
    font-size:0.8rem;
    font-weight: bold;
    color: red;
  }
  .item-line .item-title {
    font-size:0.65rem;
  }
  .pop_box {
    display: none;
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: #23262f;
    z-index:9999;
  }
  .border-b {
    border-bottom: 1px solid #d4d1d1;
  }
  .item-line{padding: 0.5rem 0.75rem 0}
  .item-line .item-title {
    color: #666;
    padding: 0 0 0.5rem;
    text-align: left;
    width: 2rem;}
  .select_adr_list{
    display: block;
    padding: 0.6rem 1.7rem 0.6rem 0.8rem;
    position: relative;
    background: #3b3c44;
    color: #fff;
    margin: 0.5rem;
    border-radius: 0.3rem;
  }
  #address_list{padding-top: 2.8rem}
  #address_list p{line-height: 1.0rem;font-size: 0.7rem }
  #address_list .city{color: #adb0c1}
  .btn.btn-danger.btn-fill{background: #d75852;}

</style>

<header class="header">
  <a class="header-left" href="{:Url('/index/shop')}">
    <i class="icon-svg icon_left"></i>
  </a>
  <div class="header-center">{$title}</div>
</header>
<div class="p-height"></div>
<div id="app">
  <form class="form" id="addressForm">
    <div class="T">商品信息</div>
    <div class="pro_list">
      <ul>
        <li class="border-b">
          <div class="my_img"><img src="{$shop_info.img_url}" alt=""></div>
          <div class="my_word">
            <p>{$shop_info.name}</p>
            <p class="info">兑换数量：<i>{$num}</i></p>
          </div>
        </li>
      </ul>
    </div>
    <div class="clear" style="height: 0.5rem;"></div>
    <div class="T">收货信息</div>
    <template v-if="!select_adr.id">
      <a class="select_adr border-b" style="text-align: center; color:#999; padding:1rem 0.5rem;" href="{:Url('selectAddress')}">
        您还没有收货地址，请先 <i style="color:#0894ec;">添加收货地址</i>
      </a>
    </template>
    <template v-else>
      <a class="select_adr border-b" @click="addressPop" href="javascript:;">
        <p>收货人：{{select_adr.name}}  <i class="fr">{{select_adr.tel}}</i></p>
        <p class="city">收货地址：{{select_adr.city}}  {{select_adr.address}}</p>
      </a>
    </template>

    <input type="hidden" name="address_id" v-model="select_adr.id">
    <input type="hidden" name="shop_id" value="{$shop_info.id}">
    <input type="hidden" name="num" value="{$num}">
    <div class="item-line">
      <div class="item-title">备注</div>
      <div class="item-input">
        <textarea name="name" v-model="remark" class="input input-line input-lg" placeholder="可输入备注信息"></textarea>
      </div>
    </div>
    <div class="total_box border-b">消耗余额： <b>{$shop_info.integral * $num}</b></div>
      
    <div><button type="button" class="btn btn-danger btn-fill btn-lg" @click="formSub">提交兑换</button></div>
  </form>
  <div class="pop_box">
    <div class="header">
      <div class="header-nav" style="padding-top:0;padding-bottom:0;">
        <a @click="closePop" href="javascript:;">
          <i class="icon-svg icon_left"></i>
        </a>
      </div>
      <div class="header-center">选择收货地址</div>
      <div class="header-nav" style="padding-top:0;padding-bottom:0;">
        <a href="{:Url('index/Address/index')}" style="color: #ff6600;font-size: 0.8rem;">管理</a>
      </div>
    </div>
    <div id="address_list">
      <a class="select_adr_list" v-for="item in adr_list" @click="selectAddress(item)" href="javascript:;">
        <p>收货人：{{item.name}}  <i class="fr">{{item.tel}}</i></p>
        <p class="city">收货地址：{{item.city}}  {{item.address}}</p>
      </a>
    </div>
  </div>

</div>


{include file='common@common/foot' /}
<script>
  var vm = new Vue({
      el: '#app',
      data : {
          adr_list : [],
          remark: '',
          select_adr : {}
      },
      mounted : function(){
          this.$nextTick(function () {
              $.post('{:Url("index/Address/getDefaultAddress")}', function(data){
                  if (data.code) {
                      vm.select_adr = data.data;
                  }
              })
              $.post('{:Url("index/Address/getList")}', function(res){
                  if (res.code) {
                      vm.adr_list = res.data.list.data;
                  }
              })

          })
      },
      methods: {
          addressPop:function(){
              $('.pop_box').show();
          },
          closePop:function () {
              $('.pop_box').hide();
          },
          selectAddress:function (item) {
            vm.select_adr = item;
              $('.pop_box').hide();
          },
          formSub:function () {
              $.post('{:Url("index/Shop/orderDo")}',{address_id:vm.select_adr.id, remark:vm.remark, num:'{$num}', id:'{$shop_info.id}'}, function(data){
                  $.msg(data.msg);
                  if (data.code) {
                      setTimeout(function () {
                          window.location.href='{:Url("index/Shop/index")}';
                      },1000)
                  }
              })
          }
      }
  })
</script>

