{include file='common@common/head' /}
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/mint-ui/lib/index.js"></script>
<style>
  .list-block{
    margin-top: .3rem;
  }
  .send_title {
    position:relative;
    padding: 0 .5rem;
    line-height: 2.5rem;
    background: #FFF;
    margin-top: 0.7rem;
    z-index: 10;
  }
  .right {
    font-size: .7rem;
    color: #666;
    float: right;
    padding-right: 1.2rem;
  }
  .textarea {
    padding: .2rem;
  }
  .user_info {
    position: relative;
    padding-left: 1.2rem;
  }
  .photo {
    position: absolute;
    left: 0;
    top: 0;
    display: inline-block;
    width: 1rem;
    height: 1rem;
    background: #f68;
    border-radius: 50%;
  }
  .username {
    text-align: left;
  }
  .datetime {
    font-size: 12px;
    color: #aaa;
  }
  .card{
    margin-top:0;
  }
  .submit_class{
    margin: 0 .1rem;
  }
  .submit_class button{
    display: block;
    width: 100%;
    padding:0 1rem;
  }
  .upimg{
    position: absolute;
    top: 0.8rem;
    right: 0.5rem;
  }
</style>
<div class="page page-current" id="send_msseage">

      <header class="header">
        <div class="header-nav">
          <a class="nav-word" id="cancleBtn" href="/index/user/message"><i class="icon-svg icon_left"></i> </a>
        </div>
        <div class="header-title">{$title}</div>
        <div class="header-nav"></div>
      </header>
      <div class="p-height"></div>
        <div id="app" class="app_init">

          <div class="send_title">
            <span>发送给</span>
            <a href="#">{$username}</a>
            <span class="right" v-on:click="chatShow">
              <span>消息记录</span>
            &nbsp;<span :class="['icon-svg', isshow?'icon_top':'icon_bottom','upimg']"></span>
            </span>
          </div>

          <div class="content" id="content">
              <div class="list-block">
                <div class="chat_list" v-show="isshow" id="chat_list">
                  <div class="card-container">
                    <div class="card" v-for="(item,key) of list">
                      <div class="card-content">
                        <div class="card-content-inner">{{item.content}}</div>
                      </div>
                      <div class="card-footer massage_info">
                        <div class="user_info">
                          <span class="photo"></span>
                          <a class="username" :href="'/index/user/show?userid='+item.send_userid" data-no-cache="true">{{item.username}}</a>
                          <span class="datetime">{{item.create_time}}</span>
                        </div>
                        <div>
                          <a href="javascript:;" @click="data_delete(item.id,key)">删除 </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="chat_input" v-show="!isshow">
                  <form action="{:Url('send')}" id="send" class="form">
                    <div class="textarea">
                      <textarea name="content" class="input input-line input-lg" placeholder="输入消息内容"></textarea>
                    </div>
                    <input type="hidden" value="{$userid}" name="userid">
                    <div class="submit_class"><button class="btn btn-fill">发送</button></div>
                  </form>

                </div>
              </div>

         </div>
      </div>
</div>
<script>

    var vm = new Vue({
        el: '#app',
        data: {
            list: [],
            isshow: true
        },
        created: function () {
            this.chatShow();
            $("#app").removeClass("app_init");
        },
        methods: {
            chatShow: function () {
                var _this = this;
                _this.isshow = !_this.isshow;
                if (_this.isshow) {
                    $.get("/index/message/messageRecord", {send_userid: $("input[name='userid']").val()}, function(data) {
                        _this.list = data.list;
                    });
                }
            }
        }
    });
    $("#send").formAjax({
        callback: function (data) {
            $.msg(data.msg);
        }
    });
</script>
{include file='common@common/foot' /}