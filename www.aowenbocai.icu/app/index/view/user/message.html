{include file='common@common/head' /}
<link rel="stylesheet" href="/static/dropload/dropload.css"/>
<script src="/static/dropload/dropload.js"></script>
<script src="/static/js/loadpage.js"></script>
<script src="/static/js/vue-component.js"></script>

<style>
    .tab-content{
        padding: 0 !important;
    }
    .user_photo{height: 20px;}
    .user_photo img{
        width:1rem;
        height: 1rem;
        border-radius: 50%;
        margin-right: .2rem;}
    .datetime {
        font-size: 0.7rem;
        color: #adb0c1;
    }
    .more{
        text-align: center;
        color: #999;
        font-size: 0.7rem;
        margin: 0.7rem 0;
    }
    .card-list{padding: 0 0.5rem;margin-bottom: 0.5rem;border-radius: .2rem;background-color: #353944;
    }
    .tab .tab-header{margin-bottom: 0.5rem;}
    .msg-list{background: #3b3c44;position: relative;margin: 0 .5rem;}
    .msg-content{line-height:1.0rem;color: #fff;text-align: left;}
    .photo{ display: inline-block;
        width: 1rem;
        height: 1rem;
        background: #f68;
        border-radius: 50%;margin-right: 0.2rem}
    .send-msg span{padding-right: 5px;}
    .control a{margin-right: 5px;}
    .read {background: url(/static/theme/default/svg/index_nav/read.png) no-repeat }
    .noread {background: url(/static/theme/default/svg/index_nav/noread.png) no-repeat }
    .card-footer:after{background: #696971;}
    .card-content{padding: 0.5rem 0rem;}
    .card-footer{padding: 0.5rem 0rem;}
</style>

<header class="header">
    <div class="header-nav">
        <a class="nav-word" id="cancleBtn" href="javascript:history.go(-1);"><i class="icon-svg icon_left"></i> </a>
    </div>
    <div class="header-title">消息中心</div>
    <div class="header-nav"></div>
</header>
<div class="p-height"></div>
<div id="app">
    <div class="tab">
        <div class="tab-header">
            <div class="tab-link tab-active" id="tab1" onclick="setTab('tab',1,2)" @click="type=1">收件箱</div>
            <div class="tab-link" id="tab2" onclick="setTab('tab',2,2)" @click="type=2">发件箱</div>
        </div>
        <div class="tab-content" id="list_ref">
            <div class="tab-page tab1 tab-active" id="con_tab_1">
                <loading-box url="/index/user/getMessage/?msg_type=1"  class="bbs-list-arrow">
                    <template scope="props">
                        <template v-for="item of props.list">
                            <msg-list :item="item" :type="type"></msg-list>
                        </template>
                    </template>
                </loading-box>
            </div>

            <div class="tab-page tab2" id="con_tab_2">
                <loading-box url="/index/user/getMessage/?msg_type=2"  class="bbs-list-arrow">
                    <template scope="props">
                        <template v-for="item of props.list">
                            <msg-list :item="item" :type="type"></msg-list>
                        </template>
                    </template>
                </loading-box>
            </div>

        </div>
    </div>
</div>

<template id="msgList">
    <div v-show="this_show" class="card-list"  @click="setStatus">
        <div class="card-content msg-content"> {{item.content}}</div>
        <div class="flex-box card-footer massage_info">
            <span v-if="item.send_userid ==0  && type ==1" class="datetime  flex-box">
                <span class="photo"></span>
                <a>{{item.username}}</a>
            </span>
            <span class="flex-box" v-if="showReply && type ==1">
                <span>发件人:</span>
                 <!--<span class="user_photo"><img src="{$data.photo}"></span>-->
                <a>{{item.send_username}}</a>
            </span>
            <span class="flex-box send-msg"  v-if="type==2">
                <span>收件人:</span>
                <!--<span class="user_photo"><img src="{$data.photo}"></span>-->
                <a>{{item.send_username}}</a>
            </span>
            <span class="datetime flex" style="text-align: left;padding-left: 0.2rem">{{item.create_time}}</span>
            <span class="flex-box control">
                <span v-if="item.read =='read' && type==1"  style="margin-right: 5px;color: #bfbfbf"><i class="iconfont icon-xiaoxiyidu-1"></i></span>
                <span v-if="item.read =='noread' && type==1" style="margin-right: 5px;color: red"><i style="font-size: 0.9rem" class="iconfont icon-weiduxiaoxi1"></i></span>
                <!--<span><img :src="'/static/theme/default/svg/index_nav/'+item.read+'.png'" alt="" style="margin-bottom:-3px;margin-right: 3px;"></span>-->
                <a href="javascript:;" @click="dataDelete">删除</a>
                <a :href="'/index/message/send?userid='+item.send_userid" v-if="showReply">回复</a>
            </span>
        </div>
    </div>
</template>

<script>

    $(function () {
        Vue.component('msg-list', {
            data:function(){
            return {
                this_show: true
            }
        },
        props: ['item', 'type'],
                template: '#msgList',
                methods: {
                    dataDelete:function() {
                        $.confirm('确定删除吗', {
                            yes: function() {
                                $.get('/index/User/messageDelete/', {
                                    id: this.item.id
                                }, function(res) {
                                    $.msg(res.msg);
                                    this.this_show = false;
                                });
                            }
                        });
                    },
                    setStatus: function () {
                        var _this =this;
                        if(_this.item.read == 'read') {return false;}
                        $.get('/index/User/setStatus/id/'+this.item.id,function(){
                            _this.item.read = 'read'
                        })
                    }
                },
        computed: {
            showReply:function() {
                return this.item.send_userid != 0 && this.type == 1;
            }
        }
    });


    var vm = new Vue({
        el:'#app',
        data: {
            type:'1'
        }
    });

//    $('#list_ref').dropload({
//        loadUpFn: function(me) {
//            var loadKey = $('.tab-page.tab-active').data('load-page');
//            vm[loadKey].first(() => {
//                me.resetload();
//            });
//        }
//    });
    });
    //选项卡JS
    function setTab(name,cursel,n){
        for(i=1;i<=n;i++){
            var menu=document.getElementById(name+i);
            var con=document.getElementById("con_"+name+"_"+i);
            menu.className=i==cursel?"tab-link tab-active":"tab-link";
            con.style.display=i == cursel?"block":"none";
        }
    }
</script>

{include file='common@common/foot' /}
